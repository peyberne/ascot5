<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.9.1" xml:lang="en-US">
  <compounddef id="particle_8c" kind="file" language="C++">
    <compoundname>particle.c</compoundname>
    <includes local="no">stdio.h</includes>
    <includes local="no">stdlib.h</includes>
    <includes refid="math_8h" local="no">math.h</includes>
    <includes refid="ascot5_8h" local="yes">ascot5.h</includes>
    <includes refid="error_8h" local="yes">error.h</includes>
    <includes refid="consts_8h" local="yes">consts.h</includes>
    <includes refid="physlib_8h" local="yes">physlib.h</includes>
    <includes refid="gctransform_8h" local="yes">gctransform.h</includes>
    <includes refid="particle_8h" local="yes">particle.h</includes>
    <includes refid="B__field_8h" local="yes">B_field.h</includes>
    <includes refid="E__field_8h" local="yes">E_field.h</includes>
    <incdepgraph>
      <node id="11">
        <label>gctransform.h</label>
        <link refid="gctransform_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="1">
        <label>particle.c</label>
        <link refid="particle_8c"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
      </node>
      <node id="12">
        <label>particle.h</label>
        <link refid="particle_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
      </node>
      <node id="16">
        <label>../spline/interp.h</label>
        <link refid="interp_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
      </node>
      <node id="14">
        <label>Bfield/B_GS.h</label>
        <link refid="B__GS_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
      </node>
      <node id="3">
        <label>stdlib.h</label>
      </node>
      <node id="6">
        <label>omp.h</label>
      </node>
      <node id="9">
        <label>consts.h</label>
        <link refid="consts_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="13">
        <label>B_field.h</label>
        <link refid="B__field_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
      </node>
      <node id="23">
        <label>Efield/E_1DS.h</label>
        <link refid="E__1DS_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
      </node>
      <node id="10">
        <label>physlib.h</label>
        <link refid="physlib_8h"/>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
      </node>
      <node id="8">
        <label>error.h</label>
        <link refid="error_8h"/>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="2" relation="include">
        </childnode>
      </node>
      <node id="21">
        <label>E_field.h</label>
        <link refid="E__field_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
      </node>
      <node id="7">
        <label>time.h</label>
      </node>
      <node id="20">
        <label>Bfield/B_TC.h</label>
        <link refid="B__TC_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
      </node>
      <node id="19">
        <label>../linint/linint.h</label>
        <link refid="linint_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
      </node>
      <node id="15">
        <label>Bfield/B_2DS.h</label>
        <link refid="B__2DS_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
      </node>
      <node id="22">
        <label>Efield/E_TC.h</label>
        <link refid="E__TC_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
      </node>
      <node id="17">
        <label>Bfield/B_3DS.h</label>
        <link refid="B__3DS_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
      </node>
      <node id="4">
        <label>math.h</label>
        <link refid="math_8h"/>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>stdio.h</label>
      </node>
      <node id="18">
        <label>Bfield/B_STS.h</label>
        <link refid="B__STS_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
      </node>
      <node id="5">
        <label>ascot5.h</label>
        <link refid="ascot5_8h"/>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
      </node>
    </incdepgraph>
      <sectiondef kind="func">
      <memberdef kind="function" id="particle_8c_1a5b1269a856de55b03a59d06df3ee3113" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void particle_to_fo_dummy</definition>
        <argsstring>(particle_simd_fo *p_fo, int j)</argsstring>
        <name>particle_to_fo_dummy</name>
        <param>
          <type><ref refid="structparticle__simd__fo" kindref="compound">particle_simd_fo</ref> *</type>
          <declname>p_fo</declname>
        </param>
        <param>
          <type>int</type>
          <declname>j</declname>
        </param>
        <briefdescription>
<para>Makes a dummy FO simulation marker. </para>
        </briefdescription>
        <detaileddescription>
<para>A dummy marker is a marker whose fields have possible but unrealistic values. It is intended to act as a filler for SIMD arrays that would otherwise be left uninitialized.</para>
<para>A dummy marker has negative one (-1) ID and negative one (-1) queue index, and it is not running (0). Dummy marker should be ignored when encountered during the simulation.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p_fo</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to <ref refid="structparticle__simd__fo" kindref="compound">particle_simd_fo</ref> array where dummy is placed </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>j</parametername>
</parameternamelist>
<parameterdescription>
<para>index of the new dummy in the SIMD arrays </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="particle.c" line="74" column="6" bodyfile="particle.c" bodystart="74" bodyend="98"/>
      </memberdef>
      <memberdef kind="function" id="particle_8c_1a9811038a60f0e1525fca6dc9f9a6a150" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void particle_to_gc_dummy</definition>
        <argsstring>(particle_simd_gc *p_gc, int j)</argsstring>
        <name>particle_to_gc_dummy</name>
        <param>
          <type><ref refid="structparticle__simd__gc" kindref="compound">particle_simd_gc</ref> *</type>
          <declname>p_gc</declname>
        </param>
        <param>
          <type>int</type>
          <declname>j</declname>
        </param>
        <briefdescription>
<para>Makes a dummy GC simulation marker. </para>
        </briefdescription>
        <detaileddescription>
<para>A dummy marker is a marker whose fields have possible but unrealistic values. It is intended to act as a filler for SIMD arrays that would otherwise be left uninitialized.</para>
<para>A dummy marker has negative one (-1) ID and negative one (-1) queue index, and it is not running (0). Dummy marker should be ignored when encountered during the simulation.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p_gc</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to <ref refid="structparticle__simd__gc" kindref="compound">particle_simd_gc</ref> array where dummy is placed </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>j</parametername>
</parameternamelist>
<parameterdescription>
<para>index of the new dummy in the SIMD arrays </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="particle.c" line="114" column="6" bodyfile="particle.c" bodystart="114" bodyend="144"/>
      </memberdef>
      <memberdef kind="function" id="particle_8c_1a0bff4063646ea64c569a51f947c81475" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void particle_to_ml_dummy</definition>
        <argsstring>(particle_simd_ml *p_ml, int j)</argsstring>
        <name>particle_to_ml_dummy</name>
        <param>
          <type><ref refid="structparticle__simd__ml" kindref="compound">particle_simd_ml</ref> *</type>
          <declname>p_ml</declname>
        </param>
        <param>
          <type>int</type>
          <declname>j</declname>
        </param>
        <briefdescription>
<para>Makes a dummy ML simulation marker. </para>
        </briefdescription>
        <detaileddescription>
<para>A dummy marker is a marker whose fields have possible but unrealistic values. It is intended to act as a filler for SIMD arrays that would otherwise be left uninitialized.</para>
<para>A dummy marker has negative one (-1) ID and negative one (-1) queue index, and it is not running (0). Dummy marker should be ignored when encountered during the simulation.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p_ml</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to <ref refid="structparticle__simd__ml" kindref="compound">particle_simd_ml</ref> array where dummy is placed </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>j</parametername>
</parameternamelist>
<parameterdescription>
<para>index of the new dummy in the SIMD arrays </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="particle.c" line="160" column="6" bodyfile="particle.c" bodystart="160" bodyend="183"/>
      </memberdef>
      <memberdef kind="function" id="particle_8c_1af053259c1f06721bbbbe61baaa0facb0" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int particle_cycle_fo</definition>
        <argsstring>(particle_queue *q, particle_simd_fo *p, B_field_data *Bdata, int *cycle)</argsstring>
        <name>particle_cycle_fo</name>
        <param>
          <type><ref refid="structparticle__queue" kindref="compound">particle_queue</ref> *</type>
          <declname>q</declname>
        </param>
        <param>
          <type><ref refid="structparticle__simd__fo" kindref="compound">particle_simd_fo</ref> *</type>
          <declname>p</declname>
        </param>
        <param>
          <type><ref refid="structB__field__data" kindref="compound">B_field_data</ref> *</type>
          <declname>Bdata</declname>
        </param>
        <param>
          <type>int *</type>
          <declname>cycle</declname>
        </param>
        <briefdescription>
<para>Replace finished FO markers with new ones or dummies. </para>
        </briefdescription>
        <detaileddescription>
<para>A marker has finished simulation when marker.running = 0. If queue has unsimulated markers, one is picked to replace the finished marker. If not, a dummy marker is used as a replacement instead. Finished marker is converted to marker state and stored in the queue.</para>
<para>This function updates queue.next and queue.finished fields when a marker has finished simulation. This is done thread-safe.</para>
<para>This function returns values indicating what was done for each marker in a SIMD array: 0 : Nothing -1 : Finished marker replaced with a dummy (queue is empty) 1 : Finished marker replaced with a fresh one</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>q</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to marker queue </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>p</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to SIMD structure of markers </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>Bdata</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to magnetic field data </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>cycle</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to integer array where what was done for each marker is stored</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Number of markers within the SIMD structure that are still running </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="particle.c" line="210" column="5" bodyfile="particle.c" bodystart="210" bodyend="282"/>
      </memberdef>
      <memberdef kind="function" id="particle_8c_1ae9a00100d11547e28826c5c2e0ff7372" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int particle_cycle_gc</definition>
        <argsstring>(particle_queue *q, particle_simd_gc *p, B_field_data *Bdata, int *cycle)</argsstring>
        <name>particle_cycle_gc</name>
        <param>
          <type><ref refid="structparticle__queue" kindref="compound">particle_queue</ref> *</type>
          <declname>q</declname>
        </param>
        <param>
          <type><ref refid="structparticle__simd__gc" kindref="compound">particle_simd_gc</ref> *</type>
          <declname>p</declname>
        </param>
        <param>
          <type><ref refid="structB__field__data" kindref="compound">B_field_data</ref> *</type>
          <declname>Bdata</declname>
        </param>
        <param>
          <type>int *</type>
          <declname>cycle</declname>
        </param>
        <briefdescription>
<para>Replace finished GC markers with new ones or dummies. </para>
        </briefdescription>
        <detaileddescription>
<para>A marker has finished simulation when marker.running = 0. If queue has unsimulated markers, one is picked to replace the finished marker. If not, a dummy marker is used as a replacement instead. Finished marker is converted to marker state and stored in the queue.</para>
<para>This function updates queue.next and queue.finished fields when a marker has finished simulation. This is done thread-safe.</para>
<para>This function returns values indicating what was done for each marker in a SIMD array: 0 : Nothing -1 : Finished marker replaced with a dummy (queue is empty) 1 : Finished marker replaced with a fresh one</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>q</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to marker queue </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>p</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to SIMD structure of markers </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>Bdata</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to magnetic field data </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>cycle</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to integer array where what was done for each marker is stored</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Number of markers within the SIMD structure that are still running </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="particle.c" line="309" column="5" bodyfile="particle.c" bodystart="309" bodyend="376"/>
      </memberdef>
      <memberdef kind="function" id="particle_8c_1ac5fcdf3eb124f6caa4e4b748e3449ee2" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int particle_cycle_ml</definition>
        <argsstring>(particle_queue *q, particle_simd_ml *p, B_field_data *Bdata, int *cycle)</argsstring>
        <name>particle_cycle_ml</name>
        <param>
          <type><ref refid="structparticle__queue" kindref="compound">particle_queue</ref> *</type>
          <declname>q</declname>
        </param>
        <param>
          <type><ref refid="structparticle__simd__ml" kindref="compound">particle_simd_ml</ref> *</type>
          <declname>p</declname>
        </param>
        <param>
          <type><ref refid="structB__field__data" kindref="compound">B_field_data</ref> *</type>
          <declname>Bdata</declname>
        </param>
        <param>
          <type>int *</type>
          <declname>cycle</declname>
        </param>
        <briefdescription>
<para>Replace finished ML markers with new ones or dummies. </para>
        </briefdescription>
        <detaileddescription>
<para>A marker has finished simulation when marker.running = 0. If queue has unsimulated markers, one is picked to replace the finished marker. If not, a dummy marker is used as a replacement instead. Finished marker is converted to marker state and stored in the queue.</para>
<para>This function updates queue.next and queue.finished fields when a marker has finished simulation. This is done thread-safe.</para>
<para>This function returns values indicating what was done for each marker in a SIMD array: 0 : Nothing -1 : Finished marker replaced with a dummy (queue is empty) 1 : Finished marker replaced with a fresh one</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>q</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to particle queue </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>p</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to SIMD structure of markers </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>Bdata</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to magnetic field data </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>cycle</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to integer array where what was done for each marker is stored</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Number of markers within the SIMD structure that are still running </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="particle.c" line="403" column="5" bodyfile="particle.c" bodystart="403" bodyend="470"/>
      </memberdef>
      <memberdef kind="function" id="particle_8c_1a8e96bcfc9c95b76f3c91663e34a43b01" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void particle_input_to_state</definition>
        <argsstring>(input_particle *p, particle_state *ps, B_field_data *Bdata)</argsstring>
        <name>particle_input_to_state</name>
        <param>
          <type><ref refid="structinput__particle" kindref="compound">input_particle</ref> *</type>
          <declname>p</declname>
        </param>
        <param>
          <type><ref refid="structparticle__state" kindref="compound">particle_state</ref> *</type>
          <declname>ps</declname>
        </param>
        <param>
          <type><ref refid="structB__field__data" kindref="compound">B_field_data</ref> *</type>
          <declname>Bdata</declname>
        </param>
        <briefdescription>
<para>Converts input marker to a marker state. </para>
        </briefdescription>
        <detaileddescription>
<para>When marker input is read, the data is stored in one of the input marker structs (particle, <ref refid="structparticle__gc" kindref="compound">particle_gc</ref>, <ref refid="structparticle__ml" kindref="compound">particle_ml</ref>). This function converts these structs into a marker state, which then can be used to create simulation structs.</para>
<para>If an error is encountered while converting, the error message is stored to the state.</para>
<para><xrefsect id="todo_1_todo000008"><xreftitle>Todo</xreftitle><xrefdescription><para>Parameter p can be a <ref refid="structparticle__state" kindref="compound">particle_state</ref> itself but this option is not dealt with </para>
<para>This sets p-&gt;type = input_particle_type_s which is not in accordance with the documentation.</para>
</xrefdescription></xrefsect></para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to marker input </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>ps</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to state where converted marker will be stored </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>Bdata</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to magnetic field data </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="particle.c" line="492" column="6" bodyfile="particle.c" bodystart="492" bodyend="573"/>
      </memberdef>
      <memberdef kind="function" id="particle_8c_1a275c199f15c1a8f46a48decfb6908b71" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref></type>
        <definition>a5err particle_state_to_fo</definition>
        <argsstring>(particle_state *p, int i, particle_simd_fo *p_fo, int j, B_field_data *Bdata)</argsstring>
        <name>particle_state_to_fo</name>
        <param>
          <type><ref refid="structparticle__state" kindref="compound">particle_state</ref> *</type>
          <declname>p</declname>
        </param>
        <param>
          <type>int</type>
          <declname>i</declname>
        </param>
        <param>
          <type><ref refid="structparticle__simd__fo" kindref="compound">particle_simd_fo</ref> *</type>
          <declname>p_fo</declname>
        </param>
        <param>
          <type>int</type>
          <declname>j</declname>
        </param>
        <param>
          <type><ref refid="structB__field__data" kindref="compound">B_field_data</ref> *</type>
          <declname>Bdata</declname>
        </param>
        <briefdescription>
<para>Convert state into a FO SIMD marker. </para>
        </briefdescription>
        <detaileddescription>
<para>This function assumes markers are drawn from a marker queue where they will be returned at the same position once simulation for this marker has ended,</para>
<para>State is converted into a FO marker by copying all the fields, except for magnetic field (and rho) which is evaluated here at FO position and then stored.</para>
<para>The simulation marker is set as running unless there is an error or the state already have active end condition.</para>
<para>If state marker already has an error flag, this error flag is returned and nothing is done. If an error occurs within this function, the conversion is terminated and the error is returned. It is the responsibility of the caller to store the error in correct struct.</para>
<para>This is a SIMD function.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to a state being converted </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>i</parametername>
</parameternamelist>
<parameterdescription>
<para>index of this state in the marker queue </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>p_fo</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to SIMD structure where marker is being stored </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>j</parametername>
</parameternamelist>
<parameterdescription>
<para>index where in the SIMD structure marker is stored </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>Bdata</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to magnetic field data </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="particle.c" line="601" column="7" bodyfile="particle.c" bodystart="601" bodyend="670"/>
      </memberdef>
      <memberdef kind="function" id="particle_8c_1a308eb43a7cb3aead97315dd1020aae9d" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void particle_fo_to_state</definition>
        <argsstring>(particle_simd_fo *p_fo, int j, particle_state *p, B_field_data *Bdata)</argsstring>
        <name>particle_fo_to_state</name>
        <param>
          <type><ref refid="structparticle__simd__fo" kindref="compound">particle_simd_fo</ref> *</type>
          <declname>p_fo</declname>
        </param>
        <param>
          <type>int</type>
          <declname>j</declname>
        </param>
        <param>
          <type><ref refid="structparticle__state" kindref="compound">particle_state</ref> *</type>
          <declname>p</declname>
        </param>
        <param>
          <type><ref refid="structB__field__data" kindref="compound">B_field_data</ref> *</type>
          <declname>Bdata</declname>
        </param>
        <briefdescription>
<para>Convert FO to state. </para>
        </briefdescription>
        <detaileddescription>
<para>This function converts FO simulation marker to a marker state. No new state structure is initialized, but an existing one is filled with parameters corresponding to the converted marker.</para>
<para>This is a SIMD function.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p_fo</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to SIMD structure </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>j</parametername>
</parameternamelist>
<parameterdescription>
<para>SIMD index of the marker to be converted </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>p</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to state whose fields are used to store the converted marker </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>Bdata</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to magnetic field data </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="particle.c" line="686" column="6" bodyfile="particle.c" bodystart="686" bodyend="786"/>
      </memberdef>
      <memberdef kind="function" id="particle_8c_1a217333f14fa85b8882738f804346c493" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref></type>
        <definition>a5err particle_state_to_gc</definition>
        <argsstring>(particle_state *p, int i, particle_simd_gc *p_gc, int j, B_field_data *Bdata)</argsstring>
        <name>particle_state_to_gc</name>
        <param>
          <type><ref refid="structparticle__state" kindref="compound">particle_state</ref> *</type>
          <declname>p</declname>
        </param>
        <param>
          <type>int</type>
          <declname>i</declname>
        </param>
        <param>
          <type><ref refid="structparticle__simd__gc" kindref="compound">particle_simd_gc</ref> *</type>
          <declname>p_gc</declname>
        </param>
        <param>
          <type>int</type>
          <declname>j</declname>
        </param>
        <param>
          <type><ref refid="structB__field__data" kindref="compound">B_field_data</ref> *</type>
          <declname>Bdata</declname>
        </param>
        <briefdescription>
<para>Convert state into a GC SIMD marker. </para>
        </briefdescription>
        <detaileddescription>
<para>This function assumes markers are drawn from a marker queue where they will be returned at the same position once simulation for this marker has ended,</para>
<para>State is converted into a GC marker by simply copying all the necessary fields.</para>
<para>The simulation marker is set as running unless there is an error or the state already have active end condition.</para>
<para>If state marker already has an error flag, this error flag is returned and nothing is done. If an error occurs within this function, the conversion is terminated and the error is returned. It is the responsibility of the caller to store the error in correct struct.</para>
<para>This is a SIMD function.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to a state being converted </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>i</parametername>
</parameternamelist>
<parameterdescription>
<para>index of this state in the marker queue </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>p_gc</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to SIMD structure where marker is being stored </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>j</parametername>
</parameternamelist>
<parameterdescription>
<para>index where in the SIMD structure marker is stored </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>Bdata</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to magnetic field data </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="particle.c" line="813" column="7" bodyfile="particle.c" bodystart="813" bodyend="862"/>
      </memberdef>
      <memberdef kind="function" id="particle_8c_1a10627ba7787e16ac8b87afcf55d82c61" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void particle_gc_to_state</definition>
        <argsstring>(particle_simd_gc *p_gc, int j, particle_state *p, B_field_data *Bdata)</argsstring>
        <name>particle_gc_to_state</name>
        <param>
          <type><ref refid="structparticle__simd__gc" kindref="compound">particle_simd_gc</ref> *</type>
          <declname>p_gc</declname>
        </param>
        <param>
          <type>int</type>
          <declname>j</declname>
        </param>
        <param>
          <type><ref refid="structparticle__state" kindref="compound">particle_state</ref> *</type>
          <declname>p</declname>
        </param>
        <param>
          <type><ref refid="structB__field__data" kindref="compound">B_field_data</ref> *</type>
          <declname>Bdata</declname>
        </param>
        <briefdescription>
<para>Convert GC to state. </para>
        </briefdescription>
        <detaileddescription>
<para>This function converts GC simulation marker to a marker state. No new state structure is initialized, but an existing one is filled with parameters corresponding to the converted marker.</para>
<para>This is a SIMD function.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p_gc</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to SIMD structure </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>j</parametername>
</parameternamelist>
<parameterdescription>
<para>SIMD index of the marker to be converted </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>p</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to state whose fields are used to store the converted marker </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>Bdata</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to magnetic field data </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="particle.c" line="878" column="6" bodyfile="particle.c" bodystart="878" bodyend="962"/>
      </memberdef>
      <memberdef kind="function" id="particle_8c_1aaa3116ddab1b53462a5c7d7c98dcf839" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref></type>
        <definition>a5err particle_state_to_ml</definition>
        <argsstring>(particle_state *p, int i, particle_simd_ml *p_ml, int j, B_field_data *Bdata)</argsstring>
        <name>particle_state_to_ml</name>
        <param>
          <type><ref refid="structparticle__state" kindref="compound">particle_state</ref> *</type>
          <declname>p</declname>
        </param>
        <param>
          <type>int</type>
          <declname>i</declname>
        </param>
        <param>
          <type><ref refid="structparticle__simd__ml" kindref="compound">particle_simd_ml</ref> *</type>
          <declname>p_ml</declname>
        </param>
        <param>
          <type>int</type>
          <declname>j</declname>
        </param>
        <param>
          <type><ref refid="structB__field__data" kindref="compound">B_field_data</ref> *</type>
          <declname>Bdata</declname>
        </param>
        <briefdescription>
<para>Convert state to a ML SIMD marker. </para>
        </briefdescription>
        <detaileddescription>
<para>This function assumes markers are drawn from a marker queue where they will be returned at the same position once simulation for this marker has ended,</para>
<para>State is converted into a ML marker by using particle position as initial position. Other fields are simply copied exceot pitch, which is calculated from vpar as pitch = 2*(vpar &gt;= 0) - 1, i.e., sign of vpar determines sign of pitch.</para>
<para>The simulation marker is set as running unless there is an error or the state already have active end condition.</para>
<para>If state marker already has an error flag, this error flag is returned and nothing is done. If an error occurs within this function, the conversion is terminated and the error is returned. It is the responsibility of the caller to store the error in correct struct.</para>
<para>This is a SIMD function.</para>
<para><xrefsect id="todo_1_todo000009"><xreftitle>Todo</xreftitle><xrefdescription><para>A minor thing but it would be better if guiding center position were used instead. This would require evaluation of the magnetic field.</para>
</xrefdescription></xrefsect></para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to a state being converted </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>i</parametername>
</parameternamelist>
<parameterdescription>
<para>index of this state in the marker queue </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>p_ml</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to SIMD structure where marker is being stored </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>j</parametername>
</parameternamelist>
<parameterdescription>
<para>index where in the SIMD structure marker is stored </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>Bdata</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to magnetic field data </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="particle.c" line="994" column="7" bodyfile="particle.c" bodystart="994" bodyend="1039"/>
      </memberdef>
      <memberdef kind="function" id="particle_8c_1ae5b0e6f269fe140fbb8f00b96e7aa7a9" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void particle_ml_to_state</definition>
        <argsstring>(particle_simd_ml *p_ml, int j, particle_state *p, B_field_data *Bdata)</argsstring>
        <name>particle_ml_to_state</name>
        <param>
          <type><ref refid="structparticle__simd__ml" kindref="compound">particle_simd_ml</ref> *</type>
          <declname>p_ml</declname>
        </param>
        <param>
          <type>int</type>
          <declname>j</declname>
        </param>
        <param>
          <type><ref refid="structparticle__state" kindref="compound">particle_state</ref> *</type>
          <declname>p</declname>
        </param>
        <param>
          <type><ref refid="structB__field__data" kindref="compound">B_field_data</ref> *</type>
          <declname>Bdata</declname>
        </param>
        <briefdescription>
<para>Convert ML to state. </para>
        </briefdescription>
        <detaileddescription>
<para>This function converts ML simulation marker to a marker state. No new state structure is initialized, but an existing one is filled with parameters corresponding to the converted marker.</para>
<para>Field line position is stored in both particle and guiding center position fields. Direction is stored in vpar field. rdot, phidot, zdot, mu, zeta, mass, and charge are left empty.</para>
<para>This is a SIMD function.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p_ml</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to SIMD structure </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>j</parametername>
</parameternamelist>
<parameterdescription>
<para>SIMD index of the marker to be converted </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>p</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to state whose fields are used to store the converted marker </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>Bdata</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to magnetic field data </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="particle.c" line="1059" column="6" bodyfile="particle.c" bodystart="1059" bodyend="1114"/>
      </memberdef>
      <memberdef kind="function" id="particle_8c_1a6dec81969f333737b86320b744353281" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int particle_fo_to_gc</definition>
        <argsstring>(particle_simd_fo *p_fo, int j, particle_simd_gc *p_gc, B_field_data *Bdata)</argsstring>
        <name>particle_fo_to_gc</name>
        <param>
          <type><ref refid="structparticle__simd__fo" kindref="compound">particle_simd_fo</ref> *</type>
          <declname>p_fo</declname>
        </param>
        <param>
          <type>int</type>
          <declname>j</declname>
        </param>
        <param>
          <type><ref refid="structparticle__simd__gc" kindref="compound">particle_simd_gc</ref> *</type>
          <declname>p_gc</declname>
        </param>
        <param>
          <type><ref refid="structB__field__data" kindref="compound">B_field_data</ref> *</type>
          <declname>Bdata</declname>
        </param>
        <briefdescription>
<para>Convert FO struct into a GC struct. </para>
        </briefdescription>
        <detaileddescription>
<para><xrefsect id="deprecated_1_deprecated000001"><xreftitle>Deprecated</xreftitle><xrefdescription><para>Do we need this as same can be accomplished by turning FO to state and state to GC?</para>
</xrefdescription></xrefsect></para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p_fo</parametername>
</parameternamelist>
<parameterdescription>
<para>fo SIMD structure being transformed </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>j</parametername>
</parameternamelist>
<parameterdescription>
<para>index where in the SIMD structure marker is stored </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>p_gc</parametername>
</parameternamelist>
<parameterdescription>
<para>gc SIMD structure where marker is transformed </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>Bdata</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to magnetic field data </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="particle.c" line="1127" column="5" bodyfile="particle.c" bodystart="1127" bodyend="1234"/>
      </memberdef>
      <memberdef kind="function" id="particle_8c_1afb47cf7aacb7f1d2aaae0ee5dc657229" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void particle_copy_fo</definition>
        <argsstring>(particle_simd_fo *p1, int i, particle_simd_fo *p2, int j)</argsstring>
        <name>particle_copy_fo</name>
        <param>
          <type><ref refid="structparticle__simd__fo" kindref="compound">particle_simd_fo</ref> *</type>
          <declname>p1</declname>
        </param>
        <param>
          <type>int</type>
          <declname>i</declname>
        </param>
        <param>
          <type><ref refid="structparticle__simd__fo" kindref="compound">particle_simd_fo</ref> *</type>
          <declname>p2</declname>
        </param>
        <param>
          <type>int</type>
          <declname>j</declname>
        </param>
        <briefdescription>
<para>Copy FO struct. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p1</parametername>
</parameternamelist>
<parameterdescription>
<para>SIMD structure for input </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>i</parametername>
</parameternamelist>
<parameterdescription>
<para>index for the copied input </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>p2</parametername>
</parameternamelist>
<parameterdescription>
<para>SIMD structure for output </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>j</parametername>
</parameternamelist>
<parameterdescription>
<para>index for the output slot </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="particle.c" line="1244" column="6" bodyfile="particle.c" bodystart="1244" bodyend="1287"/>
      </memberdef>
      <memberdef kind="function" id="particle_8c_1a17a485a5f6148e2aac393fc4b125a39d" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void particle_copy_gc</definition>
        <argsstring>(particle_simd_gc *p1, int i, particle_simd_gc *p2, int j)</argsstring>
        <name>particle_copy_gc</name>
        <param>
          <type><ref refid="structparticle__simd__gc" kindref="compound">particle_simd_gc</ref> *</type>
          <declname>p1</declname>
        </param>
        <param>
          <type>int</type>
          <declname>i</declname>
        </param>
        <param>
          <type><ref refid="structparticle__simd__gc" kindref="compound">particle_simd_gc</ref> *</type>
          <declname>p2</declname>
        </param>
        <param>
          <type>int</type>
          <declname>j</declname>
        </param>
        <briefdescription>
<para>Copy GC struct. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p1</parametername>
</parameternamelist>
<parameterdescription>
<para>SIMD structure for input </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>i</parametername>
</parameternamelist>
<parameterdescription>
<para>index for the copied input </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>p2</parametername>
</parameternamelist>
<parameterdescription>
<para>SIMD structure for output </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>j</parametername>
</parameternamelist>
<parameterdescription>
<para>index for the output slot </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="particle.c" line="1297" column="6" bodyfile="particle.c" bodystart="1297" bodyend="1336"/>
      </memberdef>
      <memberdef kind="function" id="particle_8c_1a9d81572e6a2d201fce505c23841214f6" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void particle_copy_ml</definition>
        <argsstring>(particle_simd_ml *p1, int i, particle_simd_ml *p2, int j)</argsstring>
        <name>particle_copy_ml</name>
        <param>
          <type><ref refid="structparticle__simd__ml" kindref="compound">particle_simd_ml</ref> *</type>
          <declname>p1</declname>
        </param>
        <param>
          <type>int</type>
          <declname>i</declname>
        </param>
        <param>
          <type><ref refid="structparticle__simd__ml" kindref="compound">particle_simd_ml</ref> *</type>
          <declname>p2</declname>
        </param>
        <param>
          <type>int</type>
          <declname>j</declname>
        </param>
        <briefdescription>
<para>Copy ML struct. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p1</parametername>
</parameternamelist>
<parameterdescription>
<para>SIMD structure for input </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>i</parametername>
</parameternamelist>
<parameterdescription>
<para>index for the copied input </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>p2</parametername>
</parameternamelist>
<parameterdescription>
<para>SIMD structure for output </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>j</parametername>
</parameternamelist>
<parameterdescription>
<para>index for the output slot </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="particle.c" line="1346" column="6" bodyfile="particle.c" bodystart="1346" bodyend="1380"/>
      </memberdef>
      <memberdef kind="function" id="particle_8c_1ab65075ed0209a55686c1009eb2041af0" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref></type>
        <definition>a5err particle_input_p_to_state</definition>
        <argsstring>(particle *p, particle_state *ps, B_field_data *Bdata)</argsstring>
        <name>particle_input_p_to_state</name>
        <param>
          <type><ref refid="structparticle" kindref="compound">particle</ref> *</type>
          <declname>p</declname>
        </param>
        <param>
          <type><ref refid="structparticle__state" kindref="compound">particle_state</ref> *</type>
          <declname>ps</declname>
        </param>
        <param>
          <type><ref refid="structB__field__data" kindref="compound">B_field_data</ref> *</type>
          <declname>Bdata</declname>
        </param>
        <briefdescription>
<para>Convert an input particle marker to particle state. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to particle marker input </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>ps</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to state where converted marker will be stored </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>Bdata</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to magnetic field data</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>zero if there was no error </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="particle.c" line="1391" column="7" bodyfile="particle.c" bodystart="1391" bodyend="1471"/>
      </memberdef>
      <memberdef kind="function" id="particle_8c_1a12ad353368240274650bbe5f702b0ec4" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref></type>
        <definition>a5err particle_input_gc_to_state</definition>
        <argsstring>(particle_gc *p, particle_state *ps, B_field_data *Bdata)</argsstring>
        <name>particle_input_gc_to_state</name>
        <param>
          <type><ref refid="structparticle__gc" kindref="compound">particle_gc</ref> *</type>
          <declname>p</declname>
        </param>
        <param>
          <type><ref refid="structparticle__state" kindref="compound">particle_state</ref> *</type>
          <declname>ps</declname>
        </param>
        <param>
          <type><ref refid="structB__field__data" kindref="compound">B_field_data</ref> *</type>
          <declname>Bdata</declname>
        </param>
        <briefdescription>
<para>Convert an input guiding center marker to particle state. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to guiding center marker input </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>ps</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to state where converted marker will be stored </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>Bdata</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to magnetic field data</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>zero if there was no error </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="particle.c" line="1482" column="7" bodyfile="particle.c" bodystart="1482" bodyend="1587"/>
      </memberdef>
      <memberdef kind="function" id="particle_8c_1a8b10f6fd186df181f734315548328fec" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref></type>
        <definition>a5err particle_input_ml_to_state</definition>
        <argsstring>(particle_ml *p, particle_state *ps, B_field_data *Bdata)</argsstring>
        <name>particle_input_ml_to_state</name>
        <param>
          <type><ref refid="structparticle__ml" kindref="compound">particle_ml</ref> *</type>
          <declname>p</declname>
        </param>
        <param>
          <type><ref refid="structparticle__state" kindref="compound">particle_state</ref> *</type>
          <declname>ps</declname>
        </param>
        <param>
          <type><ref refid="structB__field__data" kindref="compound">B_field_data</ref> *</type>
          <declname>Bdata</declname>
        </param>
        <briefdescription>
<para>Convert an input field line marker to particle state. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to field line marker input </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>ps</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to state where converted marker will be stored </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>Bdata</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to magnetic field data</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>zero if there was no error </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="particle.c" line="1598" column="7" bodyfile="particle.c" bodystart="1598" bodyend="1661"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
<para>Marker structs and conversions between them. </para>
    </briefdescription>
    <detaileddescription>
<para>ASCOT5 is a code that simulates markers.</para>
<para>This file contains functions to generate dummy markers, fetching markers from the marker queue, and handles conversions between various marker structs.</para>
<para>The relationship between the seven different marker structs is:</para>
<para>particle &gt;<ndash/>+ +--&gt; <ref refid="structparticle__simd__fo" kindref="compound">particle_simd_fo</ref> | | <ref refid="structparticle__gc" kindref="compound">particle_gc</ref> &gt;<ndash/>particle_state--&gt; <ref refid="structparticle__simd__gc" kindref="compound">particle_simd_gc</ref> | | <ref refid="structparticle__ml" kindref="compound">particle_ml</ref> &gt;<ndash/>+ +--&gt; <ref refid="structparticle__simd__ml" kindref="compound">particle_simd_ml</ref></para>
<para>The structs on the left are input structs which are constructed when marker data is read. These structs must be independend of any other input data. A consistent representation of markers is provided by <ref refid="structparticle__state" kindref="compound">particle_state</ref> which can be constructed from any type of input marker.</para>
<para>Particle state can be used to obtain any information from marker physical quantities such as guiding center energy, which requires one knows both guiding center magnetic moment and local magnetic field value. All markers are represented by particle state when simulation begins and again when simulation ends.</para>
<para>During simulation, markers are represented by a SIMD compatible structure (all fields in these structs are NSIMD long arrays representing NSIMD markers), and the type of SIMD structure depends on the simulation type: whether simulation models markers as particles, guiding centers or field lines. Each simulation struct can be constructed from particle state.</para>
<para>So in principle, one can have any type of marker input and still use any kind of simulation method, e.g. input can be guiding centers but these can be modelled as particles, or to be precise, the particles are modelled whose guiding centers are given as inputs.</para>
<para>Exception to this rule: field line input can only be used to simulate field lines as field lines have no mass.</para>
<para>If one is to implement a new simulation mode, e.g. particle simulation in Boozer coordinates, one is advised to implement a new marker struct for it. </para>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="normal"></highlight></codeline>
<codeline lineno="47"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdio.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="48"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdlib.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="49"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="math_8h" kindref="compound">math.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="50"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="ascot5_8h" kindref="compound">ascot5.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="51"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="error_8h" kindref="compound">error.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="consts_8h" kindref="compound">consts.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="53"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="math_8h" kindref="compound">math.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="physlib_8h" kindref="compound">physlib.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="55"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="gctransform_8h" kindref="compound">gctransform.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="particle_8h" kindref="compound">particle.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="B__field_8h" kindref="compound">B_field.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="58"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="E__field_8h" kindref="compound">E_field.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="59"><highlight class="normal"></highlight></codeline>
<codeline lineno="74" refid="particle_8c_1a5b1269a856de55b03a59d06df3ee3113" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="particle_8c_1a5b1269a856de55b03a59d06df3ee3113" kindref="member">particle_to_fo_dummy</ref>(<ref refid="structparticle__simd__fo" kindref="compound">particle_simd_fo</ref>*<sp/>p_fo,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j){</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/>p_fo-&gt;r[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/>p_fo-&gt;phi[j]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/>p_fo-&gt;z[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/>p_fo-&gt;p_r[j]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/>p_fo-&gt;p_phi[j]<sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/>p_fo-&gt;p_z[j]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/>p_fo-&gt;mass[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/>p_fo-&gt;charge[j]<sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/>p_fo-&gt;znum[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/>p_fo-&gt;anum[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/>p_fo-&gt;bounces[j]<sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/>p_fo-&gt;weight[j]<sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/>p_fo-&gt;time[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/>p_fo-&gt;id[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/>p_fo-&gt;mileage[j]<sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/>p_fo-&gt;running[j]<sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/>p_fo-&gt;endcond[j]<sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/>p_fo-&gt;walltile[j]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/>p_fo-&gt;B_r[j]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/>p_fo-&gt;B_phi[j]<sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/>p_fo-&gt;B_z[j]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/>p_fo-&gt;index[j]<sp/><sp/><sp/><sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/>p_fo-&gt;err[j]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="98"><highlight class="normal">}</highlight></codeline>
<codeline lineno="99"><highlight class="normal"></highlight></codeline>
<codeline lineno="114" refid="particle_8c_1a9811038a60f0e1525fca6dc9f9a6a150" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="particle_8c_1a9811038a60f0e1525fca6dc9f9a6a150" kindref="member">particle_to_gc_dummy</ref>(<ref refid="structparticle__simd__gc" kindref="compound">particle_simd_gc</ref>*<sp/>p_gc,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j)<sp/>{</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;r[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;phi[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;z[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;ppar[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;mu[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;zeta[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;mass[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;charge[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;time[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;bounces[j]<sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;weight[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;id[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;mileage[j]<sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;B_r[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;B_r_dr[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;B_r_dphi[j]<sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;B_r_dz[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="132"><highlight class="normal"></highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;B_phi[j]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;B_phi_dr[j]<sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;B_phi_dphi[j]<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;B_phi_dz[j]<sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="137"><highlight class="normal"></highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;B_z[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;B_z_dr[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;B_z_dphi[j]<sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;B_z_dz[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;index[j]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;err[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="144"><highlight class="normal">}</highlight></codeline>
<codeline lineno="145"><highlight class="normal"></highlight></codeline>
<codeline lineno="160" refid="particle_8c_1a0bff4063646ea64c569a51f947c81475" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="particle_8c_1a0bff4063646ea64c569a51f947c81475" kindref="member">particle_to_ml_dummy</ref>(<ref refid="structparticle__simd__ml" kindref="compound">particle_simd_ml</ref>*<sp/>p_ml,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j){</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/>p_ml-&gt;r[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/>p_ml-&gt;phi[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/>p_ml-&gt;z[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/>p_ml-&gt;time[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/>p_ml-&gt;id[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/>p_ml-&gt;mileage[j]<sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/>p_ml-&gt;B_r[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/>p_ml-&gt;B_r_dr[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/>p_ml-&gt;B_r_dphi[j]<sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/>p_ml-&gt;B_r_dz[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="171"><highlight class="normal"></highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/>p_ml-&gt;B_phi[j]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/>p_ml-&gt;B_phi_dr[j]<sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/>p_ml-&gt;B_phi_dphi[j]<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/>p_ml-&gt;B_phi_dz[j]<sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="176"><highlight class="normal"></highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/>p_ml-&gt;B_z[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/>p_ml-&gt;B_z_dr[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/>p_ml-&gt;B_z_dphi[j]<sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/>p_ml-&gt;B_z_dz[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/>p_ml-&gt;index[j]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/>p_ml-&gt;err[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="183"><highlight class="normal">}</highlight></codeline>
<codeline lineno="184"><highlight class="normal"></highlight></codeline>
<codeline lineno="210" refid="particle_8c_1af053259c1f06721bbbbe61baaa0facb0" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="particle_8c_1af053259c1f06721bbbbe61baaa0facb0" kindref="member">particle_cycle_fo</ref>(<ref refid="structparticle__queue" kindref="compound">particle_queue</ref>*<sp/>q,<sp/><ref refid="structparticle__simd__fo" kindref="compound">particle_simd_fo</ref>*<sp/>p,</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structB__field__data" kindref="compound">B_field_data</ref>*<sp/>Bdata,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal">*<sp/>cycle)<sp/>{</highlight></codeline>
<codeline lineno="212"><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Loop<sp/>over<sp/>markers.</highlight></codeline>
<codeline lineno="214"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>A<sp/>SIMD<sp/>loop<sp/>is<sp/>not<sp/>possible<sp/>as<sp/>we<sp/>modify<sp/>the<sp/>queue.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="ascot5_8h_1a6368ab06bbb536b220a367552186bbab" kindref="member">NSIMD</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="216"><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>First<sp/>check<sp/>whether<sp/>we<sp/>should<sp/>pick<sp/>a<sp/>new<sp/>marker<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>newmarker<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="219"><highlight class="normal"></highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>1.<sp/>There<sp/>are<sp/>markers<sp/>in<sp/>queue<sp/>and<sp/>this<sp/>marker<sp/>is<sp/>dummy<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(p-&gt;id[i]<sp/>&lt;<sp/>0<sp/>&amp;&amp;<sp/>q-&gt;<ref refid="structparticle__queue_1ab46285cd292490bcf7adb93d147df99e" kindref="member">next</ref><sp/>&lt;<sp/>q-&gt;<ref refid="structparticle__queue_1af86da1478db0cc051aaf7d51d3d1a2b8" kindref="member">n</ref>)<sp/>{</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newmarker<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="224"><highlight class="normal"></highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>2.<sp/>This<sp/>marker<sp/>has<sp/>finished<sp/>simulation<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!p-&gt;running[i]<sp/>&amp;&amp;<sp/>p-&gt;id[i]<sp/>&gt;=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Convert<sp/>finished<sp/>marker<sp/>to<sp/>state</highlight></codeline>
<codeline lineno="228"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>and<sp/>store<sp/>it<sp/>back<sp/>to<sp/>the<sp/>queue<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="particle_8c_1a308eb43a7cb3aead97315dd1020aae9d" kindref="member">particle_fo_to_state</ref>(p,<sp/>i,<sp/>q-&gt;<ref refid="structparticle__queue_1a2dd6f6f1de06a359c46b0f6d7545c63a" kindref="member">p</ref>[p-&gt;index[i]],<sp/>Bdata);</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newmarker<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="231"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#pragma<sp/>omp<sp/>critical</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>q-&gt;<ref refid="structparticle__queue_1ad5cc76df822bf1425819520c18f573ff" kindref="member">finished</ref>++;</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="234"><highlight class="normal"></highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Init<sp/>a<sp/>new<sp/>marker<sp/>if<sp/>one<sp/>is<sp/>needed<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cycle[i]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal">(newmarker)<sp/>{</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Get<sp/>the<sp/>next<sp/>unsimulated<sp/>marker<sp/>from<sp/>the<sp/>queue<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i_prt;</highlight></codeline>
<codeline lineno="240"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#pragma<sp/>omp<sp/>critical</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i_prt<sp/>=<sp/>q-&gt;<ref refid="structparticle__queue_1ab46285cd292490bcf7adb93d147df99e" kindref="member">next</ref>++;</highlight></codeline>
<codeline lineno="242"><highlight class="normal"></highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(i_prt<sp/>&gt;=<sp/>q-&gt;<ref refid="structparticle__queue_1af86da1478db0cc051aaf7d51d3d1a2b8" kindref="member">n</ref>)<sp/>{</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>The<sp/>queue<sp/>is<sp/>empty,<sp/>place<sp/>a<sp/>dummy<sp/>marker<sp/>here<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p-&gt;running[i]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p-&gt;id[i]<sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cycle[i]<sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newmarker<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(q-&gt;<ref refid="structparticle__queue_1a2dd6f6f1de06a359c46b0f6d7545c63a" kindref="member">p</ref>[i_prt]-&gt;<ref refid="structparticle__state_1afba5ec956f0515668cba944ce1f02daf" kindref="member">endcond</ref>)<sp/>{</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>This<sp/>marker<sp/>already<sp/>has<sp/>an<sp/>active<sp/>end<sp/>condition.<sp/>Try<sp/>next.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="252"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#pragma<sp/>omp<sp/>critical</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>q-&gt;<ref refid="structparticle__queue_1ad5cc76df822bf1425819520c18f573ff" kindref="member">finished</ref>++;</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Try<sp/>to<sp/>convert<sp/>marker<sp/>state<sp/>to<sp/>a<sp/>simulation<sp/>marker<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/>err<sp/>=<sp/><ref refid="particle_8c_1a275c199f15c1a8f46a48decfb6908b71" kindref="member">particle_state_to_fo</ref>(</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>q-&gt;<ref refid="structparticle__queue_1a2dd6f6f1de06a359c46b0f6d7545c63a" kindref="member">p</ref>[i_prt],<sp/>i_prt,<sp/>p,<sp/>i,<sp/>Bdata);</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(err)<sp/>{</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Failed!<sp/>Mark<sp/>the<sp/>marker<sp/>candidate<sp/>as<sp/>finished</highlight></codeline>
<codeline lineno="261"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>and<sp/>try<sp/>with<sp/>a<sp/>new<sp/>marker<sp/>state*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>q-&gt;<ref refid="structparticle__queue_1a2dd6f6f1de06a359c46b0f6d7545c63a" kindref="member">p</ref>[i_prt]-&gt;<ref refid="structparticle__state_1abefd34d479201d01ff36e4497def613d" kindref="member">err</ref><sp/>=<sp/>err;</highlight></codeline>
<codeline lineno="263"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#pragma<sp/>omp<sp/>critical</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>q-&gt;<ref refid="structparticle__queue_1ad5cc76df822bf1425819520c18f573ff" kindref="member">finished</ref>++;</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Success!<sp/>We<sp/>are<sp/>good<sp/>to<sp/>go.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cycle[i]<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newmarker<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="274"><highlight class="normal"></highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n_running<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="276"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/>#pragma<sp/>omp<sp/>simd<sp/>reduction(+:n_running)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="ascot5_8h_1a6368ab06bbb536b220a367552186bbab" kindref="member">NSIMD</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>n_running<sp/>+=<sp/>p-&gt;running[i];</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="280"><highlight class="normal"></highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>n_running;</highlight></codeline>
<codeline lineno="282"><highlight class="normal">}</highlight></codeline>
<codeline lineno="283"><highlight class="normal"></highlight></codeline>
<codeline lineno="309" refid="particle_8c_1ae9a00100d11547e28826c5c2e0ff7372" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="particle_8c_1ae9a00100d11547e28826c5c2e0ff7372" kindref="member">particle_cycle_gc</ref>(<ref refid="structparticle__queue" kindref="compound">particle_queue</ref>*<sp/>q,<sp/><ref refid="structparticle__simd__gc" kindref="compound">particle_simd_gc</ref>*<sp/>p,</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structB__field__data" kindref="compound">B_field_data</ref>*<sp/>Bdata,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal">*<sp/>cycle)<sp/>{</highlight></codeline>
<codeline lineno="311"><highlight class="normal"></highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Loop<sp/>over<sp/>markers.</highlight></codeline>
<codeline lineno="313"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>A<sp/>SIMD<sp/>loop<sp/>is<sp/>not<sp/>possible<sp/>as<sp/>we<sp/>modify<sp/>the<sp/>queue.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="ascot5_8h_1a6368ab06bbb536b220a367552186bbab" kindref="member">NSIMD</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="315"><highlight class="normal"></highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>First<sp/>check<sp/>whether<sp/>we<sp/>should<sp/>pick<sp/>a<sp/>new<sp/>marker<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>newmarker<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="318"><highlight class="normal"></highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>1.<sp/>There<sp/>are<sp/>markers<sp/>in<sp/>queue<sp/>and<sp/>this<sp/>marker<sp/>is<sp/>dummy<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(p-&gt;id[i]<sp/>&lt;<sp/>0<sp/>&amp;&amp;<sp/>q-&gt;<ref refid="structparticle__queue_1ab46285cd292490bcf7adb93d147df99e" kindref="member">next</ref><sp/>&lt;<sp/>q-&gt;<ref refid="structparticle__queue_1af86da1478db0cc051aaf7d51d3d1a2b8" kindref="member">n</ref>)<sp/>{</highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newmarker<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="323"><highlight class="normal"></highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>2.<sp/>This<sp/>marker<sp/>has<sp/>finished<sp/>simulation<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!p-&gt;running[i]<sp/>&amp;&amp;<sp/>p-&gt;id[i]<sp/>&gt;=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Convert<sp/>finished<sp/>marker<sp/>to<sp/>state</highlight></codeline>
<codeline lineno="327"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>and<sp/>store<sp/>it<sp/>back<sp/>to<sp/>the<sp/>queue<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="particle_8c_1a10627ba7787e16ac8b87afcf55d82c61" kindref="member">particle_gc_to_state</ref>(p,<sp/>i,<sp/>q-&gt;<ref refid="structparticle__queue_1a2dd6f6f1de06a359c46b0f6d7545c63a" kindref="member">p</ref>[p-&gt;index[i]],<sp/>Bdata);</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newmarker<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="330"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#pragma<sp/>omp<sp/>critical</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>q-&gt;<ref refid="structparticle__queue_1ad5cc76df822bf1425819520c18f573ff" kindref="member">finished</ref>++;</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="333"><highlight class="normal"></highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Init<sp/>a<sp/>new<sp/>marker<sp/>if<sp/>one<sp/>is<sp/>needed<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cycle[i]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal">(newmarker)<sp/>{</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Get<sp/>the<sp/>next<sp/>unsimulated<sp/>marker<sp/>from<sp/>the<sp/>queue<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i_prt;</highlight></codeline>
<codeline lineno="339"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#pragma<sp/>omp<sp/>critical</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i_prt<sp/>=<sp/>q-&gt;<ref refid="structparticle__queue_1ab46285cd292490bcf7adb93d147df99e" kindref="member">next</ref>++;</highlight></codeline>
<codeline lineno="341"><highlight class="normal"></highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(i_prt<sp/>&gt;=<sp/>q-&gt;<ref refid="structparticle__queue_1af86da1478db0cc051aaf7d51d3d1a2b8" kindref="member">n</ref>)<sp/>{</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>The<sp/>queue<sp/>is<sp/>empty,<sp/>place<sp/>a<sp/>dummy<sp/>marker<sp/>here<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p-&gt;running[i]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p-&gt;id[i]<sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cycle[i]<sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newmarker<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Try<sp/>to<sp/>convert<sp/>marker<sp/>state<sp/>to<sp/>a<sp/>simulation<sp/>marker<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/>err<sp/>=<sp/><ref refid="particle_8c_1a217333f14fa85b8882738f804346c493" kindref="member">particle_state_to_gc</ref>(</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>q-&gt;<ref refid="structparticle__queue_1a2dd6f6f1de06a359c46b0f6d7545c63a" kindref="member">p</ref>[i_prt],<sp/>i_prt,<sp/>p,<sp/>i,<sp/>Bdata);</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(err)<sp/>{</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Failed!<sp/>Mark<sp/>the<sp/>marker<sp/>candidate<sp/>as<sp/>finished</highlight></codeline>
<codeline lineno="355"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>and<sp/>try<sp/>with<sp/>a<sp/>new<sp/>marker<sp/>state*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>q-&gt;<ref refid="structparticle__queue_1a2dd6f6f1de06a359c46b0f6d7545c63a" kindref="member">p</ref>[i_prt]-&gt;<ref refid="structparticle__state_1abefd34d479201d01ff36e4497def613d" kindref="member">err</ref><sp/>=<sp/>err;</highlight></codeline>
<codeline lineno="357"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#pragma<sp/>omp<sp/>critical</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>q-&gt;<ref refid="structparticle__queue_1ad5cc76df822bf1425819520c18f573ff" kindref="member">finished</ref>++;</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Success!<sp/>We<sp/>are<sp/>good<sp/>to<sp/>go.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cycle[i]<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newmarker<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="368"><highlight class="normal"></highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n_running<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="370"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/>#pragma<sp/>omp<sp/>simd<sp/>reduction(+:n_running)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="ascot5_8h_1a6368ab06bbb536b220a367552186bbab" kindref="member">NSIMD</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>n_running<sp/>+=<sp/>p-&gt;running[i];</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="374"><highlight class="normal"></highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>n_running;</highlight></codeline>
<codeline lineno="376"><highlight class="normal">}</highlight></codeline>
<codeline lineno="377"><highlight class="normal"></highlight></codeline>
<codeline lineno="403" refid="particle_8c_1ac5fcdf3eb124f6caa4e4b748e3449ee2" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="particle_8c_1ac5fcdf3eb124f6caa4e4b748e3449ee2" kindref="member">particle_cycle_ml</ref>(<ref refid="structparticle__queue" kindref="compound">particle_queue</ref>*<sp/>q,<sp/><ref refid="structparticle__simd__ml" kindref="compound">particle_simd_ml</ref>*<sp/>p,</highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structB__field__data" kindref="compound">B_field_data</ref>*<sp/>Bdata,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal">*<sp/>cycle)<sp/>{</highlight></codeline>
<codeline lineno="405"><highlight class="normal"></highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Loop<sp/>over<sp/>markers.</highlight></codeline>
<codeline lineno="407"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>A<sp/>SIMD<sp/>loop<sp/>is<sp/>not<sp/>possible<sp/>as<sp/>we<sp/>modify<sp/>the<sp/>queue.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="ascot5_8h_1a6368ab06bbb536b220a367552186bbab" kindref="member">NSIMD</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="409"><highlight class="normal"></highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>First<sp/>check<sp/>whether<sp/>we<sp/>should<sp/>pick<sp/>a<sp/>new<sp/>marker<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>newmarker<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="412"><highlight class="normal"></highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>1.<sp/>There<sp/>are<sp/>markers<sp/>in<sp/>queue<sp/>and<sp/>this<sp/>marker<sp/>is<sp/>dummy<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(p-&gt;id[i]<sp/>&lt;<sp/>0<sp/>&amp;&amp;<sp/>q-&gt;<ref refid="structparticle__queue_1ab46285cd292490bcf7adb93d147df99e" kindref="member">next</ref><sp/>&lt;<sp/>q-&gt;<ref refid="structparticle__queue_1af86da1478db0cc051aaf7d51d3d1a2b8" kindref="member">n</ref>)<sp/>{</highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newmarker<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="417"><highlight class="normal"></highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>2.<sp/>This<sp/>marker<sp/>has<sp/>finished<sp/>simulation<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!p-&gt;running[i]<sp/>&amp;&amp;<sp/>p-&gt;id[i]<sp/>&gt;=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Convert<sp/>finished<sp/>marker<sp/>to<sp/>state</highlight></codeline>
<codeline lineno="421"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>and<sp/>store<sp/>it<sp/>back<sp/>to<sp/>the<sp/>queue<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="particle_8c_1ae5b0e6f269fe140fbb8f00b96e7aa7a9" kindref="member">particle_ml_to_state</ref>(p,<sp/>i,<sp/>q-&gt;<ref refid="structparticle__queue_1a2dd6f6f1de06a359c46b0f6d7545c63a" kindref="member">p</ref>[p-&gt;index[i]],<sp/>Bdata);</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newmarker<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="424"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#pragma<sp/>omp<sp/>critical</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>q-&gt;<ref refid="structparticle__queue_1ad5cc76df822bf1425819520c18f573ff" kindref="member">finished</ref>++;</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="427"><highlight class="normal"></highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Init<sp/>a<sp/>new<sp/>marker<sp/>if<sp/>one<sp/>is<sp/>needed<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cycle[i]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal">(newmarker)<sp/>{</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Get<sp/>the<sp/>next<sp/>unsimulated<sp/>marker<sp/>from<sp/>the<sp/>queue<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i_prt;</highlight></codeline>
<codeline lineno="433"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#pragma<sp/>omp<sp/>critical</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i_prt<sp/>=<sp/>q-&gt;<ref refid="structparticle__queue_1ab46285cd292490bcf7adb93d147df99e" kindref="member">next</ref>++;</highlight></codeline>
<codeline lineno="435"><highlight class="normal"></highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(i_prt<sp/>&gt;=<sp/>q-&gt;<ref refid="structparticle__queue_1af86da1478db0cc051aaf7d51d3d1a2b8" kindref="member">n</ref>)<sp/>{</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>The<sp/>queue<sp/>is<sp/>empty,<sp/>place<sp/>a<sp/>dummy<sp/>marker<sp/>here<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p-&gt;running[i]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p-&gt;id[i]<sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cycle[i]<sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newmarker<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Try<sp/>to<sp/>convert<sp/>marker<sp/>state<sp/>to<sp/>a<sp/>simulation<sp/>marker<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/>err<sp/>=<sp/><ref refid="particle_8c_1aaa3116ddab1b53462a5c7d7c98dcf839" kindref="member">particle_state_to_ml</ref>(</highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>q-&gt;<ref refid="structparticle__queue_1a2dd6f6f1de06a359c46b0f6d7545c63a" kindref="member">p</ref>[i_prt],<sp/>i_prt,<sp/>p,<sp/>i,<sp/>Bdata);</highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(err)<sp/>{</highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Failed!<sp/>Mark<sp/>the<sp/>marker<sp/>candidate<sp/>as<sp/>finished</highlight></codeline>
<codeline lineno="449"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>and<sp/>try<sp/>with<sp/>a<sp/>new<sp/>marker<sp/>state*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>q-&gt;<ref refid="structparticle__queue_1a2dd6f6f1de06a359c46b0f6d7545c63a" kindref="member">p</ref>[i_prt]-&gt;<ref refid="structparticle__state_1abefd34d479201d01ff36e4497def613d" kindref="member">err</ref><sp/>=<sp/>err;</highlight></codeline>
<codeline lineno="451"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#pragma<sp/>omp<sp/>critical</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>q-&gt;<ref refid="structparticle__queue_1ad5cc76df822bf1425819520c18f573ff" kindref="member">finished</ref>++;</highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Success!<sp/>We<sp/>are<sp/>good<sp/>to<sp/>go.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cycle[i]<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newmarker<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="462"><highlight class="normal"></highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n_running<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="464"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/>#pragma<sp/>omp<sp/>simd<sp/>reduction(+:n_running)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="ascot5_8h_1a6368ab06bbb536b220a367552186bbab" kindref="member">NSIMD</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>n_running<sp/>+=<sp/>p-&gt;running[i];</highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="468"><highlight class="normal"></highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>n_running;</highlight></codeline>
<codeline lineno="470"><highlight class="normal">}</highlight></codeline>
<codeline lineno="471"><highlight class="normal"></highlight></codeline>
<codeline lineno="492" refid="particle_8c_1a8e96bcfc9c95b76f3c91663e34a43b01" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="particle_8c_1a8e96bcfc9c95b76f3c91663e34a43b01" kindref="member">particle_input_to_state</ref>(<ref refid="structinput__particle" kindref="compound">input_particle</ref>*<sp/>p,<sp/><ref refid="structparticle__state" kindref="compound">particle_state</ref>*<sp/>ps,</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structB__field__data" kindref="compound">B_field_data</ref>*<sp/>Bdata)<sp/>{</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/>err<sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a865b01f4cbb6f2bb3270e094934d3263" kindref="member">integer</ref><sp/></highlight><highlight class="keywordtype">id</highlight><highlight class="normal"><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="496"><highlight class="normal"></highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(p-&gt;<ref refid="structinput__particle_1a71c8abbe87f5c140c204faa483b76cd3" kindref="member">type</ref><sp/>==<sp/><ref refid="particle_8h_1ad9e26d23f507828132c597fb21168ce2a34901e67dd3e18e147710cbab59bfc87" kindref="member">input_particle_type_p</ref>)<sp/>{</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Check<sp/>that<sp/>input<sp/>is<sp/>valid<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err<sp/>&amp;&amp;<sp/>p-&gt;<ref refid="structinput__particle_1aa2cb232cc6b104a529619f0d369f5622" kindref="member">p</ref>.<ref refid="structparticle_1a91589c36968e810182fc94133eef3c02" kindref="member">r</ref><sp/>&lt;=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92a009d0727e7fb6bdffc7ea94fe04c4903" kindref="member">ERR_MARKER_UNPHYSICAL</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddaf1cf6bea1dd479b3f3efaaedf3637ecd" kindref="member">EF_PARTICLE</ref>);</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err<sp/>&amp;&amp;<sp/>p-&gt;<ref refid="structinput__particle_1aa2cb232cc6b104a529619f0d369f5622" kindref="member">p</ref>.<ref refid="structparticle_1a91fbaab5de85465656bc523801280cdf" kindref="member">mass</ref><sp/>&lt;=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92a009d0727e7fb6bdffc7ea94fe04c4903" kindref="member">ERR_MARKER_UNPHYSICAL</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddaf1cf6bea1dd479b3f3efaaedf3637ecd" kindref="member">EF_PARTICLE</ref>);</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err<sp/>&amp;&amp;<sp/>p-&gt;<ref refid="structinput__particle_1aa2cb232cc6b104a529619f0d369f5622" kindref="member">p</ref>.<ref refid="structparticle_1a41682650216e3bae370addda7f7b9c1f" kindref="member">weight</ref><sp/>&lt;=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92a009d0727e7fb6bdffc7ea94fe04c4903" kindref="member">ERR_MARKER_UNPHYSICAL</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddaf1cf6bea1dd479b3f3efaaedf3637ecd" kindref="member">EF_PARTICLE</ref>);</highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err<sp/>&amp;&amp;<sp/>p-&gt;<ref refid="structinput__particle_1aa2cb232cc6b104a529619f0d369f5622" kindref="member">p</ref>.<ref refid="structparticle_1ad8132c4b267fb25d3bfda3306d06e6c3" kindref="member">id</ref><sp/>&lt;=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92a009d0727e7fb6bdffc7ea94fe04c4903" kindref="member">ERR_MARKER_UNPHYSICAL</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddaf1cf6bea1dd479b3f3efaaedf3637ecd" kindref="member">EF_PARTICLE</ref>);</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="511"><highlight class="normal"></highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Particle<sp/>to<sp/>state<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structinput__particle_1a71c8abbe87f5c140c204faa483b76cd3" kindref="member">type</ref><sp/>=<sp/><ref refid="particle_8h_1ad9e26d23f507828132c597fb21168ce2ac5643fe6eadc1ee9a3cda67ea8cfa251" kindref="member">input_particle_type_s</ref>;</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">id</highlight><highlight class="normal"><sp/>=<sp/>p-&gt;<ref refid="structinput__particle_1aa2cb232cc6b104a529619f0d369f5622" kindref="member">p</ref>.<ref refid="structparticle_1ad8132c4b267fb25d3bfda3306d06e6c3" kindref="member">id</ref>;</highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="particle_8c_1ab65075ed0209a55686c1009eb2041af0" kindref="member">particle_input_p_to_state</ref>(&amp;p-&gt;<ref refid="structinput__particle_1aa2cb232cc6b104a529619f0d369f5622" kindref="member">p</ref>,<sp/>ps,<sp/>Bdata);</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(p-&gt;<ref refid="structinput__particle_1a71c8abbe87f5c140c204faa483b76cd3" kindref="member">type</ref><sp/>==<sp/><ref refid="particle_8h_1ad9e26d23f507828132c597fb21168ce2a20d323bd4e978ec48217876c3437112c" kindref="member">input_particle_type_gc</ref>)<sp/>{</highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Check<sp/>that<sp/>input<sp/>is<sp/>valid<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err<sp/>&amp;&amp;<sp/>p-&gt;<ref refid="structinput__particle_1aa6c024538cbd13632c677ed21d58e0f6" kindref="member">p_gc</ref>.<ref refid="structparticle__gc_1ae76b26b01bca6ea35f9297963cf382f6" kindref="member">r</ref><sp/>&lt;=<sp/>0)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92a009d0727e7fb6bdffc7ea94fe04c4903" kindref="member">ERR_MARKER_UNPHYSICAL</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddaf1cf6bea1dd479b3f3efaaedf3637ecd" kindref="member">EF_PARTICLE</ref>);</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err<sp/>&amp;&amp;<sp/>fabs(p-&gt;<ref refid="structinput__particle_1aa6c024538cbd13632c677ed21d58e0f6" kindref="member">p_gc</ref>.<ref refid="structparticle__gc_1a87b3fe581ea9fa7081499876b3ccfe42" kindref="member">pitch</ref>)<sp/>&gt;<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92a009d0727e7fb6bdffc7ea94fe04c4903" kindref="member">ERR_MARKER_UNPHYSICAL</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddaf1cf6bea1dd479b3f3efaaedf3637ecd" kindref="member">EF_PARTICLE</ref>);</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err<sp/>&amp;&amp;<sp/>p-&gt;<ref refid="structinput__particle_1aa6c024538cbd13632c677ed21d58e0f6" kindref="member">p_gc</ref>.<ref refid="structparticle__gc_1a54b77f0fa9cd14177c8bf5914574cd9a" kindref="member">energy</ref><sp/>&lt;=<sp/>0)<sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92a009d0727e7fb6bdffc7ea94fe04c4903" kindref="member">ERR_MARKER_UNPHYSICAL</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddaf1cf6bea1dd479b3f3efaaedf3637ecd" kindref="member">EF_PARTICLE</ref>);</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err<sp/>&amp;&amp;<sp/>p-&gt;<ref refid="structinput__particle_1aa6c024538cbd13632c677ed21d58e0f6" kindref="member">p_gc</ref>.<ref refid="structparticle__gc_1ae27701c7ad3396abab1669c6a9bd1b9a" kindref="member">mass</ref><sp/>&lt;=<sp/>0)<sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92a009d0727e7fb6bdffc7ea94fe04c4903" kindref="member">ERR_MARKER_UNPHYSICAL</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddaf1cf6bea1dd479b3f3efaaedf3637ecd" kindref="member">EF_PARTICLE</ref>);</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err<sp/>&amp;&amp;<sp/>p-&gt;<ref refid="structinput__particle_1aa6c024538cbd13632c677ed21d58e0f6" kindref="member">p_gc</ref>.<ref refid="structparticle__gc_1a17660a9dd269c9039ad120d39f6ce9aa" kindref="member">weight</ref><sp/>&lt;=<sp/>0)<sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92a009d0727e7fb6bdffc7ea94fe04c4903" kindref="member">ERR_MARKER_UNPHYSICAL</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddaf1cf6bea1dd479b3f3efaaedf3637ecd" kindref="member">EF_PARTICLE</ref>);</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err<sp/>&amp;&amp;<sp/>p-&gt;<ref refid="structinput__particle_1aa6c024538cbd13632c677ed21d58e0f6" kindref="member">p_gc</ref>.<ref refid="structparticle__gc_1a566721bfbb323454d735f61d80eebfbd" kindref="member">id</ref><sp/>&lt;=<sp/>0)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92a009d0727e7fb6bdffc7ea94fe04c4903" kindref="member">ERR_MARKER_UNPHYSICAL</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddaf1cf6bea1dd479b3f3efaaedf3637ecd" kindref="member">EF_PARTICLE</ref>);</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="539"><highlight class="normal"></highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Guiding<sp/>center<sp/>to<sp/>state<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structinput__particle_1a71c8abbe87f5c140c204faa483b76cd3" kindref="member">type</ref><sp/>=<sp/><ref refid="particle_8h_1ad9e26d23f507828132c597fb21168ce2ac5643fe6eadc1ee9a3cda67ea8cfa251" kindref="member">input_particle_type_s</ref>;</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">id</highlight><highlight class="normal"><sp/>=<sp/>p-&gt;<ref refid="structinput__particle_1aa6c024538cbd13632c677ed21d58e0f6" kindref="member">p_gc</ref>.<ref refid="structparticle__gc_1a566721bfbb323454d735f61d80eebfbd" kindref="member">id</ref>;</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="particle_8c_1a12ad353368240274650bbe5f702b0ec4" kindref="member">particle_input_gc_to_state</ref>(&amp;p-&gt;<ref refid="structinput__particle_1aa6c024538cbd13632c677ed21d58e0f6" kindref="member">p_gc</ref>,<sp/>ps,<sp/>Bdata);</highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(p-&gt;<ref refid="structinput__particle_1a71c8abbe87f5c140c204faa483b76cd3" kindref="member">type</ref><sp/>==<sp/><ref refid="particle_8h_1ad9e26d23f507828132c597fb21168ce2a62ff5d32478ecfa8278a8febf89f7c6e" kindref="member">input_particle_type_ml</ref>)<sp/>{</highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Check<sp/>that<sp/>input<sp/>is<sp/>valid<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err<sp/>&amp;&amp;<sp/>p-&gt;<ref refid="structinput__particle_1a2579b051b276ceb8b5a3892167c08667" kindref="member">p_ml</ref>.<ref refid="structparticle__ml_1a5e08192d0450f97c6dc635a71d5d6ec0" kindref="member">r</ref><sp/>&lt;=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92a009d0727e7fb6bdffc7ea94fe04c4903" kindref="member">ERR_MARKER_UNPHYSICAL</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddaf1cf6bea1dd479b3f3efaaedf3637ecd" kindref="member">EF_PARTICLE</ref>);</highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err<sp/>&amp;&amp;<sp/>p-&gt;<ref refid="structinput__particle_1a2579b051b276ceb8b5a3892167c08667" kindref="member">p_ml</ref>.<ref refid="structparticle__ml_1af660d4a268dd37b8a2307bcd360c3d5f" kindref="member">weight</ref><sp/>&lt;=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92a009d0727e7fb6bdffc7ea94fe04c4903" kindref="member">ERR_MARKER_UNPHYSICAL</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddaf1cf6bea1dd479b3f3efaaedf3637ecd" kindref="member">EF_PARTICLE</ref>);</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err<sp/>&amp;&amp;<sp/>p-&gt;<ref refid="structinput__particle_1a2579b051b276ceb8b5a3892167c08667" kindref="member">p_ml</ref>.<ref refid="structparticle__ml_1afdd7be2e06ee4366b05ae7fd4705e7f9" kindref="member">id</ref><sp/>&lt;=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92a009d0727e7fb6bdffc7ea94fe04c4903" kindref="member">ERR_MARKER_UNPHYSICAL</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddaf1cf6bea1dd479b3f3efaaedf3637ecd" kindref="member">EF_PARTICLE</ref>);</highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="558"><highlight class="normal"></highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Magnetic<sp/>field<sp/>line<sp/>to<sp/>state<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structinput__particle_1a71c8abbe87f5c140c204faa483b76cd3" kindref="member">type</ref><sp/>=<sp/><ref refid="particle_8h_1ad9e26d23f507828132c597fb21168ce2ac5643fe6eadc1ee9a3cda67ea8cfa251" kindref="member">input_particle_type_s</ref>;</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">id</highlight><highlight class="normal"><sp/>=<sp/>p-&gt;<ref refid="structinput__particle_1a2579b051b276ceb8b5a3892167c08667" kindref="member">p_ml</ref>.<ref refid="structparticle__ml_1afdd7be2e06ee4366b05ae7fd4705e7f9" kindref="member">id</ref>;</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="particle_8c_1a8b10f6fd186df181f734315548328fec" kindref="member">particle_input_ml_to_state</ref>(&amp;p-&gt;<ref refid="structinput__particle_1a2579b051b276ceb8b5a3892167c08667" kindref="member">p_ml</ref>,<sp/>ps,<sp/>Bdata);</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="566"><highlight class="normal"></highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>If<sp/>particle<sp/>was<sp/>rejected,<sp/>ensure<sp/>that<sp/>these<sp/>fields<sp/>are<sp/>filled<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(err)<sp/>{</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a47d5709d5e17ec1129064a1eb702b895" kindref="member">id</ref><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>id;</highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1afba5ec956f0515668cba944ce1f02daf" kindref="member">endcond</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1abefd34d479201d01ff36e4497def613d" kindref="member">err</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>err;</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="573"><highlight class="normal">}</highlight></codeline>
<codeline lineno="574"><highlight class="normal"></highlight></codeline>
<codeline lineno="601" refid="particle_8c_1a275c199f15c1a8f46a48decfb6908b71" refkind="member"><highlight class="normal"><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/><ref refid="particle_8c_1a275c199f15c1a8f46a48decfb6908b71" kindref="member">particle_state_to_fo</ref>(<ref refid="structparticle__state" kindref="compound">particle_state</ref>*<sp/>p,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i,<sp/><ref refid="structparticle__simd__fo" kindref="compound">particle_simd_fo</ref>*<sp/>p_fo,</highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j,<sp/><ref refid="structB__field__data" kindref="compound">B_field_data</ref>*<sp/>Bdata)<sp/>{</highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/>err<sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1abefd34d479201d01ff36e4497def613d" kindref="member">err</ref>;</highlight></codeline>
<codeline lineno="604"><highlight class="normal"></highlight></codeline>
<codeline lineno="605"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;r[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a327fd67d35cc4fb8f83e442109b8c846" kindref="member">rprt</ref>;</highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;phi[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a2ffcee71bbfed82201f3e3641756b6cb" kindref="member">phiprt</ref>;</highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;z[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1afe6f3b950482634327607b34de5fd70a" kindref="member">zprt</ref>;</highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;p_r[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1ae054cde64c773b1d4a762d520b91e66e" kindref="member">p_r</ref>;</highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;p_phi[j]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a22435dc975a3e26284b88e7d3e301d8a" kindref="member">p_phi</ref>;</highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;p_z[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a70e5a31a5aab3fdf5ad11e5aa924ba38" kindref="member">p_z</ref>;</highlight></codeline>
<codeline lineno="612"><highlight class="normal"></highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;mass[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1ac2d207ee9934020ee0e5fa0740c5dc2e" kindref="member">mass</ref>;</highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;charge[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a23139c51384acefa9689e370bb471bb9" kindref="member">charge</ref>;</highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;znum[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1ac2ded6c45152ab0d1f4c39b2c2442fb0" kindref="member">znum</ref>;</highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;anum[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1ae5b792077ab165fa2175d7dcb7553b0e" kindref="member">anum</ref>;</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;bounces[j]<sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;weight[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a1361c6ea896ed99423226c7bdcdd8aa4" kindref="member">weight</ref>;</highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;time[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a17b0da1c3ecdcd972eb28f7b3f163eba" kindref="member">time</ref>;</highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;theta[j]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a67998b97c3ee35af4c80f4135b7bd856" kindref="member">theta</ref>;</highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;id[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a47d5709d5e17ec1129064a1eb702b895" kindref="member">id</ref>;</highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;endcond[j]<sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1afba5ec956f0515668cba944ce1f02daf" kindref="member">endcond</ref>;</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;walltile[j]<sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a6c005013f55d58c7985d33c2dbfd5ef1" kindref="member">walltile</ref>;</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;mileage[j]<sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a09fe2854a148d4eb8449f202cf932466" kindref="member">mileage</ref>;</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="626"><highlight class="normal"></highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Magnetic<sp/>field<sp/>stored<sp/>in<sp/>state<sp/>is<sp/>for<sp/>the<sp/>gc<sp/>position<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>B_dB[15],<sp/>psi[1],<sp/>rho[2];</highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="B__field_8c_1a90eee159b997ec948d58e1b760f7a555" kindref="member">B_field_eval_B_dB</ref>(B_dB,<sp/>p-&gt;<ref refid="structparticle__state_1a327fd67d35cc4fb8f83e442109b8c846" kindref="member">rprt</ref>,<sp/>p-&gt;<ref refid="structparticle__state_1a2ffcee71bbfed82201f3e3641756b6cb" kindref="member">phiprt</ref>,<sp/>p-&gt;<ref refid="structparticle__state_1afe6f3b950482634327607b34de5fd70a" kindref="member">zprt</ref>,<sp/>p-&gt;<ref refid="structparticle__state_1a17b0da1c3ecdcd972eb28f7b3f163eba" kindref="member">time</ref>,</highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Bdata);</highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="B__field_8c_1a48c1f881a5f7fc9bf2d04edadfc2becf" kindref="member">B_field_eval_psi</ref>(psi,<sp/>p-&gt;<ref refid="structparticle__state_1a327fd67d35cc4fb8f83e442109b8c846" kindref="member">rprt</ref>,<sp/>p-&gt;<ref refid="structparticle__state_1a2ffcee71bbfed82201f3e3641756b6cb" kindref="member">phiprt</ref>,<sp/>p-&gt;<ref refid="structparticle__state_1afe6f3b950482634327607b34de5fd70a" kindref="member">zprt</ref>,<sp/>p-&gt;<ref refid="structparticle__state_1a17b0da1c3ecdcd972eb28f7b3f163eba" kindref="member">time</ref>,</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Bdata);</highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="B__field_8c_1a3e0114363493349f81a78142e70f2bd4" kindref="member">B_field_eval_rho</ref>(rho,<sp/>psi[0],<sp/>Bdata);</highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="640"><highlight class="normal"></highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;rho[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>rho[0];</highlight></codeline>
<codeline lineno="643"><highlight class="normal"></highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;B_r[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[0];</highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;B_r_dr[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[1];</highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;B_r_dphi[j]<sp/><sp/><sp/>=<sp/>B_dB[2];</highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;B_r_dz[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[3];</highlight></codeline>
<codeline lineno="648"><highlight class="normal"></highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;B_phi[j]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[4];</highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;B_phi_dr[j]<sp/><sp/><sp/>=<sp/>B_dB[5];</highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;B_phi_dphi[j]<sp/>=<sp/>B_dB[6];</highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;B_phi_dz[j]<sp/><sp/><sp/>=<sp/>B_dB[7];</highlight></codeline>
<codeline lineno="653"><highlight class="normal"></highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;B_z[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[8];</highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;B_z_dr[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[9];</highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;B_z_dphi[j]<sp/><sp/><sp/>=<sp/>B_dB[10];</highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;B_z_dz[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[11];</highlight></codeline>
<codeline lineno="658"><highlight class="normal"></highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;running[j]<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(p-&gt;<ref refid="structparticle__state_1afba5ec956f0515668cba944ce1f02daf" kindref="member">endcond</ref>)<sp/>{</highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;running[j]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;cputime[j]<sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1aa396877576f7a3bcecfae0ddefa84b0c" kindref="member">cputime</ref>;</highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;index[j]<sp/><sp/><sp/>=<sp/>i;</highlight></codeline>
<codeline lineno="665"><highlight class="normal"></highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_fo-&gt;err[j]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="668"><highlight class="normal"></highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>err;</highlight></codeline>
<codeline lineno="670"><highlight class="normal">}</highlight></codeline>
<codeline lineno="671"><highlight class="normal"></highlight></codeline>
<codeline lineno="686" refid="particle_8c_1a308eb43a7cb3aead97315dd1020aae9d" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="particle_8c_1a308eb43a7cb3aead97315dd1020aae9d" kindref="member">particle_fo_to_state</ref>(<ref refid="structparticle__simd__fo" kindref="compound">particle_simd_fo</ref>*<sp/>p_fo,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j,<sp/><ref refid="structparticle__state" kindref="compound">particle_state</ref>*<sp/>p,</highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structB__field__data" kindref="compound">B_field_data</ref>*<sp/>Bdata)<sp/>{</highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/>err<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="689"><highlight class="normal"></highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a327fd67d35cc4fb8f83e442109b8c846" kindref="member">rprt</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;r[j];</highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a2ffcee71bbfed82201f3e3641756b6cb" kindref="member">phiprt</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;phi[j];</highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1afe6f3b950482634327607b34de5fd70a" kindref="member">zprt</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;z[j];</highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1ae054cde64c773b1d4a762d520b91e66e" kindref="member">p_r</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;p_r[j];</highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a22435dc975a3e26284b88e7d3e301d8a" kindref="member">p_phi</ref><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;p_phi[j];</highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a70e5a31a5aab3fdf5ad11e5aa924ba38" kindref="member">p_z</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;p_z[j];</highlight></codeline>
<codeline lineno="696"><highlight class="normal"></highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1ac2d207ee9934020ee0e5fa0740c5dc2e" kindref="member">mass</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;mass[j];</highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a23139c51384acefa9689e370bb471bb9" kindref="member">charge</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;charge[j];</highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1ac2ded6c45152ab0d1f4c39b2c2442fb0" kindref="member">znum</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;znum[j];</highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1ae5b792077ab165fa2175d7dcb7553b0e" kindref="member">anum</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;anum[j];</highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a1361c6ea896ed99423226c7bdcdd8aa4" kindref="member">weight</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;weight[j];</highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a17b0da1c3ecdcd972eb28f7b3f163eba" kindref="member">time</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;time[j];</highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a67998b97c3ee35af4c80f4135b7bd856" kindref="member">theta</ref><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;theta[j];</highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a47d5709d5e17ec1129064a1eb702b895" kindref="member">id</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;id[j];</highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1afba5ec956f0515668cba944ce1f02daf" kindref="member">endcond</ref><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;endcond[j];</highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a6c005013f55d58c7985d33c2dbfd5ef1" kindref="member">walltile</ref><sp/><sp/><sp/>=<sp/>p_fo-&gt;walltile[j];</highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1aa396877576f7a3bcecfae0ddefa84b0c" kindref="member">cputime</ref><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;cputime[j];</highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a09fe2854a148d4eb8449f202cf932466" kindref="member">mileage</ref><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;mileage[j];</highlight></codeline>
<codeline lineno="709"><highlight class="normal"></highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Particle<sp/>to<sp/>guiding<sp/>center<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>B_dB[15],<sp/>psi[1],<sp/>rho[2];</highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/>rho[0]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;rho[j];</highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[0]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;B_r[j];</highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[1]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;B_r_dr[j];</highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[2]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;B_r_dphi[j];</highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[3]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;B_r_dz[j];</highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[4]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;B_phi[j];</highlight></codeline>
<codeline lineno="718"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[5]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;B_phi_dr[j];</highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[6]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;B_phi_dphi[j];</highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[7]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;B_phi_dz[j];</highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[8]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;B_z[j];</highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[9]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;B_z_dr[j];</highlight></codeline>
<codeline lineno="723"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[10]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;B_z_dphi[j];</highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[11]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;B_z_dz[j];</highlight></codeline>
<codeline lineno="725"><highlight class="normal"></highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Guiding<sp/>center<sp/>transformation<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>ppar;</highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>pr<sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1ae054cde64c773b1d4a762d520b91e66e" kindref="member">p_r</ref>;</highlight></codeline>
<codeline lineno="730"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>pphi<sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a22435dc975a3e26284b88e7d3e301d8a" kindref="member">p_phi</ref>;</highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>pz<sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a70e5a31a5aab3fdf5ad11e5aa924ba38" kindref="member">p_z</ref>;</highlight></codeline>
<codeline lineno="732"><highlight class="normal"></highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gctransform_8c_1a9152a8be5caaa87feb49f65c2f1c0504" kindref="member">gctransform_particle2guidingcenter</ref>(</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1ac2d207ee9934020ee0e5fa0740c5dc2e" kindref="member">mass</ref>,<sp/>p-&gt;<ref refid="structparticle__state_1a23139c51384acefa9689e370bb471bb9" kindref="member">charge</ref>,<sp/>B_dB,</highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a327fd67d35cc4fb8f83e442109b8c846" kindref="member">rprt</ref>,<sp/>p-&gt;<ref refid="structparticle__state_1a2ffcee71bbfed82201f3e3641756b6cb" kindref="member">phiprt</ref>,<sp/>p-&gt;<ref refid="structparticle__state_1afe6f3b950482634327607b34de5fd70a" kindref="member">zprt</ref>,<sp/>pr<sp/>,<sp/>pphi,<sp/>pz,</highlight></codeline>
<codeline lineno="736"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;p-&gt;<ref refid="structparticle__state_1a3f8be755cb8baac1b13a68d90c59c3f5" kindref="member">r</ref>,<sp/>&amp;p-&gt;<ref refid="structparticle__state_1aff41ea912d6616b74496ce6acb2e5b7e" kindref="member">phi</ref>,<sp/>&amp;p-&gt;<ref refid="structparticle__state_1af550bffa561085f7c0b775bd43ccaed2" kindref="member">z</ref>,<sp/>&amp;ppar,<sp/>&amp;p-&gt;<ref refid="structparticle__state_1a52ac6ad583818871d6dd6aee78d27779" kindref="member">mu</ref>,<sp/>&amp;p-&gt;<ref refid="structparticle__state_1a32910eee2ba00869e56a165347883837" kindref="member">zeta</ref>);</highlight></codeline>
<codeline lineno="737"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err<sp/>&amp;&amp;<sp/>p-&gt;<ref refid="structparticle__state_1a3f8be755cb8baac1b13a68d90c59c3f5" kindref="member">r</ref><sp/>&lt;=<sp/>0)<sp/><sp/>{err<sp/>=<sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92a009d0727e7fb6bdffc7ea94fe04c4903" kindref="member">ERR_MARKER_UNPHYSICAL</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddaf1cf6bea1dd479b3f3efaaedf3637ecd" kindref="member">EF_PARTICLE</ref>);}</highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err<sp/>&amp;&amp;<sp/>p-&gt;<ref refid="structparticle__state_1a52ac6ad583818871d6dd6aee78d27779" kindref="member">mu</ref><sp/>&lt;<sp/>0)<sp/><sp/>{err<sp/>=<sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92a009d0727e7fb6bdffc7ea94fe04c4903" kindref="member">ERR_MARKER_UNPHYSICAL</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddaf1cf6bea1dd479b3f3efaaedf3637ecd" kindref="member">EF_PARTICLE</ref>);}</highlight></codeline>
<codeline lineno="740"><highlight class="normal"></highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="B__field_8c_1a90eee159b997ec948d58e1b760f7a555" kindref="member">B_field_eval_B_dB</ref>(B_dB,<sp/>p-&gt;<ref refid="structparticle__state_1a3f8be755cb8baac1b13a68d90c59c3f5" kindref="member">r</ref>,<sp/>p-&gt;<ref refid="structparticle__state_1aff41ea912d6616b74496ce6acb2e5b7e" kindref="member">phi</ref>,<sp/>p-&gt;<ref refid="structparticle__state_1af550bffa561085f7c0b775bd43ccaed2" kindref="member">z</ref>,<sp/>p-&gt;<ref refid="structparticle__state_1a17b0da1c3ecdcd972eb28f7b3f163eba" kindref="member">time</ref>,<sp/>Bdata);</highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="B__field_8c_1a48c1f881a5f7fc9bf2d04edadfc2becf" kindref="member">B_field_eval_psi</ref>(psi,<sp/>p-&gt;<ref refid="structparticle__state_1a3f8be755cb8baac1b13a68d90c59c3f5" kindref="member">r</ref>,<sp/>p-&gt;<ref refid="structparticle__state_1aff41ea912d6616b74496ce6acb2e5b7e" kindref="member">phi</ref>,<sp/>p-&gt;<ref refid="structparticle__state_1af550bffa561085f7c0b775bd43ccaed2" kindref="member">z</ref>,<sp/>p-&gt;<ref refid="structparticle__state_1a17b0da1c3ecdcd972eb28f7b3f163eba" kindref="member">time</ref>,<sp/>Bdata);</highlight></codeline>
<codeline lineno="746"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="748"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="B__field_8c_1a3e0114363493349f81a78142e70f2bd4" kindref="member">B_field_eval_rho</ref>(rho,<sp/>psi[0],<sp/>Bdata);</highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="750"><highlight class="normal"></highlight></codeline>
<codeline lineno="751"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="752"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1aac9ea73afc147fa4aad9a3e0b1d62adc" kindref="member">ppar</ref><sp/>=<sp/>ppar;</highlight></codeline>
<codeline lineno="753"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="754"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err<sp/>&amp;&amp;<sp/>p-&gt;<ref refid="structparticle__state_1aac9ea73afc147fa4aad9a3e0b1d62adc" kindref="member">ppar</ref><sp/>&gt;=<sp/><ref refid="consts_8h_1a48339a730ee12d23d732ee7ce96f0aa6" kindref="member">CONST_C</ref>)<sp/>{</highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92a009d0727e7fb6bdffc7ea94fe04c4903" kindref="member">ERR_MARKER_UNPHYSICAL</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddaf1cf6bea1dd479b3f3efaaedf3637ecd" kindref="member">EF_PARTICLE</ref>);</highlight></codeline>
<codeline lineno="756"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="757"><highlight class="normal"></highlight></codeline>
<codeline lineno="758"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Normally<sp/>magnetic<sp/>field<sp/>data<sp/>at<sp/>gc<sp/>position<sp/>is<sp/>stored<sp/>here</highlight></codeline>
<codeline lineno="759"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>but,<sp/>if<sp/>gc<sp/>transformation<sp/>fails,<sp/>field<sp/>at<sp/>particle<sp/>position<sp/>is</highlight></codeline>
<codeline lineno="760"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>stored<sp/>instead.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="761"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1ab8ae01c7daaff543bbebcd5c59944b11" kindref="member">rho</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>rho[0];</highlight></codeline>
<codeline lineno="762"><highlight class="normal"></highlight></codeline>
<codeline lineno="763"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1ab8c38c260bf35d18b4efc8a4d3f3c42e" kindref="member">B_r</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[0];</highlight></codeline>
<codeline lineno="764"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1ac64189647aa40512c29a609adf5744be" kindref="member">B_r_dr</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[1];</highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1afe87a52e03d76b50c2ff6c61392cb242" kindref="member">B_r_dphi</ref><sp/><sp/><sp/>=<sp/>B_dB[2];</highlight></codeline>
<codeline lineno="766"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a5ab2aeaf91174744fe61c542de1d466d" kindref="member">B_r_dz</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[3];</highlight></codeline>
<codeline lineno="767"><highlight class="normal"></highlight></codeline>
<codeline lineno="768"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a1f2fffa46d75cc9b4055222250753a5e" kindref="member">B_phi</ref><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[4];</highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1ad89fb268bfcbe2d0165be251abe01ddb" kindref="member">B_phi_dr</ref><sp/><sp/><sp/>=<sp/>B_dB[5];</highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a6ce8b04b942d4ed9c35b506fa98614f5" kindref="member">B_phi_dphi</ref><sp/>=<sp/>B_dB[6];</highlight></codeline>
<codeline lineno="771"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a16c1e0bf43ce272246712d2e869f5413" kindref="member">B_phi_dz</ref><sp/><sp/><sp/>=<sp/>B_dB[7];</highlight></codeline>
<codeline lineno="772"><highlight class="normal"></highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a1260984dc0fc5d7ae30b7fe9a9cbd5e6" kindref="member">B_z</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[8];</highlight></codeline>
<codeline lineno="774"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1aab09ae9b71c12634da8be01ae2f8d0b3" kindref="member">B_z_dr</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[9];</highlight></codeline>
<codeline lineno="775"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1aa6876cfa0d7b3ccd513c67b7d58ae9e3" kindref="member">B_z_dphi</ref><sp/><sp/><sp/>=<sp/>B_dB[10];</highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a5f91b582caef69702f8ff981f8f32fa2" kindref="member">B_z_dz</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[11];</highlight></codeline>
<codeline lineno="777"><highlight class="normal"></highlight></codeline>
<codeline lineno="778"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>If<sp/>marker<sp/>already<sp/>has<sp/>error<sp/>flag,<sp/>make<sp/>sure<sp/>it<sp/>is<sp/>not<sp/>overwritten<sp/>here<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/>simerr<sp/><sp/>=<sp/>p_fo-&gt;err[j];</highlight></codeline>
<codeline lineno="780"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(simerr)<sp/>{</highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1abefd34d479201d01ff36e4497def613d" kindref="member">err</ref><sp/>=<sp/>simerr;</highlight></codeline>
<codeline lineno="782"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="783"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="784"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1abefd34d479201d01ff36e4497def613d" kindref="member">err</ref><sp/>=<sp/>err;</highlight></codeline>
<codeline lineno="785"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="786"><highlight class="normal">}</highlight></codeline>
<codeline lineno="787"><highlight class="normal"></highlight></codeline>
<codeline lineno="813" refid="particle_8c_1a217333f14fa85b8882738f804346c493" refkind="member"><highlight class="normal"><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/><ref refid="particle_8c_1a217333f14fa85b8882738f804346c493" kindref="member">particle_state_to_gc</ref>(<ref refid="structparticle__state" kindref="compound">particle_state</ref>*<sp/>p,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i,<sp/><ref refid="structparticle__simd__gc" kindref="compound">particle_simd_gc</ref>*<sp/>p_gc,</highlight></codeline>
<codeline lineno="814"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j,<sp/><ref refid="structB__field__data" kindref="compound">B_field_data</ref>*<sp/>Bdata)<sp/>{</highlight></codeline>
<codeline lineno="815"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/>err<sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1abefd34d479201d01ff36e4497def613d" kindref="member">err</ref>;</highlight></codeline>
<codeline lineno="816"><highlight class="normal"></highlight></codeline>
<codeline lineno="817"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="818"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;r[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a3f8be755cb8baac1b13a68d90c59c3f5" kindref="member">r</ref>;</highlight></codeline>
<codeline lineno="819"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;phi[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1aff41ea912d6616b74496ce6acb2e5b7e" kindref="member">phi</ref>;</highlight></codeline>
<codeline lineno="820"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;z[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1af550bffa561085f7c0b775bd43ccaed2" kindref="member">z</ref>;</highlight></codeline>
<codeline lineno="821"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;ppar[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1aac9ea73afc147fa4aad9a3e0b1d62adc" kindref="member">ppar</ref>;</highlight></codeline>
<codeline lineno="822"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;mu[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a52ac6ad583818871d6dd6aee78d27779" kindref="member">mu</ref>;</highlight></codeline>
<codeline lineno="823"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;zeta[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a32910eee2ba00869e56a165347883837" kindref="member">zeta</ref>;</highlight></codeline>
<codeline lineno="824"><highlight class="normal"></highlight></codeline>
<codeline lineno="825"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;mass[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1ac2d207ee9934020ee0e5fa0740c5dc2e" kindref="member">mass</ref>;</highlight></codeline>
<codeline lineno="826"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;charge[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a23139c51384acefa9689e370bb471bb9" kindref="member">charge</ref>;</highlight></codeline>
<codeline lineno="827"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;time[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a17b0da1c3ecdcd972eb28f7b3f163eba" kindref="member">time</ref>;</highlight></codeline>
<codeline lineno="828"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;bounces[j]<sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="829"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;weight[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a1361c6ea896ed99423226c7bdcdd8aa4" kindref="member">weight</ref>;</highlight></codeline>
<codeline lineno="830"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;rho[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1ab8ae01c7daaff543bbebcd5c59944b11" kindref="member">rho</ref>;</highlight></codeline>
<codeline lineno="831"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;theta[j]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a67998b97c3ee35af4c80f4135b7bd856" kindref="member">theta</ref>;</highlight></codeline>
<codeline lineno="832"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;id[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a47d5709d5e17ec1129064a1eb702b895" kindref="member">id</ref>;</highlight></codeline>
<codeline lineno="833"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;endcond[j]<sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1afba5ec956f0515668cba944ce1f02daf" kindref="member">endcond</ref>;</highlight></codeline>
<codeline lineno="834"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;walltile[j]<sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a6c005013f55d58c7985d33c2dbfd5ef1" kindref="member">walltile</ref>;</highlight></codeline>
<codeline lineno="835"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;mileage[j]<sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a09fe2854a148d4eb8449f202cf932466" kindref="member">mileage</ref>;</highlight></codeline>
<codeline lineno="836"><highlight class="normal"></highlight></codeline>
<codeline lineno="837"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;B_r[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1ab8c38c260bf35d18b4efc8a4d3f3c42e" kindref="member">B_r</ref>;</highlight></codeline>
<codeline lineno="838"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;B_r_dr[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1ac64189647aa40512c29a609adf5744be" kindref="member">B_r_dr</ref>;</highlight></codeline>
<codeline lineno="839"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;B_r_dphi[j]<sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1afe87a52e03d76b50c2ff6c61392cb242" kindref="member">B_r_dphi</ref>;</highlight></codeline>
<codeline lineno="840"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;B_r_dz[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a5ab2aeaf91174744fe61c542de1d466d" kindref="member">B_r_dz</ref>;</highlight></codeline>
<codeline lineno="841"><highlight class="normal"></highlight></codeline>
<codeline lineno="842"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;B_phi[j]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a1f2fffa46d75cc9b4055222250753a5e" kindref="member">B_phi</ref>;</highlight></codeline>
<codeline lineno="843"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;B_phi_dr[j]<sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1ad89fb268bfcbe2d0165be251abe01ddb" kindref="member">B_phi_dr</ref>;</highlight></codeline>
<codeline lineno="844"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;B_phi_dphi[j]<sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a6ce8b04b942d4ed9c35b506fa98614f5" kindref="member">B_phi_dphi</ref>;</highlight></codeline>
<codeline lineno="845"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;B_phi_dz[j]<sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a16c1e0bf43ce272246712d2e869f5413" kindref="member">B_phi_dz</ref>;</highlight></codeline>
<codeline lineno="846"><highlight class="normal"></highlight></codeline>
<codeline lineno="847"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;B_z[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a1260984dc0fc5d7ae30b7fe9a9cbd5e6" kindref="member">B_z</ref>;</highlight></codeline>
<codeline lineno="848"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;B_z_dr[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1aab09ae9b71c12634da8be01ae2f8d0b3" kindref="member">B_z_dr</ref>;</highlight></codeline>
<codeline lineno="849"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;B_z_dphi[j]<sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1aa6876cfa0d7b3ccd513c67b7d58ae9e3" kindref="member">B_z_dphi</ref>;</highlight></codeline>
<codeline lineno="850"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;B_z_dz[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a5f91b582caef69702f8ff981f8f32fa2" kindref="member">B_z_dz</ref>;</highlight></codeline>
<codeline lineno="851"><highlight class="normal"></highlight></codeline>
<codeline lineno="852"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;running[j]<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="853"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(p-&gt;<ref refid="structparticle__state_1afba5ec956f0515668cba944ce1f02daf" kindref="member">endcond</ref>)<sp/>{</highlight></codeline>
<codeline lineno="854"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;running[j]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="855"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="856"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;cputime[j]<sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1aa396877576f7a3bcecfae0ddefa84b0c" kindref="member">cputime</ref>;</highlight></codeline>
<codeline lineno="857"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;index[j]<sp/><sp/><sp/>=<sp/>i;</highlight></codeline>
<codeline lineno="858"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;err[j]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="859"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="860"><highlight class="normal"></highlight></codeline>
<codeline lineno="861"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>err;</highlight></codeline>
<codeline lineno="862"><highlight class="normal">}</highlight></codeline>
<codeline lineno="863"><highlight class="normal"></highlight></codeline>
<codeline lineno="878" refid="particle_8c_1a10627ba7787e16ac8b87afcf55d82c61" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="particle_8c_1a10627ba7787e16ac8b87afcf55d82c61" kindref="member">particle_gc_to_state</ref>(<ref refid="structparticle__simd__gc" kindref="compound">particle_simd_gc</ref>*<sp/>p_gc,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j,<sp/><ref refid="structparticle__state" kindref="compound">particle_state</ref>*<sp/>p,</highlight></codeline>
<codeline lineno="879"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structB__field__data" kindref="compound">B_field_data</ref>*<sp/>Bdata)<sp/>{</highlight></codeline>
<codeline lineno="880"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/>err<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="881"><highlight class="normal"></highlight></codeline>
<codeline lineno="882"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a3f8be755cb8baac1b13a68d90c59c3f5" kindref="member">r</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_gc-&gt;r[j];</highlight></codeline>
<codeline lineno="883"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1aff41ea912d6616b74496ce6acb2e5b7e" kindref="member">phi</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_gc-&gt;phi[j];</highlight></codeline>
<codeline lineno="884"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1af550bffa561085f7c0b775bd43ccaed2" kindref="member">z</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_gc-&gt;z[j];</highlight></codeline>
<codeline lineno="885"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1aac9ea73afc147fa4aad9a3e0b1d62adc" kindref="member">ppar</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_gc-&gt;ppar[j];</highlight></codeline>
<codeline lineno="886"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a52ac6ad583818871d6dd6aee78d27779" kindref="member">mu</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_gc-&gt;mu[j];</highlight></codeline>
<codeline lineno="887"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a32910eee2ba00869e56a165347883837" kindref="member">zeta</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_gc-&gt;zeta[j];</highlight></codeline>
<codeline lineno="888"><highlight class="normal"></highlight></codeline>
<codeline lineno="889"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1ac2d207ee9934020ee0e5fa0740c5dc2e" kindref="member">mass</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_gc-&gt;mass[j];</highlight></codeline>
<codeline lineno="890"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a23139c51384acefa9689e370bb471bb9" kindref="member">charge</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>p_gc-&gt;charge[j];</highlight></codeline>
<codeline lineno="891"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a17b0da1c3ecdcd972eb28f7b3f163eba" kindref="member">time</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_gc-&gt;time[j];</highlight></codeline>
<codeline lineno="892"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a1361c6ea896ed99423226c7bdcdd8aa4" kindref="member">weight</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>p_gc-&gt;weight[j];</highlight></codeline>
<codeline lineno="893"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a47d5709d5e17ec1129064a1eb702b895" kindref="member">id</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_gc-&gt;id[j];</highlight></codeline>
<codeline lineno="894"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1aa396877576f7a3bcecfae0ddefa84b0c" kindref="member">cputime</ref><sp/><sp/><sp/><sp/>=<sp/>p_gc-&gt;cputime[j];</highlight></codeline>
<codeline lineno="895"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1ab8ae01c7daaff543bbebcd5c59944b11" kindref="member">rho</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_gc-&gt;rho[j];</highlight></codeline>
<codeline lineno="896"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a67998b97c3ee35af4c80f4135b7bd856" kindref="member">theta</ref><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_gc-&gt;theta[j];</highlight></codeline>
<codeline lineno="897"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1afba5ec956f0515668cba944ce1f02daf" kindref="member">endcond</ref><sp/><sp/><sp/><sp/>=<sp/>p_gc-&gt;endcond[j];</highlight></codeline>
<codeline lineno="898"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a6c005013f55d58c7985d33c2dbfd5ef1" kindref="member">walltile</ref><sp/><sp/><sp/>=<sp/>p_gc-&gt;walltile[j];</highlight></codeline>
<codeline lineno="899"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a09fe2854a148d4eb8449f202cf932466" kindref="member">mileage</ref><sp/><sp/><sp/><sp/>=<sp/>p_gc-&gt;mileage[j];</highlight></codeline>
<codeline lineno="900"><highlight class="normal"></highlight></codeline>
<codeline lineno="901"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1ab8c38c260bf35d18b4efc8a4d3f3c42e" kindref="member">B_r</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_gc-&gt;B_r[j];</highlight></codeline>
<codeline lineno="902"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1ac64189647aa40512c29a609adf5744be" kindref="member">B_r_dr</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>p_gc-&gt;B_r_dr[j];</highlight></codeline>
<codeline lineno="903"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1afe87a52e03d76b50c2ff6c61392cb242" kindref="member">B_r_dphi</ref><sp/><sp/><sp/>=<sp/>p_gc-&gt;B_r_dphi[j];</highlight></codeline>
<codeline lineno="904"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a5ab2aeaf91174744fe61c542de1d466d" kindref="member">B_r_dz</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>p_gc-&gt;B_r_dz[j];</highlight></codeline>
<codeline lineno="905"><highlight class="normal"></highlight></codeline>
<codeline lineno="906"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a1f2fffa46d75cc9b4055222250753a5e" kindref="member">B_phi</ref><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_gc-&gt;B_phi[j];</highlight></codeline>
<codeline lineno="907"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1ad89fb268bfcbe2d0165be251abe01ddb" kindref="member">B_phi_dr</ref><sp/><sp/><sp/>=<sp/>p_gc-&gt;B_phi_dr[j];</highlight></codeline>
<codeline lineno="908"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a6ce8b04b942d4ed9c35b506fa98614f5" kindref="member">B_phi_dphi</ref><sp/>=<sp/>p_gc-&gt;B_phi_dphi[j];</highlight></codeline>
<codeline lineno="909"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a16c1e0bf43ce272246712d2e869f5413" kindref="member">B_phi_dz</ref><sp/><sp/><sp/>=<sp/>p_gc-&gt;B_phi_dz[j];</highlight></codeline>
<codeline lineno="910"><highlight class="normal"></highlight></codeline>
<codeline lineno="911"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a1260984dc0fc5d7ae30b7fe9a9cbd5e6" kindref="member">B_z</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_gc-&gt;B_z[j];</highlight></codeline>
<codeline lineno="912"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1aab09ae9b71c12634da8be01ae2f8d0b3" kindref="member">B_z_dr</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>p_gc-&gt;B_z_dr[j];</highlight></codeline>
<codeline lineno="913"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1aa6876cfa0d7b3ccd513c67b7d58ae9e3" kindref="member">B_z_dphi</ref><sp/><sp/><sp/>=<sp/>p_gc-&gt;B_z_dphi[j];</highlight></codeline>
<codeline lineno="914"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a5f91b582caef69702f8ff981f8f32fa2" kindref="member">B_z_dz</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>p_gc-&gt;B_z_dz[j];</highlight></codeline>
<codeline lineno="915"><highlight class="normal"></highlight></codeline>
<codeline lineno="916"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Guiding<sp/>center<sp/>to<sp/>particle<sp/>transformation<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="917"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>B_dB[15];</highlight></codeline>
<codeline lineno="918"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[0]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1ab8c38c260bf35d18b4efc8a4d3f3c42e" kindref="member">B_r</ref>;</highlight></codeline>
<codeline lineno="919"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[1]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1ac64189647aa40512c29a609adf5744be" kindref="member">B_r_dr</ref>;</highlight></codeline>
<codeline lineno="920"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[2]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1afe87a52e03d76b50c2ff6c61392cb242" kindref="member">B_r_dphi</ref>;</highlight></codeline>
<codeline lineno="921"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[3]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a5ab2aeaf91174744fe61c542de1d466d" kindref="member">B_r_dz</ref>;</highlight></codeline>
<codeline lineno="922"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[4]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a1f2fffa46d75cc9b4055222250753a5e" kindref="member">B_phi</ref>;</highlight></codeline>
<codeline lineno="923"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[5]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1ad89fb268bfcbe2d0165be251abe01ddb" kindref="member">B_phi_dr</ref>;</highlight></codeline>
<codeline lineno="924"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[6]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a6ce8b04b942d4ed9c35b506fa98614f5" kindref="member">B_phi_dphi</ref>;</highlight></codeline>
<codeline lineno="925"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[7]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a16c1e0bf43ce272246712d2e869f5413" kindref="member">B_phi_dz</ref>;</highlight></codeline>
<codeline lineno="926"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[8]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a1260984dc0fc5d7ae30b7fe9a9cbd5e6" kindref="member">B_z</ref>;</highlight></codeline>
<codeline lineno="927"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[9]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1aab09ae9b71c12634da8be01ae2f8d0b3" kindref="member">B_z_dr</ref>;</highlight></codeline>
<codeline lineno="928"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[10]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1aa6876cfa0d7b3ccd513c67b7d58ae9e3" kindref="member">B_z_dphi</ref>;</highlight></codeline>
<codeline lineno="929"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[11]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a5f91b582caef69702f8ff981f8f32fa2" kindref="member">B_z_dz</ref>;</highlight></codeline>
<codeline lineno="930"><highlight class="normal"></highlight></codeline>
<codeline lineno="931"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>pr,<sp/>pphi,<sp/>pz;</highlight></codeline>
<codeline lineno="932"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="933"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>pparprt,<sp/>muprt,<sp/>zetaprt;</highlight></codeline>
<codeline lineno="934"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gctransform_8c_1a12a5a86dd709b92207016c3c3b9f530c" kindref="member">gctransform_guidingcenter2particle</ref>(</highlight></codeline>
<codeline lineno="935"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1ac2d207ee9934020ee0e5fa0740c5dc2e" kindref="member">mass</ref>,<sp/>p-&gt;<ref refid="structparticle__state_1a23139c51384acefa9689e370bb471bb9" kindref="member">charge</ref>,<sp/>B_dB,</highlight></codeline>
<codeline lineno="936"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a3f8be755cb8baac1b13a68d90c59c3f5" kindref="member">r</ref>,<sp/>p-&gt;<ref refid="structparticle__state_1aff41ea912d6616b74496ce6acb2e5b7e" kindref="member">phi</ref>,<sp/>p-&gt;<ref refid="structparticle__state_1af550bffa561085f7c0b775bd43ccaed2" kindref="member">z</ref>,<sp/>p-&gt;<ref refid="structparticle__state_1aac9ea73afc147fa4aad9a3e0b1d62adc" kindref="member">ppar</ref>,<sp/>p-&gt;<ref refid="structparticle__state_1a52ac6ad583818871d6dd6aee78d27779" kindref="member">mu</ref>,<sp/>p-&gt;<ref refid="structparticle__state_1a32910eee2ba00869e56a165347883837" kindref="member">zeta</ref>,</highlight></codeline>
<codeline lineno="937"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;p-&gt;<ref refid="structparticle__state_1a327fd67d35cc4fb8f83e442109b8c846" kindref="member">rprt</ref>,<sp/>&amp;p-&gt;<ref refid="structparticle__state_1a2ffcee71bbfed82201f3e3641756b6cb" kindref="member">phiprt</ref>,<sp/>&amp;p-&gt;<ref refid="structparticle__state_1afe6f3b950482634327607b34de5fd70a" kindref="member">zprt</ref>,<sp/>&amp;pparprt,<sp/>&amp;muprt,<sp/>&amp;zetaprt);</highlight></codeline>
<codeline lineno="938"><highlight class="normal"></highlight></codeline>
<codeline lineno="939"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="B__field_8c_1a90eee159b997ec948d58e1b760f7a555" kindref="member">B_field_eval_B_dB</ref>(B_dB,<sp/>p-&gt;<ref refid="structparticle__state_1a327fd67d35cc4fb8f83e442109b8c846" kindref="member">rprt</ref>,<sp/>p-&gt;<ref refid="structparticle__state_1a2ffcee71bbfed82201f3e3641756b6cb" kindref="member">phiprt</ref>,<sp/>p-&gt;<ref refid="structparticle__state_1afe6f3b950482634327607b34de5fd70a" kindref="member">zprt</ref>,<sp/>p-&gt;<ref refid="structparticle__state_1a17b0da1c3ecdcd972eb28f7b3f163eba" kindref="member">time</ref>,<sp/>Bdata);</highlight></codeline>
<codeline lineno="940"><highlight class="normal"></highlight></codeline>
<codeline lineno="941"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gctransform_8c_1a8f102308b097afb80120cac2b895cbe8" kindref="member">gctransform_pparmuzeta2prpphipz</ref>(</highlight></codeline>
<codeline lineno="942"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1ac2d207ee9934020ee0e5fa0740c5dc2e" kindref="member">mass</ref>,<sp/>p-&gt;<ref refid="structparticle__state_1a23139c51384acefa9689e370bb471bb9" kindref="member">charge</ref>,<sp/>B_dB,</highlight></codeline>
<codeline lineno="943"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a2ffcee71bbfed82201f3e3641756b6cb" kindref="member">phiprt</ref>,<sp/>pparprt,<sp/>muprt,<sp/>zetaprt,</highlight></codeline>
<codeline lineno="944"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;pr,<sp/>&amp;pphi,<sp/>&amp;pz);</highlight></codeline>
<codeline lineno="945"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="946"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err<sp/>&amp;&amp;<sp/>p-&gt;<ref refid="structparticle__state_1a327fd67d35cc4fb8f83e442109b8c846" kindref="member">rprt</ref><sp/>&lt;=<sp/>0)<sp/>{err<sp/>=<sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92a009d0727e7fb6bdffc7ea94fe04c4903" kindref="member">ERR_MARKER_UNPHYSICAL</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddaf1cf6bea1dd479b3f3efaaedf3637ecd" kindref="member">EF_PARTICLE</ref>);}</highlight></codeline>
<codeline lineno="947"><highlight class="normal"></highlight></codeline>
<codeline lineno="948"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="949"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1ae054cde64c773b1d4a762d520b91e66e" kindref="member">p_r</ref><sp/><sp/><sp/>=<sp/>pr;</highlight></codeline>
<codeline lineno="950"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a22435dc975a3e26284b88e7d3e301d8a" kindref="member">p_phi</ref><sp/>=<sp/>pphi;</highlight></codeline>
<codeline lineno="951"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a70e5a31a5aab3fdf5ad11e5aa924ba38" kindref="member">p_z</ref><sp/><sp/><sp/>=<sp/>pz;</highlight></codeline>
<codeline lineno="952"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="953"><highlight class="normal"></highlight></codeline>
<codeline lineno="954"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>If<sp/>marker<sp/>already<sp/>has<sp/>error<sp/>flag,<sp/>make<sp/>sure<sp/>it<sp/>is<sp/>not<sp/>overwritten<sp/>here<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="955"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/>simerr<sp/><sp/>=<sp/>p_gc-&gt;err[j];</highlight></codeline>
<codeline lineno="956"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(simerr)<sp/>{</highlight></codeline>
<codeline lineno="957"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1abefd34d479201d01ff36e4497def613d" kindref="member">err</ref><sp/>=<sp/>simerr;</highlight></codeline>
<codeline lineno="958"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="959"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="960"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1abefd34d479201d01ff36e4497def613d" kindref="member">err</ref><sp/>=<sp/>err;</highlight></codeline>
<codeline lineno="961"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="962"><highlight class="normal">}</highlight></codeline>
<codeline lineno="963"><highlight class="normal"></highlight></codeline>
<codeline lineno="994" refid="particle_8c_1aaa3116ddab1b53462a5c7d7c98dcf839" refkind="member"><highlight class="normal"><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/><ref refid="particle_8c_1aaa3116ddab1b53462a5c7d7c98dcf839" kindref="member">particle_state_to_ml</ref>(<ref refid="structparticle__state" kindref="compound">particle_state</ref>*<sp/>p,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i,<sp/><ref refid="structparticle__simd__ml" kindref="compound">particle_simd_ml</ref>*<sp/>p_ml,</highlight></codeline>
<codeline lineno="995"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j,<sp/><ref refid="structB__field__data" kindref="compound">B_field_data</ref>*<sp/>Bdata)<sp/>{</highlight></codeline>
<codeline lineno="996"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/>err<sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1abefd34d479201d01ff36e4497def613d" kindref="member">err</ref>;</highlight></codeline>
<codeline lineno="997"><highlight class="normal"></highlight></codeline>
<codeline lineno="998"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="999"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_ml-&gt;r[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a3f8be755cb8baac1b13a68d90c59c3f5" kindref="member">r</ref>;</highlight></codeline>
<codeline lineno="1000"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_ml-&gt;phi[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1aff41ea912d6616b74496ce6acb2e5b7e" kindref="member">phi</ref>;</highlight></codeline>
<codeline lineno="1001"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_ml-&gt;z[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1af550bffa561085f7c0b775bd43ccaed2" kindref="member">z</ref>;</highlight></codeline>
<codeline lineno="1002"><highlight class="normal"></highlight></codeline>
<codeline lineno="1003"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_ml-&gt;pitch[j]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>2*(p-&gt;<ref refid="structparticle__state_1aac9ea73afc147fa4aad9a3e0b1d62adc" kindref="member">ppar</ref><sp/>&gt;=<sp/>0)<sp/>-<sp/>1.0;</highlight></codeline>
<codeline lineno="1004"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_ml-&gt;time[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a17b0da1c3ecdcd972eb28f7b3f163eba" kindref="member">time</ref>;</highlight></codeline>
<codeline lineno="1005"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_ml-&gt;weight[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a1361c6ea896ed99423226c7bdcdd8aa4" kindref="member">weight</ref>;</highlight></codeline>
<codeline lineno="1006"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_ml-&gt;id[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a47d5709d5e17ec1129064a1eb702b895" kindref="member">id</ref>;</highlight></codeline>
<codeline lineno="1007"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_ml-&gt;cputime[j]<sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1aa396877576f7a3bcecfae0ddefa84b0c" kindref="member">cputime</ref>;</highlight></codeline>
<codeline lineno="1008"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_ml-&gt;rho[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1ab8ae01c7daaff543bbebcd5c59944b11" kindref="member">rho</ref>;</highlight></codeline>
<codeline lineno="1009"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_ml-&gt;theta[j]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a67998b97c3ee35af4c80f4135b7bd856" kindref="member">theta</ref>;</highlight></codeline>
<codeline lineno="1010"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_ml-&gt;endcond[j]<sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1afba5ec956f0515668cba944ce1f02daf" kindref="member">endcond</ref>;</highlight></codeline>
<codeline lineno="1011"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_ml-&gt;walltile[j]<sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a6c005013f55d58c7985d33c2dbfd5ef1" kindref="member">walltile</ref>;</highlight></codeline>
<codeline lineno="1012"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_ml-&gt;mileage[j]<sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a09fe2854a148d4eb8449f202cf932466" kindref="member">mileage</ref>;</highlight></codeline>
<codeline lineno="1013"><highlight class="normal"></highlight></codeline>
<codeline lineno="1014"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_ml-&gt;B_r[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1ab8c38c260bf35d18b4efc8a4d3f3c42e" kindref="member">B_r</ref>;</highlight></codeline>
<codeline lineno="1015"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_ml-&gt;B_r_dr[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1ac64189647aa40512c29a609adf5744be" kindref="member">B_r_dr</ref>;</highlight></codeline>
<codeline lineno="1016"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_ml-&gt;B_r_dphi[j]<sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1afe87a52e03d76b50c2ff6c61392cb242" kindref="member">B_r_dphi</ref>;</highlight></codeline>
<codeline lineno="1017"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_ml-&gt;B_r_dz[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a5ab2aeaf91174744fe61c542de1d466d" kindref="member">B_r_dz</ref>;</highlight></codeline>
<codeline lineno="1018"><highlight class="normal"></highlight></codeline>
<codeline lineno="1019"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_ml-&gt;B_phi[j]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a1f2fffa46d75cc9b4055222250753a5e" kindref="member">B_phi</ref>;</highlight></codeline>
<codeline lineno="1020"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_ml-&gt;B_phi_dr[j]<sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1ad89fb268bfcbe2d0165be251abe01ddb" kindref="member">B_phi_dr</ref>;</highlight></codeline>
<codeline lineno="1021"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_ml-&gt;B_phi_dphi[j]<sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a6ce8b04b942d4ed9c35b506fa98614f5" kindref="member">B_phi_dphi</ref>;</highlight></codeline>
<codeline lineno="1022"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_ml-&gt;B_phi_dz[j]<sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a16c1e0bf43ce272246712d2e869f5413" kindref="member">B_phi_dz</ref>;</highlight></codeline>
<codeline lineno="1023"><highlight class="normal"></highlight></codeline>
<codeline lineno="1024"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_ml-&gt;B_z[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a1260984dc0fc5d7ae30b7fe9a9cbd5e6" kindref="member">B_z</ref>;</highlight></codeline>
<codeline lineno="1025"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_ml-&gt;B_z_dr[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1aab09ae9b71c12634da8be01ae2f8d0b3" kindref="member">B_z_dr</ref>;</highlight></codeline>
<codeline lineno="1026"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_ml-&gt;B_z_dphi[j]<sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1aa6876cfa0d7b3ccd513c67b7d58ae9e3" kindref="member">B_z_dphi</ref>;</highlight></codeline>
<codeline lineno="1027"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_ml-&gt;B_z_dz[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__state_1a5f91b582caef69702f8ff981f8f32fa2" kindref="member">B_z_dz</ref>;</highlight></codeline>
<codeline lineno="1028"><highlight class="normal"></highlight></codeline>
<codeline lineno="1029"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_ml-&gt;running[j]<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="1030"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(p-&gt;<ref refid="structparticle__state_1afba5ec956f0515668cba944ce1f02daf" kindref="member">endcond</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1031"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_ml-&gt;running[j]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1032"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1033"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_ml-&gt;index[j]<sp/>=<sp/>i;</highlight></codeline>
<codeline lineno="1034"><highlight class="normal"></highlight></codeline>
<codeline lineno="1035"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_ml-&gt;err[j]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1036"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1037"><highlight class="normal"></highlight></codeline>
<codeline lineno="1038"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>err;</highlight></codeline>
<codeline lineno="1039"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1040"><highlight class="normal"></highlight></codeline>
<codeline lineno="1059" refid="particle_8c_1ae5b0e6f269fe140fbb8f00b96e7aa7a9" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="particle_8c_1ae5b0e6f269fe140fbb8f00b96e7aa7a9" kindref="member">particle_ml_to_state</ref>(<ref refid="structparticle__simd__ml" kindref="compound">particle_simd_ml</ref>*<sp/>p_ml,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j,<sp/><ref refid="structparticle__state" kindref="compound">particle_state</ref>*<sp/>p,</highlight></codeline>
<codeline lineno="1060"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structB__field__data" kindref="compound">B_field_data</ref>*<sp/>Bdata)<sp/>{</highlight></codeline>
<codeline lineno="1061"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/>err<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1062"><highlight class="normal"></highlight></codeline>
<codeline lineno="1063"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a327fd67d35cc4fb8f83e442109b8c846" kindref="member">rprt</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_ml-&gt;r[j];</highlight></codeline>
<codeline lineno="1064"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a2ffcee71bbfed82201f3e3641756b6cb" kindref="member">phiprt</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>p_ml-&gt;phi[j];</highlight></codeline>
<codeline lineno="1065"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1afe6f3b950482634327607b34de5fd70a" kindref="member">zprt</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_ml-&gt;z[j];</highlight></codeline>
<codeline lineno="1066"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1ae054cde64c773b1d4a762d520b91e66e" kindref="member">p_r</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1067"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a22435dc975a3e26284b88e7d3e301d8a" kindref="member">p_phi</ref><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1068"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a70e5a31a5aab3fdf5ad11e5aa924ba38" kindref="member">p_z</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1069"><highlight class="normal"></highlight></codeline>
<codeline lineno="1070"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a3f8be755cb8baac1b13a68d90c59c3f5" kindref="member">r</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_ml-&gt;r[j];</highlight></codeline>
<codeline lineno="1071"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1aff41ea912d6616b74496ce6acb2e5b7e" kindref="member">phi</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_ml-&gt;phi[j];</highlight></codeline>
<codeline lineno="1072"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1af550bffa561085f7c0b775bd43ccaed2" kindref="member">z</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_ml-&gt;z[j];</highlight></codeline>
<codeline lineno="1073"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1aac9ea73afc147fa4aad9a3e0b1d62adc" kindref="member">ppar</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_ml-&gt;pitch[j];</highlight></codeline>
<codeline lineno="1074"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a52ac6ad583818871d6dd6aee78d27779" kindref="member">mu</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1075"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a32910eee2ba00869e56a165347883837" kindref="member">zeta</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1076"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1ac2d207ee9934020ee0e5fa0740c5dc2e" kindref="member">mass</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1077"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a23139c51384acefa9689e370bb471bb9" kindref="member">charge</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1078"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a17b0da1c3ecdcd972eb28f7b3f163eba" kindref="member">time</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_ml-&gt;time[j];</highlight></codeline>
<codeline lineno="1079"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a1361c6ea896ed99423226c7bdcdd8aa4" kindref="member">weight</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>p_ml-&gt;weight[j];</highlight></codeline>
<codeline lineno="1080"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a47d5709d5e17ec1129064a1eb702b895" kindref="member">id</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_ml-&gt;id[j];</highlight></codeline>
<codeline lineno="1081"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1aa396877576f7a3bcecfae0ddefa84b0c" kindref="member">cputime</ref><sp/><sp/><sp/><sp/>=<sp/>p_ml-&gt;cputime[j];</highlight></codeline>
<codeline lineno="1082"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1ab8ae01c7daaff543bbebcd5c59944b11" kindref="member">rho</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_ml-&gt;rho[j];</highlight></codeline>
<codeline lineno="1083"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a67998b97c3ee35af4c80f4135b7bd856" kindref="member">theta</ref><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_ml-&gt;theta[j];</highlight></codeline>
<codeline lineno="1084"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1afba5ec956f0515668cba944ce1f02daf" kindref="member">endcond</ref><sp/><sp/><sp/><sp/>=<sp/>p_ml-&gt;endcond[j];</highlight></codeline>
<codeline lineno="1085"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a6c005013f55d58c7985d33c2dbfd5ef1" kindref="member">walltile</ref><sp/><sp/><sp/>=<sp/>p_ml-&gt;walltile[j];</highlight></codeline>
<codeline lineno="1086"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a09fe2854a148d4eb8449f202cf932466" kindref="member">mileage</ref><sp/><sp/><sp/><sp/>=<sp/>p_ml-&gt;mileage[j];</highlight></codeline>
<codeline lineno="1087"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1abefd34d479201d01ff36e4497def613d" kindref="member">err</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_ml-&gt;err[j];</highlight></codeline>
<codeline lineno="1088"><highlight class="normal"></highlight></codeline>
<codeline lineno="1089"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1ab8c38c260bf35d18b4efc8a4d3f3c42e" kindref="member">B_r</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_ml-&gt;B_r[j];</highlight></codeline>
<codeline lineno="1090"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1ac64189647aa40512c29a609adf5744be" kindref="member">B_r_dr</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>p_ml-&gt;B_r_dr[j];</highlight></codeline>
<codeline lineno="1091"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1afe87a52e03d76b50c2ff6c61392cb242" kindref="member">B_r_dphi</ref><sp/><sp/><sp/>=<sp/>p_ml-&gt;B_r_dphi[j];</highlight></codeline>
<codeline lineno="1092"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a5ab2aeaf91174744fe61c542de1d466d" kindref="member">B_r_dz</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>p_ml-&gt;B_r_dz[j];</highlight></codeline>
<codeline lineno="1093"><highlight class="normal"></highlight></codeline>
<codeline lineno="1094"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a1f2fffa46d75cc9b4055222250753a5e" kindref="member">B_phi</ref><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_ml-&gt;B_phi[j];</highlight></codeline>
<codeline lineno="1095"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1ad89fb268bfcbe2d0165be251abe01ddb" kindref="member">B_phi_dr</ref><sp/><sp/><sp/>=<sp/>p_ml-&gt;B_phi_dr[j];</highlight></codeline>
<codeline lineno="1096"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a6ce8b04b942d4ed9c35b506fa98614f5" kindref="member">B_phi_dphi</ref><sp/>=<sp/>p_ml-&gt;B_phi_dphi[j];</highlight></codeline>
<codeline lineno="1097"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a16c1e0bf43ce272246712d2e869f5413" kindref="member">B_phi_dz</ref><sp/><sp/><sp/>=<sp/>p_ml-&gt;B_phi_dz[j];</highlight></codeline>
<codeline lineno="1098"><highlight class="normal"></highlight></codeline>
<codeline lineno="1099"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a1260984dc0fc5d7ae30b7fe9a9cbd5e6" kindref="member">B_z</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_ml-&gt;B_z[j];</highlight></codeline>
<codeline lineno="1100"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1aab09ae9b71c12634da8be01ae2f8d0b3" kindref="member">B_z_dr</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>p_ml-&gt;B_z_dr[j];</highlight></codeline>
<codeline lineno="1101"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1aa6876cfa0d7b3ccd513c67b7d58ae9e3" kindref="member">B_z_dphi</ref><sp/><sp/><sp/>=<sp/>p_ml-&gt;B_z_dphi[j];</highlight></codeline>
<codeline lineno="1102"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1a5f91b582caef69702f8ff981f8f32fa2" kindref="member">B_z_dz</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>p_ml-&gt;B_z_dz[j];</highlight></codeline>
<codeline lineno="1103"><highlight class="normal"></highlight></codeline>
<codeline lineno="1104"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>If<sp/>marker<sp/>already<sp/>has<sp/>error<sp/>flag,<sp/>make<sp/>sure<sp/>it<sp/>is<sp/>not<sp/>overwritten<sp/>here<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1105"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/>simerr<sp/><sp/>=<sp/>p_ml-&gt;err[j];</highlight></codeline>
<codeline lineno="1106"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(simerr)<sp/>{</highlight></codeline>
<codeline lineno="1107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1abefd34d479201d01ff36e4497def613d" kindref="member">err</ref><sp/>=<sp/>simerr;</highlight></codeline>
<codeline lineno="1108"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1109"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1abefd34d479201d01ff36e4497def613d" kindref="member">err</ref><sp/>=<sp/>err;</highlight></codeline>
<codeline lineno="1111"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1112"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!simerr<sp/>&amp;&amp;<sp/>err)<sp/>{err<sp/>=<sp/>err;}</highlight></codeline>
<codeline lineno="1113"><highlight class="normal"><sp/><sp/><sp/><sp/>p-&gt;<ref refid="structparticle__state_1abefd34d479201d01ff36e4497def613d" kindref="member">err</ref><sp/>=<sp/>err;</highlight></codeline>
<codeline lineno="1114"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1115"><highlight class="normal"></highlight></codeline>
<codeline lineno="1127" refid="particle_8c_1a6dec81969f333737b86320b744353281" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="particle_8c_1a6dec81969f333737b86320b744353281" kindref="member">particle_fo_to_gc</ref>(<ref refid="structparticle__simd__fo" kindref="compound">particle_simd_fo</ref>*<sp/>p_fo,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j,<sp/><ref refid="structparticle__simd__gc" kindref="compound">particle_simd_gc</ref>*<sp/>p_gc,</highlight></codeline>
<codeline lineno="1128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structB__field__data" kindref="compound">B_field_data</ref>*<sp/>Bdata)<sp/>{</highlight></codeline>
<codeline lineno="1129"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/>err<sp/>=<sp/>p_fo-&gt;err[j];</highlight></codeline>
<codeline lineno="1130"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>axisrz[2];</highlight></codeline>
<codeline lineno="1131"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>simerr<sp/>=<sp/>0;<sp/></highlight><highlight class="comment">/*<sp/>Error<sp/>has<sp/>already<sp/>occurred<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1132"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(err)<sp/>{simerr<sp/>=<sp/>1;}</highlight></codeline>
<codeline lineno="1133"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;id[j]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;id[j];</highlight></codeline>
<codeline lineno="1134"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;index[j]<sp/><sp/><sp/>=<sp/>p_fo-&gt;index[j];</highlight></codeline>
<codeline lineno="1135"><highlight class="normal"></highlight></codeline>
<codeline lineno="1136"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>r,<sp/>phi,<sp/>z,<sp/>ppar,<sp/>mu,<sp/>zeta,<sp/>B_dB[15];</highlight></codeline>
<codeline lineno="1137"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="1138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>Rprt<sp/><sp/><sp/>=<sp/>p_fo-&gt;r[j];</highlight></codeline>
<codeline lineno="1139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>phiprt<sp/>=<sp/>p_fo-&gt;phi[j];</highlight></codeline>
<codeline lineno="1140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>zprt<sp/><sp/><sp/>=<sp/>p_fo-&gt;z[j];</highlight></codeline>
<codeline lineno="1141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>pr<sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;p_r[j];</highlight></codeline>
<codeline lineno="1142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>pphi<sp/><sp/><sp/>=<sp/>p_fo-&gt;p_phi[j];</highlight></codeline>
<codeline lineno="1143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>pz<sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;p_z[j];</highlight></codeline>
<codeline lineno="1144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>mass<sp/><sp/><sp/>=<sp/>p_fo-&gt;mass[j];</highlight></codeline>
<codeline lineno="1145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>charge<sp/>=<sp/>p_fo-&gt;charge[j];</highlight></codeline>
<codeline lineno="1146"><highlight class="normal"></highlight></codeline>
<codeline lineno="1147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;mass[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;mass[j];</highlight></codeline>
<codeline lineno="1148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;charge[j]<sp/><sp/><sp/>=<sp/>p_fo-&gt;charge[j];</highlight></codeline>
<codeline lineno="1149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;weight[j]<sp/><sp/><sp/>=<sp/>p_fo-&gt;weight[j];</highlight></codeline>
<codeline lineno="1150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;time[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;time[j];</highlight></codeline>
<codeline lineno="1151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;mileage[j]<sp/><sp/>=<sp/>p_fo-&gt;mileage[j];</highlight></codeline>
<codeline lineno="1152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;endcond[j]<sp/><sp/>=<sp/>p_fo-&gt;endcond[j];</highlight></codeline>
<codeline lineno="1153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;running[j]<sp/><sp/>=<sp/>p_fo-&gt;running[j];</highlight></codeline>
<codeline lineno="1154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;walltile[j]<sp/>=<sp/>p_fo-&gt;walltile[j];</highlight></codeline>
<codeline lineno="1155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;cputime[j]<sp/><sp/>=<sp/>p_fo-&gt;cputime[j];</highlight></codeline>
<codeline lineno="1156"><highlight class="normal"></highlight></codeline>
<codeline lineno="1157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>B_dB[0]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;B_r[j];</highlight></codeline>
<codeline lineno="1158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>B_dB[1]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;B_r_dr[j];</highlight></codeline>
<codeline lineno="1159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>B_dB[2]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;B_r_dphi[j];</highlight></codeline>
<codeline lineno="1160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>B_dB[3]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;B_r_dz[j];</highlight></codeline>
<codeline lineno="1161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>B_dB[4]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;B_phi[j];</highlight></codeline>
<codeline lineno="1162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>B_dB[5]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;B_phi_dr[j];</highlight></codeline>
<codeline lineno="1163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>B_dB[6]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;B_phi_dphi[j];</highlight></codeline>
<codeline lineno="1164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>B_dB[7]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;B_phi_dz[j];</highlight></codeline>
<codeline lineno="1165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>B_dB[8]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;B_z[j];</highlight></codeline>
<codeline lineno="1166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>B_dB[9]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;B_z_dr[j];</highlight></codeline>
<codeline lineno="1167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>B_dB[10]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;B_z_dphi[j];</highlight></codeline>
<codeline lineno="1168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>B_dB[11]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p_fo-&gt;B_z_dz[j];</highlight></codeline>
<codeline lineno="1169"><highlight class="normal"></highlight></codeline>
<codeline lineno="1170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Guiding<sp/>center<sp/>transformation<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gctransform_8c_1a9152a8be5caaa87feb49f65c2f1c0504" kindref="member">gctransform_particle2guidingcenter</ref>(</highlight></codeline>
<codeline lineno="1172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mass,<sp/>charge,<sp/>B_dB,</highlight></codeline>
<codeline lineno="1173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Rprt,<sp/>phiprt,<sp/>zprt,<sp/>pr<sp/>,<sp/>pphi,<sp/>pz,</highlight></codeline>
<codeline lineno="1174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;r,<sp/>&amp;phi,<sp/>&amp;z,<sp/>&amp;ppar,<sp/>&amp;mu,<sp/>&amp;zeta);</highlight></codeline>
<codeline lineno="1175"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1176"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err<sp/>&amp;&amp;<sp/>r<sp/>&lt;=<sp/>0)<sp/><sp/>{err<sp/>=<sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92a009d0727e7fb6bdffc7ea94fe04c4903" kindref="member">ERR_MARKER_UNPHYSICAL</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddaf1cf6bea1dd479b3f3efaaedf3637ecd" kindref="member">EF_PARTICLE</ref>);}</highlight></codeline>
<codeline lineno="1177"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err<sp/>&amp;&amp;<sp/>mu<sp/>&lt;<sp/>0)<sp/><sp/>{err<sp/>=<sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92a009d0727e7fb6bdffc7ea94fe04c4903" kindref="member">ERR_MARKER_UNPHYSICAL</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddaf1cf6bea1dd479b3f3efaaedf3637ecd" kindref="member">EF_PARTICLE</ref>);}</highlight></codeline>
<codeline lineno="1178"><highlight class="normal"></highlight></codeline>
<codeline lineno="1179"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>psi[1],<sp/>rho[2];</highlight></codeline>
<codeline lineno="1180"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="1181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="B__field_8c_1a90eee159b997ec948d58e1b760f7a555" kindref="member">B_field_eval_B_dB</ref>(</highlight></codeline>
<codeline lineno="1182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>B_dB,<sp/>r,<sp/>phi,<sp/>z,<sp/>p_fo-&gt;time[j],<sp/>Bdata);</highlight></codeline>
<codeline lineno="1183"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1184"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="1185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="B__field_8c_1a48c1f881a5f7fc9bf2d04edadfc2becf" kindref="member">B_field_eval_psi</ref>(</highlight></codeline>
<codeline lineno="1186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>psi,<sp/>r,<sp/>phi,<sp/>z,<sp/>p_fo-&gt;time[j],<sp/>Bdata);</highlight></codeline>
<codeline lineno="1187"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1188"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="1189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="B__field_8c_1a3e0114363493349f81a78142e70f2bd4" kindref="member">B_field_eval_rho</ref>(rho,<sp/>psi[0],<sp/>Bdata);</highlight></codeline>
<codeline lineno="1190"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1191"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="1192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="B__field_8c_1ad8cf51ecdc7730eca39eb54ef4484a2d" kindref="member">B_field_get_axis_rz</ref>(axisrz,<sp/>Bdata,<sp/>p_gc-&gt;phi[j]);</highlight></codeline>
<codeline lineno="1193"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1194"><highlight class="normal"></highlight></codeline>
<codeline lineno="1195"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="1196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;r[j]<sp/><sp/><sp/><sp/>=<sp/>r;</highlight></codeline>
<codeline lineno="1197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;phi[j]<sp/><sp/>=<sp/>phi;</highlight></codeline>
<codeline lineno="1198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;z[j]<sp/><sp/><sp/><sp/>=<sp/>z;</highlight></codeline>
<codeline lineno="1199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;mu[j]<sp/><sp/><sp/>=<sp/>mu;</highlight></codeline>
<codeline lineno="1200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;zeta[j]<sp/>=<sp/>zeta;</highlight></codeline>
<codeline lineno="1201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;ppar[j]<sp/>=<sp/>ppar;</highlight></codeline>
<codeline lineno="1202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;rho[j]<sp/><sp/>=<sp/>rho[0];</highlight></codeline>
<codeline lineno="1203"><highlight class="normal"></highlight></codeline>
<codeline lineno="1204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Evaluate<sp/>pol<sp/>angle<sp/>so<sp/>that<sp/>it<sp/>is<sp/>cumulative<sp/>and<sp/>at<sp/>gc<sp/>position<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;theta[j]<sp/><sp/>=<sp/>p_fo-&gt;theta[j];</highlight></codeline>
<codeline lineno="1206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;theta[j]<sp/>+=<sp/>atan2(<sp/>(p_fo-&gt;r[j]-axisrz[0])<sp/>*<sp/>(p_gc-&gt;z[j]-axisrz[1])</highlight></codeline>
<codeline lineno="1207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>(p_fo-&gt;z[j]-axisrz[1])<sp/>*<sp/>(p_gc-&gt;r[j]-axisrz[0]),</highlight></codeline>
<codeline lineno="1208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(p_fo-&gt;r[j]-axisrz[0])<sp/>*<sp/>(p_gc-&gt;r[j]-axisrz[0])</highlight></codeline>
<codeline lineno="1209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/>(p_fo-&gt;z[j]-axisrz[1])<sp/>*<sp/>(p_gc-&gt;z[j]-axisrz[1])<sp/>);</highlight></codeline>
<codeline lineno="1210"><highlight class="normal"></highlight></codeline>
<codeline lineno="1211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;B_r[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[0];</highlight></codeline>
<codeline lineno="1212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;B_r_dr[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[1];</highlight></codeline>
<codeline lineno="1213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;B_r_dphi[j]<sp/><sp/><sp/>=<sp/>B_dB[2];</highlight></codeline>
<codeline lineno="1214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;B_r_dz[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[3];</highlight></codeline>
<codeline lineno="1215"><highlight class="normal"></highlight></codeline>
<codeline lineno="1216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;B_phi[j]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[4];</highlight></codeline>
<codeline lineno="1217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;B_phi_dr[j]<sp/><sp/><sp/>=<sp/>B_dB[5];</highlight></codeline>
<codeline lineno="1218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;B_phi_dphi[j]<sp/>=<sp/>B_dB[6];</highlight></codeline>
<codeline lineno="1219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;B_phi_dz[j]<sp/><sp/><sp/>=<sp/>B_dB[7];</highlight></codeline>
<codeline lineno="1220"><highlight class="normal"></highlight></codeline>
<codeline lineno="1221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;B_z[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[8];</highlight></codeline>
<codeline lineno="1222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;B_z_dr[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[9];</highlight></codeline>
<codeline lineno="1223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;B_z_dphi[j]<sp/><sp/><sp/>=<sp/>B_dB[10];</highlight></codeline>
<codeline lineno="1224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;B_z_dz[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[11];</highlight></codeline>
<codeline lineno="1225"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1226"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!simerr)<sp/>{err<sp/>=<sp/>err;}</highlight></codeline>
<codeline lineno="1227"><highlight class="normal"><sp/><sp/><sp/><sp/>p_gc-&gt;err[j]<sp/>=<sp/>err;</highlight></codeline>
<codeline lineno="1228"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(p_gc-&gt;err[j])<sp/>{</highlight></codeline>
<codeline lineno="1229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;running[j]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p_gc-&gt;endcond[j]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1231"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1232"><highlight class="normal"></highlight></codeline>
<codeline lineno="1233"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>err<sp/>&gt;<sp/>0;</highlight></codeline>
<codeline lineno="1234"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1235"><highlight class="normal"></highlight></codeline>
<codeline lineno="1244" refid="particle_8c_1afb47cf7aacb7f1d2aaae0ee5dc657229" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="particle_8c_1afb47cf7aacb7f1d2aaae0ee5dc657229" kindref="member">particle_copy_fo</ref>(<ref refid="structparticle__simd__fo" kindref="compound">particle_simd_fo</ref>*<sp/>p1,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i,<sp/><ref refid="structparticle__simd__fo" kindref="compound">particle_simd_fo</ref>*<sp/>p2,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j)<sp/>{</highlight></codeline>
<codeline lineno="1245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;r[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;r[i];</highlight></codeline>
<codeline lineno="1246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;phi[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;phi[i];</highlight></codeline>
<codeline lineno="1247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;z[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;z[i];</highlight></codeline>
<codeline lineno="1248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;p_r[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;p_r[i];</highlight></codeline>
<codeline lineno="1249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;p_phi[j]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;p_phi[i];</highlight></codeline>
<codeline lineno="1250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;p_z[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;p_z[i];</highlight></codeline>
<codeline lineno="1251"><highlight class="normal"></highlight></codeline>
<codeline lineno="1252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;time[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;time[i];</highlight></codeline>
<codeline lineno="1253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;mileage[j]<sp/><sp/><sp/><sp/>=<sp/>p1-&gt;mileage[i];</highlight></codeline>
<codeline lineno="1254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;cputime[j]<sp/><sp/><sp/><sp/>=<sp/>p1-&gt;cputime[i];</highlight></codeline>
<codeline lineno="1255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;rho[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;rho[i];</highlight></codeline>
<codeline lineno="1256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;weight[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;weight[i];</highlight></codeline>
<codeline lineno="1257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;cputime[j]<sp/><sp/><sp/><sp/>=<sp/>p1-&gt;cputime[i];</highlight></codeline>
<codeline lineno="1258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;rho[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;rho[i];</highlight></codeline>
<codeline lineno="1259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;theta[j]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;theta[i];</highlight></codeline>
<codeline lineno="1260"><highlight class="normal"></highlight></codeline>
<codeline lineno="1261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;mass[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;mass[i];</highlight></codeline>
<codeline lineno="1262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;charge[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;charge[i];</highlight></codeline>
<codeline lineno="1263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;znum[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;znum[i];</highlight></codeline>
<codeline lineno="1264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;anum[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;anum[i];</highlight></codeline>
<codeline lineno="1265"><highlight class="normal"></highlight></codeline>
<codeline lineno="1266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;id[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;id[i];</highlight></codeline>
<codeline lineno="1267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;bounces[j]<sp/><sp/><sp/><sp/>=<sp/>p1-&gt;bounces[i];</highlight></codeline>
<codeline lineno="1268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;running[j]<sp/><sp/><sp/><sp/>=<sp/>p1-&gt;running[i];</highlight></codeline>
<codeline lineno="1269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;endcond[j]<sp/><sp/><sp/><sp/>=<sp/>p1-&gt;endcond[i];</highlight></codeline>
<codeline lineno="1270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;walltile[j]<sp/><sp/><sp/>=<sp/>p1-&gt;walltile[i];</highlight></codeline>
<codeline lineno="1271"><highlight class="normal"></highlight></codeline>
<codeline lineno="1272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;B_r[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;B_r[i];</highlight></codeline>
<codeline lineno="1273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;B_phi[j]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;B_phi[i];</highlight></codeline>
<codeline lineno="1274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;B_z[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;B_z[i];</highlight></codeline>
<codeline lineno="1275"><highlight class="normal"></highlight></codeline>
<codeline lineno="1276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;B_r_dr[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;B_r_dr[i];</highlight></codeline>
<codeline lineno="1277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;B_r_dphi[j]<sp/><sp/><sp/>=<sp/>p1-&gt;B_r_dphi[i];</highlight></codeline>
<codeline lineno="1278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;B_r_dz[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;B_r_dz[i];</highlight></codeline>
<codeline lineno="1279"><highlight class="normal"></highlight></codeline>
<codeline lineno="1280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;B_phi_dr[j]<sp/><sp/><sp/>=<sp/>p1-&gt;B_phi_dr[i];</highlight></codeline>
<codeline lineno="1281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;B_phi_dphi[j]<sp/>=<sp/>p1-&gt;B_phi_dphi[i];</highlight></codeline>
<codeline lineno="1282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;B_phi_dz[j]<sp/><sp/><sp/>=<sp/>p1-&gt;B_phi_dz[i];</highlight></codeline>
<codeline lineno="1283"><highlight class="normal"></highlight></codeline>
<codeline lineno="1284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;B_z_dr[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;B_z_dr[i];</highlight></codeline>
<codeline lineno="1285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;B_z_dphi[j]<sp/><sp/><sp/>=<sp/>p1-&gt;B_z_dphi[i];</highlight></codeline>
<codeline lineno="1286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p2-&gt;B_z_dz[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;B_z_dz[i];</highlight></codeline>
<codeline lineno="1287"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1288"><highlight class="normal"></highlight></codeline>
<codeline lineno="1297" refid="particle_8c_1a17a485a5f6148e2aac393fc4b125a39d" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="particle_8c_1a17a485a5f6148e2aac393fc4b125a39d" kindref="member">particle_copy_gc</ref>(<ref refid="structparticle__simd__gc" kindref="compound">particle_simd_gc</ref>*<sp/>p1,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i,<sp/><ref refid="structparticle__simd__gc" kindref="compound">particle_simd_gc</ref>*<sp/>p2,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j)<sp/>{</highlight></codeline>
<codeline lineno="1298"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;r[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;r[i];</highlight></codeline>
<codeline lineno="1299"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;phi[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;phi[i];</highlight></codeline>
<codeline lineno="1300"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;z[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;z[i];</highlight></codeline>
<codeline lineno="1301"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;ppar[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;ppar[i];</highlight></codeline>
<codeline lineno="1302"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;mu[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;mu[i];</highlight></codeline>
<codeline lineno="1303"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;zeta[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;zeta[i];</highlight></codeline>
<codeline lineno="1304"><highlight class="normal"></highlight></codeline>
<codeline lineno="1305"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;time[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;time[i];</highlight></codeline>
<codeline lineno="1306"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;mileage[j]<sp/><sp/><sp/><sp/>=<sp/>p1-&gt;mileage[i];</highlight></codeline>
<codeline lineno="1307"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;weight[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;weight[i];</highlight></codeline>
<codeline lineno="1308"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;cputime[j]<sp/><sp/><sp/><sp/>=<sp/>p1-&gt;cputime[i];</highlight></codeline>
<codeline lineno="1309"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;rho[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;rho[i];</highlight></codeline>
<codeline lineno="1310"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;theta[j]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;theta[i];</highlight></codeline>
<codeline lineno="1311"><highlight class="normal"></highlight></codeline>
<codeline lineno="1312"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;mass[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;mass[i];</highlight></codeline>
<codeline lineno="1313"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;charge[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;charge[i];</highlight></codeline>
<codeline lineno="1314"><highlight class="normal"></highlight></codeline>
<codeline lineno="1315"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;id[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;id[i];</highlight></codeline>
<codeline lineno="1316"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;bounces[j]<sp/><sp/><sp/><sp/>=<sp/>p1-&gt;bounces[i];</highlight></codeline>
<codeline lineno="1317"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;running[j]<sp/><sp/><sp/><sp/>=<sp/>p1-&gt;running[i];</highlight></codeline>
<codeline lineno="1318"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;endcond[j]<sp/><sp/><sp/><sp/>=<sp/>p1-&gt;endcond[i];</highlight></codeline>
<codeline lineno="1319"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;walltile[j]<sp/><sp/><sp/>=<sp/>p1-&gt;walltile[i];</highlight></codeline>
<codeline lineno="1320"><highlight class="normal"></highlight></codeline>
<codeline lineno="1321"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;B_r[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;B_r[i];</highlight></codeline>
<codeline lineno="1322"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;B_phi[j]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;B_phi[i];</highlight></codeline>
<codeline lineno="1323"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;B_z[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;B_z[i];</highlight></codeline>
<codeline lineno="1324"><highlight class="normal"></highlight></codeline>
<codeline lineno="1325"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;B_r_dr[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;B_r_dr[i];</highlight></codeline>
<codeline lineno="1326"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;B_r_dphi[j]<sp/><sp/><sp/>=<sp/>p1-&gt;B_r_dphi[i];</highlight></codeline>
<codeline lineno="1327"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;B_r_dz[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;B_r_dz[i];</highlight></codeline>
<codeline lineno="1328"><highlight class="normal"></highlight></codeline>
<codeline lineno="1329"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;B_phi_dr[j]<sp/><sp/><sp/>=<sp/>p1-&gt;B_phi_dr[i];</highlight></codeline>
<codeline lineno="1330"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;B_phi_dphi[j]<sp/>=<sp/>p1-&gt;B_phi_dphi[i];</highlight></codeline>
<codeline lineno="1331"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;B_phi_dz[j]<sp/><sp/><sp/>=<sp/>p1-&gt;B_phi_dz[i];</highlight></codeline>
<codeline lineno="1332"><highlight class="normal"></highlight></codeline>
<codeline lineno="1333"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;B_z_dr[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;B_z_dr[i];</highlight></codeline>
<codeline lineno="1334"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;B_z_dphi[j]<sp/><sp/><sp/>=<sp/>p1-&gt;B_z_dphi[i];</highlight></codeline>
<codeline lineno="1335"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;B_z_dz[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;B_z_dz[i];</highlight></codeline>
<codeline lineno="1336"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1337"><highlight class="normal"></highlight></codeline>
<codeline lineno="1346" refid="particle_8c_1a9d81572e6a2d201fce505c23841214f6" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="particle_8c_1a9d81572e6a2d201fce505c23841214f6" kindref="member">particle_copy_ml</ref>(<ref refid="structparticle__simd__ml" kindref="compound">particle_simd_ml</ref>*<sp/>p1,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i,<sp/><ref refid="structparticle__simd__ml" kindref="compound">particle_simd_ml</ref>*<sp/>p2,</highlight></codeline>
<codeline lineno="1347"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j)<sp/>{</highlight></codeline>
<codeline lineno="1348"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;r[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;r[i];</highlight></codeline>
<codeline lineno="1349"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;phi[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;phi[i];</highlight></codeline>
<codeline lineno="1350"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;z[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;z[i];</highlight></codeline>
<codeline lineno="1351"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;pitch[j]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;pitch[i];</highlight></codeline>
<codeline lineno="1352"><highlight class="normal"></highlight></codeline>
<codeline lineno="1353"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;time[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;time[i];</highlight></codeline>
<codeline lineno="1354"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;mileage[j]<sp/><sp/><sp/><sp/>=<sp/>p1-&gt;mileage[i];</highlight></codeline>
<codeline lineno="1355"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;cputime[j]<sp/><sp/><sp/><sp/>=<sp/>p1-&gt;cputime[i];</highlight></codeline>
<codeline lineno="1356"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;rho[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;rho[i];</highlight></codeline>
<codeline lineno="1357"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;weight[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;weight[i];</highlight></codeline>
<codeline lineno="1358"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;theta[j]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;theta[i];</highlight></codeline>
<codeline lineno="1359"><highlight class="normal"></highlight></codeline>
<codeline lineno="1360"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;id[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;id[i];</highlight></codeline>
<codeline lineno="1361"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;running[j]<sp/><sp/><sp/><sp/>=<sp/>p1-&gt;running[i];</highlight></codeline>
<codeline lineno="1362"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;endcond[j]<sp/><sp/><sp/><sp/>=<sp/>p1-&gt;endcond[i];</highlight></codeline>
<codeline lineno="1363"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;walltile[j]<sp/><sp/><sp/>=<sp/>p1-&gt;walltile[i];</highlight></codeline>
<codeline lineno="1364"><highlight class="normal"></highlight></codeline>
<codeline lineno="1365"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;B_r[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;B_r[i];</highlight></codeline>
<codeline lineno="1366"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;B_phi[j]<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;B_phi[i];</highlight></codeline>
<codeline lineno="1367"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;B_z[j]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;B_z[i];</highlight></codeline>
<codeline lineno="1368"><highlight class="normal"></highlight></codeline>
<codeline lineno="1369"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;B_r_dr[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;B_r_dr[i];</highlight></codeline>
<codeline lineno="1370"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;B_r_dphi[j]<sp/><sp/><sp/>=<sp/>p1-&gt;B_r_dphi[i];</highlight></codeline>
<codeline lineno="1371"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;B_r_dz[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;B_r_dz[i];</highlight></codeline>
<codeline lineno="1372"><highlight class="normal"></highlight></codeline>
<codeline lineno="1373"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;B_phi_dr[j]<sp/><sp/><sp/>=<sp/>p1-&gt;B_phi_dr[i];</highlight></codeline>
<codeline lineno="1374"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;B_phi_dphi[j]<sp/>=<sp/>p1-&gt;B_phi_dphi[i];</highlight></codeline>
<codeline lineno="1375"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;B_phi_dz[j]<sp/><sp/><sp/>=<sp/>p1-&gt;B_phi_dz[i];</highlight></codeline>
<codeline lineno="1376"><highlight class="normal"></highlight></codeline>
<codeline lineno="1377"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;B_z_dr[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;B_z_dr[i];</highlight></codeline>
<codeline lineno="1378"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;B_z_dphi[j]<sp/><sp/><sp/>=<sp/>p1-&gt;B_z_dphi[i];</highlight></codeline>
<codeline lineno="1379"><highlight class="normal"><sp/><sp/><sp/><sp/>p2-&gt;B_z_dz[j]<sp/><sp/><sp/><sp/><sp/>=<sp/>p1-&gt;B_z_dz[i];</highlight></codeline>
<codeline lineno="1380"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1381"><highlight class="normal"></highlight></codeline>
<codeline lineno="1391" refid="particle_8c_1ab65075ed0209a55686c1009eb2041af0" refkind="member"><highlight class="normal"><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/><ref refid="particle_8c_1ab65075ed0209a55686c1009eb2041af0" kindref="member">particle_input_p_to_state</ref>(<ref refid="structparticle" kindref="compound">particle</ref>*<sp/>p,<sp/><ref refid="structparticle__state" kindref="compound">particle_state</ref>*<sp/>ps,</highlight></codeline>
<codeline lineno="1392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structB__field__data" kindref="compound">B_field_data</ref>*<sp/>Bdata)<sp/>{</highlight></codeline>
<codeline lineno="1393"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/>err<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1394"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>axisrz[2];</highlight></codeline>
<codeline lineno="1395"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="1396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="B__field_8c_1ad8cf51ecdc7730eca39eb54ef4484a2d" kindref="member">B_field_get_axis_rz</ref>(axisrz,<sp/>Bdata,<sp/>p-&gt;<ref refid="structparticle_1a438bb2444022de59231b10dab1e4b564" kindref="member">phi</ref>);</highlight></codeline>
<codeline lineno="1397"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1398"><highlight class="normal"><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a327fd67d35cc4fb8f83e442109b8c846" kindref="member">rprt</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle_1a91589c36968e810182fc94133eef3c02" kindref="member">r</ref>;</highlight></codeline>
<codeline lineno="1399"><highlight class="normal"><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a2ffcee71bbfed82201f3e3641756b6cb" kindref="member">phiprt</ref><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle_1a438bb2444022de59231b10dab1e4b564" kindref="member">phi</ref>;</highlight></codeline>
<codeline lineno="1400"><highlight class="normal"><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1afe6f3b950482634327607b34de5fd70a" kindref="member">zprt</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle_1a264fe4c41179e72afd1b6c8a824faf85" kindref="member">z</ref>;</highlight></codeline>
<codeline lineno="1401"><highlight class="normal"><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1ae054cde64c773b1d4a762d520b91e66e" kindref="member">p_r</ref><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle_1aecd9f4d05154d2e7b8cd27f9de0432a5" kindref="member">p_r</ref>;</highlight></codeline>
<codeline lineno="1402"><highlight class="normal"><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a22435dc975a3e26284b88e7d3e301d8a" kindref="member">p_phi</ref><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle_1a4a00f5d0bf15810900c4c3fdddbdc4b2" kindref="member">p_phi</ref>;</highlight></codeline>
<codeline lineno="1403"><highlight class="normal"><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a70e5a31a5aab3fdf5ad11e5aa924ba38" kindref="member">p_z</ref><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle_1acf7ecd617b5b30e9179553b1e71e4a8e" kindref="member">p_z</ref>;</highlight></codeline>
<codeline lineno="1404"><highlight class="normal"><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1ac2d207ee9934020ee0e5fa0740c5dc2e" kindref="member">mass</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle_1a91fbaab5de85465656bc523801280cdf" kindref="member">mass</ref>;</highlight></codeline>
<codeline lineno="1405"><highlight class="normal"><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a23139c51384acefa9689e370bb471bb9" kindref="member">charge</ref><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle_1a1b606e67922db122be89a7af32648714" kindref="member">charge</ref>;</highlight></codeline>
<codeline lineno="1406"><highlight class="normal"><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1ae5b792077ab165fa2175d7dcb7553b0e" kindref="member">anum</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle_1a1ebb08bda0afda6302c0123e775a5435" kindref="member">anum</ref>;</highlight></codeline>
<codeline lineno="1407"><highlight class="normal"><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1ac2ded6c45152ab0d1f4c39b2c2442fb0" kindref="member">znum</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle_1a7d39fdfca5945d3d964dac0fab061f2b" kindref="member">znum</ref>;</highlight></codeline>
<codeline lineno="1408"><highlight class="normal"><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a1361c6ea896ed99423226c7bdcdd8aa4" kindref="member">weight</ref><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle_1a41682650216e3bae370addda7f7b9c1f" kindref="member">weight</ref>;</highlight></codeline>
<codeline lineno="1409"><highlight class="normal"><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a17b0da1c3ecdcd972eb28f7b3f163eba" kindref="member">time</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle_1a4e7606a8ab8fed05991d00c52377cff5" kindref="member">time</ref>;</highlight></codeline>
<codeline lineno="1410"><highlight class="normal"><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a67998b97c3ee35af4c80f4135b7bd856" kindref="member">theta</ref><sp/><sp/><sp/><sp/>=<sp/>atan2(ps-&gt;<ref refid="structparticle__state_1afe6f3b950482634327607b34de5fd70a" kindref="member">zprt</ref>-axisrz[1],<sp/>ps-&gt;<ref refid="structparticle__state_1a327fd67d35cc4fb8f83e442109b8c846" kindref="member">rprt</ref>-axisrz[0]);</highlight></codeline>
<codeline lineno="1411"><highlight class="normal"><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a47d5709d5e17ec1129064a1eb702b895" kindref="member">id</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle_1ad8132c4b267fb25d3bfda3306d06e6c3" kindref="member">id</ref>;</highlight></codeline>
<codeline lineno="1412"><highlight class="normal"><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a09fe2854a148d4eb8449f202cf932466" kindref="member">mileage</ref><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1413"><highlight class="normal"><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1afba5ec956f0515668cba944ce1f02daf" kindref="member">endcond</ref><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1414"><highlight class="normal"><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a6c005013f55d58c7985d33c2dbfd5ef1" kindref="member">walltile</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1415"><highlight class="normal"><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1aa396877576f7a3bcecfae0ddefa84b0c" kindref="member">cputime</ref><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1416"><highlight class="normal"></highlight></codeline>
<codeline lineno="1417"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Guiding<sp/>center<sp/>transformation<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1418"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>B_dB[15],<sp/>r,<sp/>phi,<sp/>z,<sp/>ppar,<sp/>mu,<sp/>zeta,<sp/>psi[1],<sp/>rho[2];</highlight></codeline>
<codeline lineno="1419"><highlight class="normal"><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="B__field_8c_1a90eee159b997ec948d58e1b760f7a555" kindref="member">B_field_eval_B_dB</ref>(B_dB,<sp/>ps-&gt;<ref refid="structparticle__state_1a327fd67d35cc4fb8f83e442109b8c846" kindref="member">rprt</ref>,<sp/>ps-&gt;<ref refid="structparticle__state_1a2ffcee71bbfed82201f3e3641756b6cb" kindref="member">phiprt</ref>,<sp/>ps-&gt;<ref refid="structparticle__state_1afe6f3b950482634327607b34de5fd70a" kindref="member">zprt</ref>,</highlight></codeline>
<codeline lineno="1420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a17b0da1c3ecdcd972eb28f7b3f163eba" kindref="member">time</ref>,<sp/>Bdata);</highlight></codeline>
<codeline lineno="1421"><highlight class="normal"></highlight></codeline>
<codeline lineno="1422"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="1423"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gctransform_8c_1a9152a8be5caaa87feb49f65c2f1c0504" kindref="member">gctransform_particle2guidingcenter</ref>(</highlight></codeline>
<codeline lineno="1424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1ac2d207ee9934020ee0e5fa0740c5dc2e" kindref="member">mass</ref>,<sp/>ps-&gt;<ref refid="structparticle__state_1a23139c51384acefa9689e370bb471bb9" kindref="member">charge</ref>,<sp/>B_dB,</highlight></codeline>
<codeline lineno="1425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a327fd67d35cc4fb8f83e442109b8c846" kindref="member">rprt</ref>,<sp/>ps-&gt;<ref refid="structparticle__state_1a2ffcee71bbfed82201f3e3641756b6cb" kindref="member">phiprt</ref>,<sp/>ps-&gt;<ref refid="structparticle__state_1afe6f3b950482634327607b34de5fd70a" kindref="member">zprt</ref>,<sp/>p-&gt;<ref refid="structparticle_1aecd9f4d05154d2e7b8cd27f9de0432a5" kindref="member">p_r</ref>,<sp/>p-&gt;<ref refid="structparticle_1a4a00f5d0bf15810900c4c3fdddbdc4b2" kindref="member">p_phi</ref>,<sp/>p-&gt;<ref refid="structparticle_1acf7ecd617b5b30e9179553b1e71e4a8e" kindref="member">p_z</ref>,</highlight></codeline>
<codeline lineno="1426"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;r,<sp/>&amp;phi,<sp/>&amp;z,<sp/>&amp;ppar,<sp/>&amp;mu,<sp/>&amp;zeta);</highlight></codeline>
<codeline lineno="1427"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1428"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err<sp/>&amp;&amp;<sp/>r<sp/>&lt;=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92a009d0727e7fb6bdffc7ea94fe04c4903" kindref="member">ERR_MARKER_UNPHYSICAL</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddaf1cf6bea1dd479b3f3efaaedf3637ecd" kindref="member">EF_PARTICLE</ref>);</highlight></codeline>
<codeline lineno="1430"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1431"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err<sp/>&amp;&amp;<sp/>mu<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92a009d0727e7fb6bdffc7ea94fe04c4903" kindref="member">ERR_MARKER_UNPHYSICAL</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddaf1cf6bea1dd479b3f3efaaedf3637ecd" kindref="member">EF_PARTICLE</ref>);</highlight></codeline>
<codeline lineno="1433"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1434"><highlight class="normal"></highlight></codeline>
<codeline lineno="1435"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Update<sp/>magnetic<sp/>field<sp/>at<sp/>gc<sp/>position<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1436"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="1437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="B__field_8c_1a90eee159b997ec948d58e1b760f7a555" kindref="member">B_field_eval_B_dB</ref>(B_dB,<sp/>r,<sp/>phi,<sp/>z,<sp/>ps-&gt;<ref refid="structparticle__state_1a17b0da1c3ecdcd972eb28f7b3f163eba" kindref="member">time</ref>,<sp/>Bdata);</highlight></codeline>
<codeline lineno="1438"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1439"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="1440"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="B__field_8c_1a48c1f881a5f7fc9bf2d04edadfc2becf" kindref="member">B_field_eval_psi</ref>(psi,<sp/>r,<sp/>phi,<sp/>z,<sp/>ps-&gt;<ref refid="structparticle__state_1a17b0da1c3ecdcd972eb28f7b3f163eba" kindref="member">time</ref>,<sp/>Bdata);</highlight></codeline>
<codeline lineno="1441"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1442"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="1443"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="B__field_8c_1a3e0114363493349f81a78142e70f2bd4" kindref="member">B_field_eval_rho</ref>(rho,<sp/>psi[0],<sp/>Bdata);</highlight></codeline>
<codeline lineno="1444"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1445"><highlight class="normal"></highlight></codeline>
<codeline lineno="1446"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="1447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a3f8be755cb8baac1b13a68d90c59c3f5" kindref="member">r</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>r;</highlight></codeline>
<codeline lineno="1448"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1aff41ea912d6616b74496ce6acb2e5b7e" kindref="member">phi</ref><sp/><sp/><sp/>=<sp/>phi;</highlight></codeline>
<codeline lineno="1449"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1af550bffa561085f7c0b775bd43ccaed2" kindref="member">z</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>z;</highlight></codeline>
<codeline lineno="1450"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1aac9ea73afc147fa4aad9a3e0b1d62adc" kindref="member">ppar</ref><sp/><sp/>=<sp/>ppar;</highlight></codeline>
<codeline lineno="1451"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a52ac6ad583818871d6dd6aee78d27779" kindref="member">mu</ref><sp/><sp/><sp/><sp/>=<sp/>mu;</highlight></codeline>
<codeline lineno="1452"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a32910eee2ba00869e56a165347883837" kindref="member">zeta</ref><sp/><sp/>=<sp/>zeta;</highlight></codeline>
<codeline lineno="1453"><highlight class="normal"></highlight></codeline>
<codeline lineno="1454"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1ab8ae01c7daaff543bbebcd5c59944b11" kindref="member">rho</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>rho[0];</highlight></codeline>
<codeline lineno="1455"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1ab8c38c260bf35d18b4efc8a4d3f3c42e" kindref="member">B_r</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[0];</highlight></codeline>
<codeline lineno="1456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a1f2fffa46d75cc9b4055222250753a5e" kindref="member">B_phi</ref><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[4];</highlight></codeline>
<codeline lineno="1457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a1260984dc0fc5d7ae30b7fe9a9cbd5e6" kindref="member">B_z</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[8];</highlight></codeline>
<codeline lineno="1458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1ac64189647aa40512c29a609adf5744be" kindref="member">B_r_dr</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[1];</highlight></codeline>
<codeline lineno="1459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1ad89fb268bfcbe2d0165be251abe01ddb" kindref="member">B_phi_dr</ref><sp/><sp/><sp/>=<sp/>B_dB[5];</highlight></codeline>
<codeline lineno="1460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1aab09ae9b71c12634da8be01ae2f8d0b3" kindref="member">B_z_dr</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[9];</highlight></codeline>
<codeline lineno="1461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1afe87a52e03d76b50c2ff6c61392cb242" kindref="member">B_r_dphi</ref><sp/><sp/><sp/>=<sp/>B_dB[2];</highlight></codeline>
<codeline lineno="1462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a6ce8b04b942d4ed9c35b506fa98614f5" kindref="member">B_phi_dphi</ref><sp/>=<sp/>B_dB[6];</highlight></codeline>
<codeline lineno="1463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1aa6876cfa0d7b3ccd513c67b7d58ae9e3" kindref="member">B_z_dphi</ref><sp/><sp/><sp/>=<sp/>B_dB[10];</highlight></codeline>
<codeline lineno="1464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a5ab2aeaf91174744fe61c542de1d466d" kindref="member">B_r_dz</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[3];</highlight></codeline>
<codeline lineno="1465"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a16c1e0bf43ce272246712d2e869f5413" kindref="member">B_phi_dz</ref><sp/><sp/><sp/>=<sp/>B_dB[7];</highlight></codeline>
<codeline lineno="1466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a5f91b582caef69702f8ff981f8f32fa2" kindref="member">B_z_dz</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[11];</highlight></codeline>
<codeline lineno="1467"><highlight class="normal"></highlight></codeline>
<codeline lineno="1468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1abefd34d479201d01ff36e4497def613d" kindref="member">err</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1469"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1470"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>err;</highlight></codeline>
<codeline lineno="1471"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1472"><highlight class="normal"></highlight></codeline>
<codeline lineno="1482" refid="particle_8c_1a12ad353368240274650bbe5f702b0ec4" refkind="member"><highlight class="normal"><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/><ref refid="particle_8c_1a12ad353368240274650bbe5f702b0ec4" kindref="member">particle_input_gc_to_state</ref>(<ref refid="structparticle__gc" kindref="compound">particle_gc</ref>*<sp/>p,<sp/><ref refid="structparticle__state" kindref="compound">particle_state</ref>*<sp/>ps,</highlight></codeline>
<codeline lineno="1483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structB__field__data" kindref="compound">B_field_data</ref>*<sp/>Bdata)<sp/>{</highlight></codeline>
<codeline lineno="1484"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/>err<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1485"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>axisrz[2];</highlight></codeline>
<codeline lineno="1486"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>B_dB[15],<sp/>psi[1],<sp/>rho[2];</highlight></codeline>
<codeline lineno="1487"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="1488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="B__field_8c_1a90eee159b997ec948d58e1b760f7a555" kindref="member">B_field_eval_B_dB</ref>(B_dB,<sp/>p-&gt;<ref refid="structparticle__gc_1ae76b26b01bca6ea35f9297963cf382f6" kindref="member">r</ref>,<sp/>p-&gt;<ref refid="structparticle__gc_1a92f2ebceeaa41df0f39a3f4953667243" kindref="member">phi</ref>,<sp/>p-&gt;<ref refid="structparticle__gc_1a74e44c0c2555ca3a8f5828ce206fc70d" kindref="member">z</ref>,<sp/>p-&gt;<ref refid="structparticle__gc_1a9e9082a56751b48da255b56a9547c54c" kindref="member">time</ref>,<sp/>Bdata);</highlight></codeline>
<codeline lineno="1489"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1490"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="1491"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="B__field_8c_1a48c1f881a5f7fc9bf2d04edadfc2becf" kindref="member">B_field_eval_psi</ref>(psi,<sp/>p-&gt;<ref refid="structparticle__gc_1ae76b26b01bca6ea35f9297963cf382f6" kindref="member">r</ref>,<sp/>p-&gt;<ref refid="structparticle__gc_1a92f2ebceeaa41df0f39a3f4953667243" kindref="member">phi</ref>,<sp/>p-&gt;<ref refid="structparticle__gc_1a74e44c0c2555ca3a8f5828ce206fc70d" kindref="member">z</ref>,<sp/>p-&gt;<ref refid="structparticle__gc_1a9e9082a56751b48da255b56a9547c54c" kindref="member">time</ref>,<sp/>Bdata);</highlight></codeline>
<codeline lineno="1492"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1493"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="1494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="B__field_8c_1a3e0114363493349f81a78142e70f2bd4" kindref="member">B_field_eval_rho</ref>(rho,<sp/>psi[0],<sp/>Bdata);</highlight></codeline>
<codeline lineno="1495"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1496"><highlight class="normal"></highlight></codeline>
<codeline lineno="1497"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="1498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1ab8ae01c7daaff543bbebcd5c59944b11" kindref="member">rho</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>rho[0];</highlight></codeline>
<codeline lineno="1499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1ab8c38c260bf35d18b4efc8a4d3f3c42e" kindref="member">B_r</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[0];</highlight></codeline>
<codeline lineno="1500"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a1f2fffa46d75cc9b4055222250753a5e" kindref="member">B_phi</ref><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[4];</highlight></codeline>
<codeline lineno="1501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a1260984dc0fc5d7ae30b7fe9a9cbd5e6" kindref="member">B_z</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[8];</highlight></codeline>
<codeline lineno="1502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1ac64189647aa40512c29a609adf5744be" kindref="member">B_r_dr</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[1];</highlight></codeline>
<codeline lineno="1503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1ad89fb268bfcbe2d0165be251abe01ddb" kindref="member">B_phi_dr</ref><sp/><sp/><sp/>=<sp/>B_dB[5];</highlight></codeline>
<codeline lineno="1504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1aab09ae9b71c12634da8be01ae2f8d0b3" kindref="member">B_z_dr</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[9];</highlight></codeline>
<codeline lineno="1505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1afe87a52e03d76b50c2ff6c61392cb242" kindref="member">B_r_dphi</ref><sp/><sp/><sp/>=<sp/>B_dB[2];</highlight></codeline>
<codeline lineno="1506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a6ce8b04b942d4ed9c35b506fa98614f5" kindref="member">B_phi_dphi</ref><sp/>=<sp/>B_dB[6];</highlight></codeline>
<codeline lineno="1507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1aa6876cfa0d7b3ccd513c67b7d58ae9e3" kindref="member">B_z_dphi</ref><sp/><sp/><sp/>=<sp/>B_dB[10];</highlight></codeline>
<codeline lineno="1508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a5ab2aeaf91174744fe61c542de1d466d" kindref="member">B_r_dz</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[3];</highlight></codeline>
<codeline lineno="1509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a16c1e0bf43ce272246712d2e869f5413" kindref="member">B_phi_dz</ref><sp/><sp/><sp/>=<sp/>B_dB[7];</highlight></codeline>
<codeline lineno="1510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a5f91b582caef69702f8ff981f8f32fa2" kindref="member">B_z_dz</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[11];</highlight></codeline>
<codeline lineno="1511"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1512"><highlight class="normal"></highlight></codeline>
<codeline lineno="1513"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Input<sp/>is<sp/>in<sp/>(Ekin,xi)<sp/>coordinates<sp/>but<sp/>state<sp/>needs<sp/>(mu,vpar)<sp/>so<sp/>we<sp/>need</highlight></codeline>
<codeline lineno="1514"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>to<sp/>do<sp/>that<sp/>transformation<sp/>first.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1515"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>gamma,<sp/>mu,<sp/>ppar;</highlight></codeline>
<codeline lineno="1516"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="1517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>From<sp/>kinetic<sp/>energy<sp/>we<sp/>get<sp/>Lorentz<sp/>factor<sp/>as<sp/>gamma<sp/>=<sp/>1<sp/>+<sp/>Ekin/mc^2<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1518"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gamma<sp/>=<sp/>1<sp/>+<sp/>p-&gt;<ref refid="structparticle__gc_1a54b77f0fa9cd14177c8bf5914574cd9a" kindref="member">energy</ref><sp/>/<sp/>(p-&gt;<ref refid="structparticle__gc_1ae27701c7ad3396abab1669c6a9bd1b9a" kindref="member">mass</ref><sp/>*<sp/><ref refid="consts_8h_1ae427b19ef34c352c69b3e565d55427b7" kindref="member">CONST_C2</ref>);</highlight></codeline>
<codeline lineno="1519"><highlight class="normal"></highlight></codeline>
<codeline lineno="1520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>And<sp/>then<sp/>we<sp/>can<sp/>use<sp/>the<sp/>formula<sp/>for<sp/>Lorentz<sp/>factor<sp/>to<sp/>get<sp/>total<sp/>momentum<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1521"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>pnorm<sp/>=<sp/>sqrt(<sp/>gamma<sp/>*<sp/>gamma<sp/>-<sp/>1<sp/>)<sp/>*<sp/>p-&gt;<ref refid="structparticle__gc_1ae27701c7ad3396abab1669c6a9bd1b9a" kindref="member">mass</ref><sp/>*<sp/><ref refid="consts_8h_1a48339a730ee12d23d732ee7ce96f0aa6" kindref="member">CONST_C</ref>;</highlight></codeline>
<codeline lineno="1522"><highlight class="normal"></highlight></codeline>
<codeline lineno="1523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Now<sp/>we<sp/>can<sp/>use<sp/>library<sp/>functions<sp/>for<sp/>transformation<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>Bnorm<sp/>=<sp/><ref refid="math_8h_1abd3175f6bee0adbe5ac6a37d856aa407" kindref="member">math_normc</ref>(B_dB[0],<sp/>B_dB[4],<sp/>B_dB[8]);</highlight></codeline>
<codeline lineno="1525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ppar<sp/>=<sp/><ref refid="physlib_8h_1aa1dbc69571399440e12326af0883b974" kindref="member">physlib_gc_ppar</ref>(pnorm,<sp/>p-&gt;<ref refid="structparticle__gc_1a87b3fe581ea9fa7081499876b3ccfe42" kindref="member">pitch</ref>);</highlight></codeline>
<codeline lineno="1526"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mu<sp/><sp/><sp/>=<sp/><ref refid="physlib_8h_1abb58f0d726d24072d618b68721940d52" kindref="member">physlib_gc_mu</ref>(p-&gt;<ref refid="structparticle__gc_1ae27701c7ad3396abab1669c6a9bd1b9a" kindref="member">mass</ref>,<sp/>pnorm,<sp/>p-&gt;<ref refid="structparticle__gc_1a87b3fe581ea9fa7081499876b3ccfe42" kindref="member">pitch</ref>,<sp/>Bnorm);</highlight></codeline>
<codeline lineno="1527"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1528"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err<sp/>&amp;&amp;<sp/>mu<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92a009d0727e7fb6bdffc7ea94fe04c4903" kindref="member">ERR_MARKER_UNPHYSICAL</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddaf1cf6bea1dd479b3f3efaaedf3637ecd" kindref="member">EF_PARTICLE</ref>);</highlight></codeline>
<codeline lineno="1530"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1531"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="1532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="B__field_8c_1ad8cf51ecdc7730eca39eb54ef4484a2d" kindref="member">B_field_get_axis_rz</ref>(axisrz,<sp/>Bdata,<sp/>p-&gt;<ref refid="structparticle__gc_1a92f2ebceeaa41df0f39a3f4953667243" kindref="member">phi</ref>);</highlight></codeline>
<codeline lineno="1533"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1534"><highlight class="normal"></highlight></codeline>
<codeline lineno="1535"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="1536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a3f8be755cb8baac1b13a68d90c59c3f5" kindref="member">r</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__gc_1ae76b26b01bca6ea35f9297963cf382f6" kindref="member">r</ref>;</highlight></codeline>
<codeline lineno="1537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1aff41ea912d6616b74496ce6acb2e5b7e" kindref="member">phi</ref><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__gc_1a92f2ebceeaa41df0f39a3f4953667243" kindref="member">phi</ref>;</highlight></codeline>
<codeline lineno="1538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1af550bffa561085f7c0b775bd43ccaed2" kindref="member">z</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__gc_1a74e44c0c2555ca3a8f5828ce206fc70d" kindref="member">z</ref>;</highlight></codeline>
<codeline lineno="1539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a52ac6ad583818871d6dd6aee78d27779" kindref="member">mu</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>mu;</highlight></codeline>
<codeline lineno="1540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1aac9ea73afc147fa4aad9a3e0b1d62adc" kindref="member">ppar</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>ppar;</highlight></codeline>
<codeline lineno="1541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a32910eee2ba00869e56a165347883837" kindref="member">zeta</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__gc_1a242d9441267b0bb37f938e8883ca0614" kindref="member">zeta</ref>;</highlight></codeline>
<codeline lineno="1542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1ac2d207ee9934020ee0e5fa0740c5dc2e" kindref="member">mass</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__gc_1ae27701c7ad3396abab1669c6a9bd1b9a" kindref="member">mass</ref>;</highlight></codeline>
<codeline lineno="1543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a23139c51384acefa9689e370bb471bb9" kindref="member">charge</ref><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__gc_1aaddba727735c95bba3fad26a957cd081" kindref="member">charge</ref>;</highlight></codeline>
<codeline lineno="1544"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1ae5b792077ab165fa2175d7dcb7553b0e" kindref="member">anum</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__gc_1ad1e0819b4c0be85203aedc2a15526a07" kindref="member">anum</ref>;</highlight></codeline>
<codeline lineno="1545"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1ac2ded6c45152ab0d1f4c39b2c2442fb0" kindref="member">znum</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__gc_1a3ec941f526b643f7e6eefeb1d13dfc52" kindref="member">znum</ref>;</highlight></codeline>
<codeline lineno="1546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a1361c6ea896ed99423226c7bdcdd8aa4" kindref="member">weight</ref><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__gc_1a17660a9dd269c9039ad120d39f6ce9aa" kindref="member">weight</ref>;</highlight></codeline>
<codeline lineno="1547"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a17b0da1c3ecdcd972eb28f7b3f163eba" kindref="member">time</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__gc_1a9e9082a56751b48da255b56a9547c54c" kindref="member">time</ref>;</highlight></codeline>
<codeline lineno="1548"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a67998b97c3ee35af4c80f4135b7bd856" kindref="member">theta</ref><sp/><sp/><sp/><sp/>=<sp/>atan2(ps-&gt;<ref refid="structparticle__state_1af550bffa561085f7c0b775bd43ccaed2" kindref="member">z</ref>-axisrz[1],<sp/>ps-&gt;<ref refid="structparticle__state_1a3f8be755cb8baac1b13a68d90c59c3f5" kindref="member">r</ref>-axisrz[0]);</highlight></codeline>
<codeline lineno="1549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a47d5709d5e17ec1129064a1eb702b895" kindref="member">id</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__gc_1a566721bfbb323454d735f61d80eebfbd" kindref="member">id</ref>;</highlight></codeline>
<codeline lineno="1550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a09fe2854a148d4eb8449f202cf932466" kindref="member">mileage</ref><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1afba5ec956f0515668cba944ce1f02daf" kindref="member">endcond</ref><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a6c005013f55d58c7985d33c2dbfd5ef1" kindref="member">walltile</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1aa396877576f7a3bcecfae0ddefa84b0c" kindref="member">cputime</ref><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1554"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1555"><highlight class="normal"></highlight></codeline>
<codeline lineno="1556"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Guiding<sp/>center<sp/>transformation<sp/>to<sp/>get<sp/>particle<sp/>coordinates<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1557"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>rprt,<sp/>phiprt,<sp/>zprt,<sp/>pr,<sp/>pphi,<sp/>pz;</highlight></codeline>
<codeline lineno="1558"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="1559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>pparprt,<sp/>muprt,<sp/>zetaprt;</highlight></codeline>
<codeline lineno="1560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gctransform_8c_1a12a5a86dd709b92207016c3c3b9f530c" kindref="member">gctransform_guidingcenter2particle</ref>(</highlight></codeline>
<codeline lineno="1561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1ac2d207ee9934020ee0e5fa0740c5dc2e" kindref="member">mass</ref>,<sp/>ps-&gt;<ref refid="structparticle__state_1a23139c51384acefa9689e370bb471bb9" kindref="member">charge</ref>,<sp/>B_dB,</highlight></codeline>
<codeline lineno="1562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a3f8be755cb8baac1b13a68d90c59c3f5" kindref="member">r</ref>,<sp/>ps-&gt;<ref refid="structparticle__state_1aff41ea912d6616b74496ce6acb2e5b7e" kindref="member">phi</ref>,<sp/>ps-&gt;<ref refid="structparticle__state_1af550bffa561085f7c0b775bd43ccaed2" kindref="member">z</ref>,<sp/>ps-&gt;<ref refid="structparticle__state_1aac9ea73afc147fa4aad9a3e0b1d62adc" kindref="member">ppar</ref>,<sp/>ps-&gt;<ref refid="structparticle__state_1a52ac6ad583818871d6dd6aee78d27779" kindref="member">mu</ref>,<sp/>ps-&gt;<ref refid="structparticle__state_1a32910eee2ba00869e56a165347883837" kindref="member">zeta</ref>,</highlight></codeline>
<codeline lineno="1563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;rprt,<sp/>&amp;phiprt,<sp/>&amp;zprt,<sp/>&amp;pparprt,<sp/>&amp;muprt,<sp/>&amp;zetaprt);</highlight></codeline>
<codeline lineno="1564"><highlight class="normal"></highlight></codeline>
<codeline lineno="1565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="B__field_8c_1a90eee159b997ec948d58e1b760f7a555" kindref="member">B_field_eval_B_dB</ref>(B_dB,<sp/>rprt,<sp/>phiprt,<sp/>zprt,<sp/>ps-&gt;<ref refid="structparticle__state_1a17b0da1c3ecdcd972eb28f7b3f163eba" kindref="member">time</ref>,<sp/>Bdata);</highlight></codeline>
<codeline lineno="1566"><highlight class="normal"></highlight></codeline>
<codeline lineno="1567"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="gctransform_8c_1a8f102308b097afb80120cac2b895cbe8" kindref="member">gctransform_pparmuzeta2prpphipz</ref>(</highlight></codeline>
<codeline lineno="1568"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1ac2d207ee9934020ee0e5fa0740c5dc2e" kindref="member">mass</ref>,<sp/>ps-&gt;<ref refid="structparticle__state_1a23139c51384acefa9689e370bb471bb9" kindref="member">charge</ref>,<sp/>B_dB,</highlight></codeline>
<codeline lineno="1569"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>phiprt,<sp/>pparprt,<sp/>muprt,<sp/>zetaprt,</highlight></codeline>
<codeline lineno="1570"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;pr,<sp/>&amp;pphi,<sp/>&amp;pz);</highlight></codeline>
<codeline lineno="1571"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1572"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err<sp/>&amp;&amp;<sp/>rprt<sp/>&lt;=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1573"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92a009d0727e7fb6bdffc7ea94fe04c4903" kindref="member">ERR_MARKER_UNPHYSICAL</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddaf1cf6bea1dd479b3f3efaaedf3637ecd" kindref="member">EF_PARTICLE</ref>);</highlight></codeline>
<codeline lineno="1574"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1575"><highlight class="normal"></highlight></codeline>
<codeline lineno="1576"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="1577"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a327fd67d35cc4fb8f83e442109b8c846" kindref="member">rprt</ref><sp/><sp/><sp/>=<sp/>rprt;</highlight></codeline>
<codeline lineno="1578"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a2ffcee71bbfed82201f3e3641756b6cb" kindref="member">phiprt</ref><sp/>=<sp/>phiprt;</highlight></codeline>
<codeline lineno="1579"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1afe6f3b950482634327607b34de5fd70a" kindref="member">zprt</ref><sp/><sp/><sp/>=<sp/>zprt;</highlight></codeline>
<codeline lineno="1580"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1ae054cde64c773b1d4a762d520b91e66e" kindref="member">p_r</ref><sp/><sp/><sp/><sp/>=<sp/>pr;</highlight></codeline>
<codeline lineno="1581"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a22435dc975a3e26284b88e7d3e301d8a" kindref="member">p_phi</ref><sp/><sp/>=<sp/>pphi;</highlight></codeline>
<codeline lineno="1582"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a70e5a31a5aab3fdf5ad11e5aa924ba38" kindref="member">p_z</ref><sp/><sp/><sp/><sp/>=<sp/>pz;</highlight></codeline>
<codeline lineno="1583"><highlight class="normal"></highlight></codeline>
<codeline lineno="1584"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1abefd34d479201d01ff36e4497def613d" kindref="member">err</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1585"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1586"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>err;</highlight></codeline>
<codeline lineno="1587"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1588"><highlight class="normal"></highlight></codeline>
<codeline lineno="1598" refid="particle_8c_1a8b10f6fd186df181f734315548328fec" refkind="member"><highlight class="normal"><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/><ref refid="particle_8c_1a8b10f6fd186df181f734315548328fec" kindref="member">particle_input_ml_to_state</ref>(<ref refid="structparticle__ml" kindref="compound">particle_ml</ref>*<sp/>p,<sp/><ref refid="structparticle__state" kindref="compound">particle_state</ref>*<sp/>ps,</highlight></codeline>
<codeline lineno="1599"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structB__field__data" kindref="compound">B_field_data</ref>*<sp/>Bdata)<sp/>{</highlight></codeline>
<codeline lineno="1600"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/>err<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1601"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>axisrz[2];</highlight></codeline>
<codeline lineno="1602"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>B_dB[15],<sp/>psi[1],<sp/>rho[2];</highlight></codeline>
<codeline lineno="1603"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="1604"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="B__field_8c_1a90eee159b997ec948d58e1b760f7a555" kindref="member">B_field_eval_B_dB</ref>(B_dB,<sp/>p-&gt;<ref refid="structparticle__ml_1a5e08192d0450f97c6dc635a71d5d6ec0" kindref="member">r</ref>,<sp/>p-&gt;<ref refid="structparticle__ml_1a51213eb9851611920150fa8b15af0a4b" kindref="member">phi</ref>,<sp/>p-&gt;<ref refid="structparticle__ml_1a18adda32fda67b0b1b3eda43d8e1dbbd" kindref="member">z</ref>,<sp/>p-&gt;<ref refid="structparticle__ml_1a3dd1bbf090918fe0ca6507c8abb76eea" kindref="member">time</ref>,<sp/>Bdata);</highlight></codeline>
<codeline lineno="1605"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1606"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="1607"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="B__field_8c_1a48c1f881a5f7fc9bf2d04edadfc2becf" kindref="member">B_field_eval_psi</ref>(psi,<sp/>p-&gt;<ref refid="structparticle__ml_1a5e08192d0450f97c6dc635a71d5d6ec0" kindref="member">r</ref>,<sp/>p-&gt;<ref refid="structparticle__ml_1a51213eb9851611920150fa8b15af0a4b" kindref="member">phi</ref>,<sp/>p-&gt;<ref refid="structparticle__ml_1a18adda32fda67b0b1b3eda43d8e1dbbd" kindref="member">z</ref>,<sp/>p-&gt;<ref refid="structparticle__ml_1a3dd1bbf090918fe0ca6507c8abb76eea" kindref="member">time</ref>,<sp/>Bdata);</highlight></codeline>
<codeline lineno="1608"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1609"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="1610"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="B__field_8c_1a3e0114363493349f81a78142e70f2bd4" kindref="member">B_field_eval_rho</ref>(rho,<sp/>psi[0],<sp/>Bdata);</highlight></codeline>
<codeline lineno="1611"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1612"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="1613"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="B__field_8c_1ad8cf51ecdc7730eca39eb54ef4484a2d" kindref="member">B_field_get_axis_rz</ref>(axisrz,<sp/>Bdata,<sp/>p-&gt;<ref refid="structparticle__ml_1a51213eb9851611920150fa8b15af0a4b" kindref="member">phi</ref>);</highlight></codeline>
<codeline lineno="1614"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1615"><highlight class="normal"></highlight></codeline>
<codeline lineno="1616"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err)<sp/>{</highlight></codeline>
<codeline lineno="1617"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a327fd67d35cc4fb8f83e442109b8c846" kindref="member">rprt</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__ml_1a5e08192d0450f97c6dc635a71d5d6ec0" kindref="member">r</ref>;</highlight></codeline>
<codeline lineno="1618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a2ffcee71bbfed82201f3e3641756b6cb" kindref="member">phiprt</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__ml_1a51213eb9851611920150fa8b15af0a4b" kindref="member">phi</ref>;</highlight></codeline>
<codeline lineno="1619"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1afe6f3b950482634327607b34de5fd70a" kindref="member">zprt</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__ml_1a18adda32fda67b0b1b3eda43d8e1dbbd" kindref="member">z</ref>;</highlight></codeline>
<codeline lineno="1620"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1ae054cde64c773b1d4a762d520b91e66e" kindref="member">p_r</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1621"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a22435dc975a3e26284b88e7d3e301d8a" kindref="member">p_phi</ref><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1622"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a70e5a31a5aab3fdf5ad11e5aa924ba38" kindref="member">p_z</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1623"><highlight class="normal"></highlight></codeline>
<codeline lineno="1624"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1ac2d207ee9934020ee0e5fa0740c5dc2e" kindref="member">mass</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1625"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a23139c51384acefa9689e370bb471bb9" kindref="member">charge</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1626"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1ae5b792077ab165fa2175d7dcb7553b0e" kindref="member">anum</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1627"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1ac2ded6c45152ab0d1f4c39b2c2442fb0" kindref="member">znum</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1628"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a1361c6ea896ed99423226c7bdcdd8aa4" kindref="member">weight</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__ml_1af660d4a268dd37b8a2307bcd360c3d5f" kindref="member">weight</ref>;</highlight></codeline>
<codeline lineno="1629"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a17b0da1c3ecdcd972eb28f7b3f163eba" kindref="member">time</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__ml_1a3dd1bbf090918fe0ca6507c8abb76eea" kindref="member">time</ref>;</highlight></codeline>
<codeline lineno="1630"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a47d5709d5e17ec1129064a1eb702b895" kindref="member">id</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__ml_1afdd7be2e06ee4366b05ae7fd4705e7f9" kindref="member">id</ref>;</highlight></codeline>
<codeline lineno="1631"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a67998b97c3ee35af4c80f4135b7bd856" kindref="member">theta</ref><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>atan2(p-&gt;<ref refid="structparticle__ml_1a18adda32fda67b0b1b3eda43d8e1dbbd" kindref="member">z</ref><sp/>-<sp/>axisrz[1],<sp/>p-&gt;<ref refid="structparticle__ml_1a5e08192d0450f97c6dc635a71d5d6ec0" kindref="member">r</ref><sp/>-<sp/>axisrz[0]);</highlight></codeline>
<codeline lineno="1632"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1afba5ec956f0515668cba944ce1f02daf" kindref="member">endcond</ref><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1633"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a6c005013f55d58c7985d33c2dbfd5ef1" kindref="member">walltile</ref><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1634"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1aa396877576f7a3bcecfae0ddefa84b0c" kindref="member">cputime</ref><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1635"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a09fe2854a148d4eb8449f202cf932466" kindref="member">mileage</ref><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1636"><highlight class="normal"></highlight></codeline>
<codeline lineno="1637"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a3f8be755cb8baac1b13a68d90c59c3f5" kindref="member">r</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__ml_1a5e08192d0450f97c6dc635a71d5d6ec0" kindref="member">r</ref>;</highlight></codeline>
<codeline lineno="1638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1aff41ea912d6616b74496ce6acb2e5b7e" kindref="member">phi</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__ml_1a51213eb9851611920150fa8b15af0a4b" kindref="member">phi</ref>;</highlight></codeline>
<codeline lineno="1639"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1af550bffa561085f7c0b775bd43ccaed2" kindref="member">z</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__ml_1a18adda32fda67b0b1b3eda43d8e1dbbd" kindref="member">z</ref>;</highlight></codeline>
<codeline lineno="1640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1aac9ea73afc147fa4aad9a3e0b1d62adc" kindref="member">ppar</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>p-&gt;<ref refid="structparticle__ml_1a805f3a9ec70fde2b0b4dde921b5fba42" kindref="member">pitch</ref><sp/>&gt;=<sp/>0;</highlight></codeline>
<codeline lineno="1641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a52ac6ad583818871d6dd6aee78d27779" kindref="member">mu</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1642"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a32910eee2ba00869e56a165347883837" kindref="member">zeta</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1643"><highlight class="normal"></highlight></codeline>
<codeline lineno="1644"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1ab8ae01c7daaff543bbebcd5c59944b11" kindref="member">rho</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>rho[0];</highlight></codeline>
<codeline lineno="1645"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1ab8c38c260bf35d18b4efc8a4d3f3c42e" kindref="member">B_r</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[0];</highlight></codeline>
<codeline lineno="1646"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a1f2fffa46d75cc9b4055222250753a5e" kindref="member">B_phi</ref><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[4];</highlight></codeline>
<codeline lineno="1647"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a1260984dc0fc5d7ae30b7fe9a9cbd5e6" kindref="member">B_z</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[8];</highlight></codeline>
<codeline lineno="1648"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1ac64189647aa40512c29a609adf5744be" kindref="member">B_r_dr</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[1];</highlight></codeline>
<codeline lineno="1649"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1ad89fb268bfcbe2d0165be251abe01ddb" kindref="member">B_phi_dr</ref><sp/><sp/><sp/>=<sp/>B_dB[5];</highlight></codeline>
<codeline lineno="1650"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1aab09ae9b71c12634da8be01ae2f8d0b3" kindref="member">B_z_dr</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[9];</highlight></codeline>
<codeline lineno="1651"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1afe87a52e03d76b50c2ff6c61392cb242" kindref="member">B_r_dphi</ref><sp/><sp/><sp/>=<sp/>B_dB[2];</highlight></codeline>
<codeline lineno="1652"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a6ce8b04b942d4ed9c35b506fa98614f5" kindref="member">B_phi_dphi</ref><sp/>=<sp/>B_dB[6];</highlight></codeline>
<codeline lineno="1653"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1aa6876cfa0d7b3ccd513c67b7d58ae9e3" kindref="member">B_z_dphi</ref><sp/><sp/><sp/>=<sp/>B_dB[10];</highlight></codeline>
<codeline lineno="1654"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a5ab2aeaf91174744fe61c542de1d466d" kindref="member">B_r_dz</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[3];</highlight></codeline>
<codeline lineno="1655"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a16c1e0bf43ce272246712d2e869f5413" kindref="member">B_phi_dz</ref><sp/><sp/><sp/>=<sp/>B_dB[7];</highlight></codeline>
<codeline lineno="1656"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1a5f91b582caef69702f8ff981f8f32fa2" kindref="member">B_z_dz</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>B_dB[11];</highlight></codeline>
<codeline lineno="1657"><highlight class="normal"></highlight></codeline>
<codeline lineno="1658"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ps-&gt;<ref refid="structparticle__state_1abefd34d479201d01ff36e4497def613d" kindref="member">err</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1659"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1660"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>err;</highlight></codeline>
<codeline lineno="1661"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="particle.c"/>
  </compounddef>
</doxygen>
