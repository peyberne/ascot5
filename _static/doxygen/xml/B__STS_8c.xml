<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.9.1" xml:lang="en-US">
  <compounddef id="B__STS_8c" kind="file" language="C++">
    <compoundname>B_STS.c</compoundname>
    <includes local="no">stdlib.h</includes>
    <includes local="no">stdio.h</includes>
    <includes refid="math_8h" local="no">math.h</includes>
    <includes local="no">string.h</includes>
    <includes refid="ascot5_8h" local="yes">../ascot5.h</includes>
    <includes refid="error_8h" local="yes">../error.h</includes>
    <includes refid="print_8h" local="yes">../print.h</includes>
    <includes refid="consts_8h" local="yes">../consts.h</includes>
    <includes refid="B__STS_8h" local="yes">B_STS.h</includes>
    <includes refid="linint_8h" local="yes">../linint/linint.h</includes>
    <includes refid="interp_8h" local="yes">../spline/interp.h</includes>
    <incdepgraph>
      <node id="14">
        <label>../spline/interp.h</label>
        <link refid="interp_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>stdlib.h</label>
      </node>
      <node id="6">
        <label>omp.h</label>
      </node>
      <node id="11">
        <label>../consts.h</label>
        <link refid="consts_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="8">
        <label>string.h</label>
      </node>
      <node id="9">
        <label>../error.h</label>
        <link refid="error_8h"/>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
      </node>
      <node id="7">
        <label>time.h</label>
      </node>
      <node id="13">
        <label>../linint/linint.h</label>
        <link refid="linint_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
      </node>
      <node id="4">
        <label>math.h</label>
        <link refid="math_8h"/>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="3">
        <label>stdio.h</label>
      </node>
      <node id="1">
        <label>Bfield/B_STS.c</label>
        <link refid="B__STS_8c"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
      </node>
      <node id="12">
        <label>B_STS.h</label>
        <link refid="B__STS_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
      </node>
      <node id="10">
        <label>../print.h</label>
        <link refid="print_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
      </node>
      <node id="5">
        <label>ascot5.h</label>
        <link refid="ascot5_8h"/>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
      </node>
    </incdepgraph>
      <sectiondef kind="func">
      <memberdef kind="function" id="B__STS_8c_1acb08fede18445a4c412118c8d0dca978" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int B_STS_init_offload</definition>
        <argsstring>(B_STS_offload_data *offload_data, real **offload_array)</argsstring>
        <name>B_STS_init_offload</name>
        <param>
          <type><ref refid="structB__STS__offload__data" kindref="compound">B_STS_offload_data</ref> *</type>
          <declname>offload_data</declname>
        </param>
        <param>
          <type><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref> **</type>
          <declname>offload_array</declname>
        </param>
        <briefdescription>
<para>Initialize magnetic field offload data. </para>
        </briefdescription>
        <detaileddescription>
<para>This function takes pre-initialized offload data struct and offload array as inputs. The data is used to fill rest of the offload struct and to construct bicubic splines whose coefficients are stored in re-allocated offload array.</para>
<para>The offload data struct must have the following fields initialized:<itemizedlist>
<listitem><para><ref refid="structB__STS__offload__data_1a50e04b8ab11a89e5a4f29ecaf1ea1573" kindref="member">B_STS_offload_data.psigrid_n_r</ref></para>
</listitem><listitem><para><ref refid="structB__STS__offload__data_1a5ffe499c0fd9b6009dfdf813166d4aa4" kindref="member">B_STS_offload_data.psigrid_n_z</ref></para>
</listitem><listitem><para><ref refid="structB__STS__offload__data_1ab31e20167ed1d672044bbe108ea5f602" kindref="member">B_STS_offload_data.psigrid_r_min</ref></para>
</listitem><listitem><para><ref refid="structB__STS__offload__data_1a3a480cf9f7d4007df7e106ea7df88d1e" kindref="member">B_STS_offload_data.psigrid_r_max</ref></para>
</listitem><listitem><para><ref refid="structB__STS__offload__data_1a8e3596f9a94ff07261a6929bb1d296b2" kindref="member">B_STS_offload_data.psigrid_z_min</ref></para>
</listitem><listitem><para><ref refid="structB__STS__offload__data_1ad46dd1514071eed06c863e19a7a631da" kindref="member">B_STS_offload_data.psigrid_z_max</ref></para>
</listitem><listitem><para><ref refid="structB__STS__offload__data_1a8ff93d52cf96ba117825ecbf2702c7f9" kindref="member">B_STS_offload_data.Bgrid_n_r</ref></para>
</listitem><listitem><para><ref refid="structB__STS__offload__data_1a1c72a6f0d0da54683a76f034607213b0" kindref="member">B_STS_offload_data.Bgrid_n_z</ref></para>
</listitem><listitem><para><ref refid="structB__STS__offload__data_1a773fc93d73f4a80de4c921987ea7c748" kindref="member">B_STS_offload_data.Bgrid_r_min</ref></para>
</listitem><listitem><para><ref refid="structB__STS__offload__data_1a45039e3abde1bd111f38ba1ed79660eb" kindref="member">B_STS_offload_data.Bgrid_r_max</ref></para>
</listitem><listitem><para><ref refid="structB__STS__offload__data_1ae99124dd78b232b2b62a05824fc8a6d5" kindref="member">B_STS_offload_data.Bgrid_z_min</ref></para>
</listitem><listitem><para><ref refid="structB__STS__offload__data_1ac47c2705403f4ccb098e22771f7d5af2" kindref="member">B_STS_offload_data.Bgrid_z_max</ref></para>
</listitem><listitem><para><ref refid="structB__STS__offload__data_1abf966e39cc3a4c5717164d0398a2acd5" kindref="member">B_STS_offload_data.Bgrid_n_phi</ref></para>
</listitem><listitem><para><ref refid="structB__STS__offload__data_1a698c44e0e05bdf9138709d529eeeb1fa" kindref="member">B_STS_offload_data.Bgrid_phi_min</ref></para>
</listitem><listitem><para><ref refid="structB__STS__offload__data_1a4f71d7f076713ea9e1b54bc4efcd3bd7" kindref="member">B_STS_offload_data.Bgrid_phi_max</ref></para>
</listitem><listitem><para><ref refid="structB__STS__offload__data_1a7a86a77e6cf336cd0a3fb073a31757f4" kindref="member">B_STS_offload_data.n_axis</ref></para>
</listitem><listitem><para><ref refid="structB__STS__offload__data_1aefb9cd0a4aeea861c5d998095738fe88" kindref="member">B_STS_offload_data.axis_min</ref></para>
</listitem><listitem><para><ref refid="structB__STS__offload__data_1a9fe8a3ee79e5c310ae79f639c1abb0bd" kindref="member">B_STS_offload_data.axis_max</ref></para>
</listitem><listitem><para><ref refid="structB__STS__offload__data_1a2dd7a225b953960a33d7855daf408f02" kindref="member">B_STS_offload_data.psi0</ref></para>
</listitem><listitem><para><ref refid="structB__STS__offload__data_1a0810bad345e1bf552973c8e16419ae4a" kindref="member">B_STS_offload_data.psi1</ref></para>
</listitem><listitem><para>B_STS_offload_data.axis_r</para>
</listitem><listitem><para>B_STS_offload_data.axis_z</para>
</listitem></itemizedlist>
</para>
<para><ref refid="structB__STS__offload__data_1a4a5bc280010988ef4ca24a57a44c46f2" kindref="member">B_STS_offload_data.offload_array_length</ref> is set here.</para>
<para>The offload array must contain the following data:<itemizedlist>
<listitem><para>offload_array[ z*Bn_r*Bn_z + j*Bn_r + i] = B_R(R_i, phi_z, z_j) [T]</para>
</listitem><listitem><para>offload_array[ Bn_r*Bn_z*Bn_phi + z*Bn_r*Bn_z + j*Bn_r + i] = B_phi(R_i, phi_z, z_j) [T]</para>
</listitem><listitem><para>offload_array[2*Bn_r*Bn_z*Bn_phi + z*Bn_r*Bn_z + j*Bn_r + i] = B_z(R_i, phi_z, z_j) [T]</para>
</listitem><listitem><para>offload_array[3*Bn_r*Bn_z*Bn_phi + z*psin_r*psin_z + j*psin_r + i] = psi(R_i, phi_z, z_j) [V*s*m^-1]</para>
</listitem><listitem><para>offload_array[3*Bn_r*Bn_z*Bn_phi + psin_r*psin_z*psin_phi + z] = axis_R(phi_z) [m]</para>
</listitem><listitem><para>offload_array[3*Bn_r*Bn_z*Bn_phi + psin_r*psin_z*psin_phi + n_axis + z] = axis_z(phi_z) [m]</para>
</listitem></itemizedlist>
</para>
<para>Sanity checks are printed if data was initialized succesfully.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>offload_data</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to offload data struct </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>offload_array</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to offload array which is reallocated here</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>zero if initialization succeeded </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Bfield/B_STS.c" line="98" column="5" bodyfile="Bfield/B_STS.c" bodystart="98" bodyend="217"/>
      </memberdef>
      <memberdef kind="function" id="B__STS_8c_1a6f091681bce5d60c97023e6b289aec68" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void B_STS_free_offload</definition>
        <argsstring>(B_STS_offload_data *offload_data, real **offload_array)</argsstring>
        <name>B_STS_free_offload</name>
        <param>
          <type><ref refid="structB__STS__offload__data" kindref="compound">B_STS_offload_data</ref> *</type>
          <declname>offload_data</declname>
        </param>
        <param>
          <type><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref> **</type>
          <declname>offload_array</declname>
        </param>
        <briefdescription>
<para>Free offload array. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>offload_data</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to offload data struct </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>offload_array</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to pointer to offload array </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Bfield/B_STS.c" line="225" column="6" bodyfile="Bfield/B_STS.c" bodystart="225" bodyend="228"/>
      </memberdef>
      <memberdef kind="function" id="B__STS_8c_1a931ef0d099dc26a73c7658aa0978c098" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void B_STS_init</definition>
        <argsstring>(B_STS_data *Bdata, B_STS_offload_data *offload_data, real *offload_array)</argsstring>
        <name>B_STS_init</name>
        <param>
          <type><ref refid="structB__STS__data" kindref="compound">B_STS_data</ref> *</type>
          <declname>Bdata</declname>
        </param>
        <param>
          <type><ref refid="structB__STS__offload__data" kindref="compound">B_STS_offload_data</ref> *</type>
          <declname>offload_data</declname>
        </param>
        <param>
          <type><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref> *</type>
          <declname>offload_array</declname>
        </param>
        <briefdescription>
<para>Initialize magnetic field data struct on target. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>Bdata</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to data struct on target </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>offload_data</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to offload data struct </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>offload_array</parametername>
</parameternamelist>
<parameterdescription>
<para>offload array </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Bfield/B_STS.c" line="237" column="6" bodyfile="Bfield/B_STS.c" bodystart="237" bodyend="309"/>
      </memberdef>
      <memberdef kind="function" id="B__STS_8c_1ad5644b9978d382c606bc01bdbe9fbd7b" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref></type>
        <definition>a5err B_STS_eval_psi</definition>
        <argsstring>(real *psi, real r, real phi, real z, B_STS_data *Bdata)</argsstring>
        <name>B_STS_eval_psi</name>
        <param>
          <type><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref> *</type>
          <declname>psi</declname>
        </param>
        <param>
          <type><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref></type>
          <declname>r</declname>
        </param>
        <param>
          <type><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref></type>
          <declname>phi</declname>
        </param>
        <param>
          <type><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref></type>
          <declname>z</declname>
        </param>
        <param>
          <type><ref refid="structB__STS__data" kindref="compound">B_STS_data</ref> *</type>
          <declname>Bdata</declname>
        </param>
        <briefdescription>
<para>Evaluate poloidal flux psi. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>psi</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer where psi [V*s*m^-1] value will be stored </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>r</parametername>
</parameternamelist>
<parameterdescription>
<para>R coordinate [m] </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>phi</parametername>
</parameternamelist>
<parameterdescription>
<para>phi coordinate [rad] </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>z</parametername>
</parameternamelist>
<parameterdescription>
<para>z coordinate [m] </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>Bdata</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to magnetic field data struct</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Non-zero a5err value if evaluation failed, zero otherwise </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Bfield/B_STS.c" line="322" column="7" bodyfile="Bfield/B_STS.c" bodystart="322" bodyend="341"/>
      </memberdef>
      <memberdef kind="function" id="B__STS_8c_1ae1cafb9166148608daf09e6bf4ae8db2" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref></type>
        <definition>a5err B_STS_eval_psi_dpsi</definition>
        <argsstring>(real psi_dpsi[4], real r, real phi, real z, B_STS_data *Bdata)</argsstring>
        <name>B_STS_eval_psi_dpsi</name>
        <param>
          <type><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref></type>
          <declname>psi_dpsi</declname>
          <array>[4]</array>
        </param>
        <param>
          <type><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref></type>
          <declname>r</declname>
        </param>
        <param>
          <type><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref></type>
          <declname>phi</declname>
        </param>
        <param>
          <type><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref></type>
          <declname>z</declname>
        </param>
        <param>
          <type><ref refid="structB__STS__data" kindref="compound">B_STS_data</ref> *</type>
          <declname>Bdata</declname>
        </param>
        <briefdescription>
<para>Evaluate poloidal flux psi and its derivatives. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>psi_dpsi</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer for storing psi [V*s*m^-1] and its derivatives </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>r</parametername>
</parameternamelist>
<parameterdescription>
<para>R coordinate [m] </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>phi</parametername>
</parameternamelist>
<parameterdescription>
<para>phi coordinate [rad] </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>z</parametername>
</parameternamelist>
<parameterdescription>
<para>z coordinate [m] </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>Bdata</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to magnetic field data struct</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Non-zero a5err value if evaluation failed, zero otherwise </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Bfield/B_STS.c" line="354" column="7" bodyfile="Bfield/B_STS.c" bodystart="354" bodyend="383"/>
      </memberdef>
      <memberdef kind="function" id="B__STS_8c_1a58b56b89cf87058455f51443068187b1" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref></type>
        <definition>a5err B_STS_eval_rho_drho</definition>
        <argsstring>(real rho_drho[4], real r, real phi, real z, B_STS_data *Bdata)</argsstring>
        <name>B_STS_eval_rho_drho</name>
        <param>
          <type><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref></type>
          <declname>rho_drho</declname>
          <array>[4]</array>
        </param>
        <param>
          <type><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref></type>
          <declname>r</declname>
        </param>
        <param>
          <type><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref></type>
          <declname>phi</declname>
        </param>
        <param>
          <type><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref></type>
          <declname>z</declname>
        </param>
        <param>
          <type><ref refid="structB__STS__data" kindref="compound">B_STS_data</ref> *</type>
          <declname>Bdata</declname>
        </param>
        <briefdescription>
<para>Evaluate normalized poloidal flux rho and its derivatives. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>rho_drho</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer where rho and its derivatives will be stored </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>r</parametername>
</parameternamelist>
<parameterdescription>
<para>R coordinate [m] </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>phi</parametername>
</parameternamelist>
<parameterdescription>
<para>phi coordinate [rad] </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>z</parametername>
</parameternamelist>
<parameterdescription>
<para>z coordinate [m] </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>Bdata</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to magnetic field data struct</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Non-zero a5err value if evaluation failed, zero otherwise </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Bfield/B_STS.c" line="396" column="7" bodyfile="Bfield/B_STS.c" bodystart="396" bodyend="432"/>
      </memberdef>
      <memberdef kind="function" id="B__STS_8c_1af6e97ba3be86103ac1233235ee1a9ab6" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref></type>
        <definition>a5err B_STS_eval_B</definition>
        <argsstring>(real B[3], real r, real phi, real z, B_STS_data *Bdata)</argsstring>
        <name>B_STS_eval_B</name>
        <param>
          <type><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref></type>
          <declname>B</declname>
          <array>[3]</array>
        </param>
        <param>
          <type><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref></type>
          <declname>r</declname>
        </param>
        <param>
          <type><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref></type>
          <declname>phi</declname>
        </param>
        <param>
          <type><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref></type>
          <declname>z</declname>
        </param>
        <param>
          <type><ref refid="structB__STS__data" kindref="compound">B_STS_data</ref> *</type>
          <declname>Bdata</declname>
        </param>
        <briefdescription>
<para>Evaluate magnetic field. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>B</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to array where magnetic field values are stored </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>r</parametername>
</parameternamelist>
<parameterdescription>
<para>R coordinate [m] </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>phi</parametername>
</parameternamelist>
<parameterdescription>
<para>phi coordinate [deg] </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>z</parametername>
</parameternamelist>
<parameterdescription>
<para>z coordinate [m] </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>Bdata</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to magnetic field data struct</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Non-zero a5err value if evaluation failed, zero otherwise </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Bfield/B_STS.c" line="445" column="7" bodyfile="Bfield/B_STS.c" bodystart="445" bodyend="467"/>
      </memberdef>
      <memberdef kind="function" id="B__STS_8c_1a93ec19559be9866c0d0b001e2818cc4e" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref></type>
        <definition>a5err B_STS_eval_B_dB</definition>
        <argsstring>(real B_dB[12], real r, real phi, real z, B_STS_data *Bdata)</argsstring>
        <name>B_STS_eval_B_dB</name>
        <param>
          <type><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref></type>
          <declname>B_dB</declname>
          <array>[12]</array>
        </param>
        <param>
          <type><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref></type>
          <declname>r</declname>
        </param>
        <param>
          <type><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref></type>
          <declname>phi</declname>
        </param>
        <param>
          <type><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref></type>
          <declname>z</declname>
        </param>
        <param>
          <type><ref refid="structB__STS__data" kindref="compound">B_STS_data</ref> *</type>
          <declname>Bdata</declname>
        </param>
        <briefdescription>
<para>Evaluate magnetic field and its derivatives. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>B_dB</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to array where the field and its derivatives are stored </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>r</parametername>
</parameternamelist>
<parameterdescription>
<para>R coordinate [m] </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>phi</parametername>
</parameternamelist>
<parameterdescription>
<para>phi coordinate [deg] </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>z</parametername>
</parameternamelist>
<parameterdescription>
<para>z coordinate [m] </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>Bdata</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to magnetic field data struct</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Non-zero a5err value if evaluation failed, zero otherwise </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Bfield/B_STS.c" line="480" column="7" bodyfile="Bfield/B_STS.c" bodystart="480" bodyend="520"/>
      </memberdef>
      <memberdef kind="function" id="B__STS_8c_1aea8eeb2c4dfd0112d3dc7cd46ebe147a" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref></type>
        <definition>a5err B_STS_get_axis_rz</definition>
        <argsstring>(real rz[2], B_STS_data *Bdata, real phi)</argsstring>
        <name>B_STS_get_axis_rz</name>
        <param>
          <type><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref></type>
          <declname>rz</declname>
          <array>[2]</array>
        </param>
        <param>
          <type><ref refid="structB__STS__data" kindref="compound">B_STS_data</ref> *</type>
          <declname>Bdata</declname>
        </param>
        <param>
          <type><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref></type>
          <declname>phi</declname>
        </param>
        <briefdescription>
<para>Return magnetic axis Rz-coordinates. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>rz</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer where axis R and z [m] values will be stored </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>Bdata</parametername>
</parameternamelist>
<parameterdescription>
<para>pointer to magnetic field data struct </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>phi</parametername>
</parameternamelist>
<parameterdescription>
<para>phi coordinate [deg]</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Non-zero a5err value if evaluation failed, zero otherwise </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Bfield/B_STS.c" line="531" column="7" bodyfile="Bfield/B_STS.c" bodystart="531" bodyend="541"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
<para>Stellarator magnetic field with cubic spline interpolation. </para>
    </briefdescription>
    <detaileddescription>
<para>This module represents a magnetic field where data is given in <formula id="9">$R\phi z$</formula>- grid from which it is interpolated with tricubic splines.</para>
<para>The magnetic field is evaluated from magnetic field strength <formula id="4">$\mathbf{B}$</formula> which may not be divergence free. The poloidal magnetic flux <formula id="7">$\psi$</formula> is interpolated using tricubic splines as well. <formula id="7">$\psi$</formula> and <formula id="4">$\mathbf{B}$</formula> are given in separate grids.</para>
<para>The magnetic axis location for stellarators varies with the <formula id="11">$\phi$</formula> angle and is evaluated using linear interpolation.</para>
<para>This module does no extrapolation so if queried value is outside the <formula id="3">$Rz$</formula>-grid an error is thrown. The <formula id="11">$\phi$</formula>-grid is assumed to be periodic. Periodic boundary conditions are used but it is user&apos;s responsibility to provide input whose <formula id="11">$\phi$</formula>-grid makes sense (in that it actually represents a periodic field), i.e., <formula id="24">$\phi_\mathrm{max}-\phi_\mathrm{min} = 2\pi/(N+1)$</formula>. However, do note that in this module <formula id="25">$\phi_\mathrm{max}$</formula> is not the &quot;last&quot; grid point but the second last, e.g. if <formula id="26">$\phi_\mathrm{min}=0$</formula> and <formula id="27">$n_\phi = 360$</formula>, then <formula id="28">$\phi_\mathrm{max}=359$</formula> if periodicity is <formula id="29">$N=0$</formula>.</para>
<para><simplesect kind="see"><para><ref refid="B__field_8c" kindref="compound">B_field.c</ref> <ref refid="linint1D_8c" kindref="compound">linint1D.c</ref> </para>
</simplesect>
</para>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdlib.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdio.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="math_8h" kindref="compound">math.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;string.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../math.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../ascot5.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../error.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../print.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../consts.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="B__STS_8h" kindref="compound">B_STS.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../linint/linint.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../spline/interp.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight></codeline>
<codeline lineno="98" refid="B__STS_8c_1acb08fede18445a4c412118c8d0dca978" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="B__STS_8c_1acb08fede18445a4c412118c8d0dca978" kindref="member">B_STS_init_offload</ref>(<ref refid="structB__STS__offload__data" kindref="compound">B_STS_offload_data</ref>*<sp/>offload_data,<sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref>**<sp/>offload_array)<sp/>{</highlight></codeline>
<codeline lineno="99"><highlight class="normal"></highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Spline<sp/>initialization.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>err<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>psi_size<sp/>=<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a50e04b8ab11a89e5a4f29ecaf1ea1573" kindref="member">psigrid_n_r</ref><sp/>*<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a5ffe499c0fd9b6009dfdf813166d4aa4" kindref="member">psigrid_n_z</ref></highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a22606a1229a7fc6743c9f68014969423" kindref="member">psigrid_n_phi</ref>;</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>B_size<sp/><sp/><sp/>=<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a8ff93d52cf96ba117825ecbf2702c7f9" kindref="member">Bgrid_n_r</ref><sp/><sp/><sp/>*<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a1c72a6f0d0da54683a76f034607213b0" kindref="member">Bgrid_n_z</ref></highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1abf966e39cc3a4c5717164d0398a2acd5" kindref="member">Bgrid_n_phi</ref>;</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>axis_size<sp/>=<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a7a86a77e6cf336cd0a3fb073a31757f4" kindref="member">n_axis</ref>;</highlight></codeline>
<codeline lineno="107"><highlight class="normal"></highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Allocate<sp/>enough<sp/>space<sp/>to<sp/>store<sp/>four<sp/>3D<sp/>arrays<sp/>and<sp/>axis<sp/>data<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref>*<sp/>coeff_array<sp/>=<sp/>(<ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref>*)<sp/>malloc(<sp/>(3*NSIZE_COMP3D*B_size</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/>NSIZE_COMP3D*psi_size</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/>2*axis_size)*</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref>));</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref>*<sp/>B_r<sp/><sp/><sp/><sp/>=<sp/>&amp;(coeff_array[0*B_size*NSIZE_COMP3D]);</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref>*<sp/>B_phi<sp/><sp/>=<sp/>&amp;(coeff_array[1*B_size*NSIZE_COMP3D]);</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref>*<sp/>B_z<sp/><sp/><sp/><sp/>=<sp/>&amp;(coeff_array[2*B_size*NSIZE_COMP3D]);</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref>*<sp/>psi<sp/><sp/><sp/><sp/>=<sp/>&amp;(coeff_array[3*B_size*NSIZE_COMP3D]);</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref>*<sp/>axis_r<sp/>=<sp/>&amp;(coeff_array[(3*B_size<sp/>+<sp/>psi_size)*NSIZE_COMP3D]);</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref>*<sp/>axis_z<sp/>=<sp/>&amp;(coeff_array[(3*B_size<sp/>+<sp/>psi_size)*NSIZE_COMP3D</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/>axis_size]);</highlight></codeline>
<codeline lineno="119"><highlight class="normal"></highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/>err<sp/>+=<sp/><ref refid="interp_8h_1a524cd2afea05206eedf49bb71b133be7" kindref="member">interp3Dcomp_init_coeff</ref>(</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>psi,<sp/>*offload_array<sp/>+<sp/>3*B_size,</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a50e04b8ab11a89e5a4f29ecaf1ea1573" kindref="member">psigrid_n_r</ref>,<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a22606a1229a7fc6743c9f68014969423" kindref="member">psigrid_n_phi</ref>,</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a5ffe499c0fd9b6009dfdf813166d4aa4" kindref="member">psigrid_n_z</ref>,</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interp_8h_1a65e5120fbe667470941a6bd9258b97afa66bcb6506f4bbd571f4ba3bc80114cec" kindref="member">NATURALBC</ref>,<sp/><ref refid="interp_8h_1a65e5120fbe667470941a6bd9258b97afa8b66be978239727ccd08c3060d18f72e" kindref="member">PERIODICBC</ref>,<sp/><ref refid="interp_8h_1a65e5120fbe667470941a6bd9258b97afa66bcb6506f4bbd571f4ba3bc80114cec" kindref="member">NATURALBC</ref>,</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1ab31e20167ed1d672044bbe108ea5f602" kindref="member">psigrid_r_min</ref>,<sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a3a480cf9f7d4007df7e106ea7df88d1e" kindref="member">psigrid_r_max</ref>,</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a6da4d2f926c99b4cfbb05b08722f97ed" kindref="member">psigrid_phi_min</ref>,<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1ac3c56acd276943e051f4af215cdad964" kindref="member">psigrid_phi_max</ref>,</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a8e3596f9a94ff07261a6929bb1d296b2" kindref="member">psigrid_z_min</ref>,<sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1ad46dd1514071eed06c863e19a7a631da" kindref="member">psigrid_z_max</ref>);</highlight></codeline>
<codeline lineno="128"><highlight class="normal"></highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/>err<sp/>+=<sp/><ref refid="interp_8h_1a524cd2afea05206eedf49bb71b133be7" kindref="member">interp3Dcomp_init_coeff</ref>(</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>B_r,<sp/>*offload_array<sp/>+<sp/>0*B_size,</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a8ff93d52cf96ba117825ecbf2702c7f9" kindref="member">Bgrid_n_r</ref>,<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1abf966e39cc3a4c5717164d0398a2acd5" kindref="member">Bgrid_n_phi</ref>,</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a1c72a6f0d0da54683a76f034607213b0" kindref="member">Bgrid_n_z</ref>,</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interp_8h_1a65e5120fbe667470941a6bd9258b97afa66bcb6506f4bbd571f4ba3bc80114cec" kindref="member">NATURALBC</ref>,<sp/><ref refid="interp_8h_1a65e5120fbe667470941a6bd9258b97afa8b66be978239727ccd08c3060d18f72e" kindref="member">PERIODICBC</ref>,<sp/><ref refid="interp_8h_1a65e5120fbe667470941a6bd9258b97afa66bcb6506f4bbd571f4ba3bc80114cec" kindref="member">NATURALBC</ref>,</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a773fc93d73f4a80de4c921987ea7c748" kindref="member">Bgrid_r_min</ref>,<sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a45039e3abde1bd111f38ba1ed79660eb" kindref="member">Bgrid_r_max</ref>,</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a698c44e0e05bdf9138709d529eeeb1fa" kindref="member">Bgrid_phi_min</ref>,<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a4f71d7f076713ea9e1b54bc4efcd3bd7" kindref="member">Bgrid_phi_max</ref>,</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1ae99124dd78b232b2b62a05824fc8a6d5" kindref="member">Bgrid_z_min</ref>,<sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1ac47c2705403f4ccb098e22771f7d5af2" kindref="member">Bgrid_z_max</ref>);</highlight></codeline>
<codeline lineno="137"><highlight class="normal"></highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/>err<sp/>+=<sp/><ref refid="interp_8h_1a524cd2afea05206eedf49bb71b133be7" kindref="member">interp3Dcomp_init_coeff</ref>(</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>B_phi,<sp/>*offload_array<sp/>+<sp/>1*B_size,</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a8ff93d52cf96ba117825ecbf2702c7f9" kindref="member">Bgrid_n_r</ref>,<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1abf966e39cc3a4c5717164d0398a2acd5" kindref="member">Bgrid_n_phi</ref>,</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a1c72a6f0d0da54683a76f034607213b0" kindref="member">Bgrid_n_z</ref>,</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interp_8h_1a65e5120fbe667470941a6bd9258b97afa66bcb6506f4bbd571f4ba3bc80114cec" kindref="member">NATURALBC</ref>,<sp/><ref refid="interp_8h_1a65e5120fbe667470941a6bd9258b97afa8b66be978239727ccd08c3060d18f72e" kindref="member">PERIODICBC</ref>,<sp/><ref refid="interp_8h_1a65e5120fbe667470941a6bd9258b97afa66bcb6506f4bbd571f4ba3bc80114cec" kindref="member">NATURALBC</ref>,</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a773fc93d73f4a80de4c921987ea7c748" kindref="member">Bgrid_r_min</ref>,<sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a45039e3abde1bd111f38ba1ed79660eb" kindref="member">Bgrid_r_max</ref>,</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a698c44e0e05bdf9138709d529eeeb1fa" kindref="member">Bgrid_phi_min</ref>,<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a4f71d7f076713ea9e1b54bc4efcd3bd7" kindref="member">Bgrid_phi_max</ref>,</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1ae99124dd78b232b2b62a05824fc8a6d5" kindref="member">Bgrid_z_min</ref>,<sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1ac47c2705403f4ccb098e22771f7d5af2" kindref="member">Bgrid_z_max</ref>);</highlight></codeline>
<codeline lineno="146"><highlight class="normal"></highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/>err<sp/>+=<sp/><ref refid="interp_8h_1a524cd2afea05206eedf49bb71b133be7" kindref="member">interp3Dcomp_init_coeff</ref>(</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>B_z,<sp/>*offload_array<sp/>+<sp/>2*B_size,</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a8ff93d52cf96ba117825ecbf2702c7f9" kindref="member">Bgrid_n_r</ref>,<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1abf966e39cc3a4c5717164d0398a2acd5" kindref="member">Bgrid_n_phi</ref>,</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a1c72a6f0d0da54683a76f034607213b0" kindref="member">Bgrid_n_z</ref>,</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interp_8h_1a65e5120fbe667470941a6bd9258b97afa66bcb6506f4bbd571f4ba3bc80114cec" kindref="member">NATURALBC</ref>,<sp/><ref refid="interp_8h_1a65e5120fbe667470941a6bd9258b97afa8b66be978239727ccd08c3060d18f72e" kindref="member">PERIODICBC</ref>,<sp/><ref refid="interp_8h_1a65e5120fbe667470941a6bd9258b97afa66bcb6506f4bbd571f4ba3bc80114cec" kindref="member">NATURALBC</ref>,</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a773fc93d73f4a80de4c921987ea7c748" kindref="member">Bgrid_r_min</ref>,<sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a45039e3abde1bd111f38ba1ed79660eb" kindref="member">Bgrid_r_max</ref>,</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a698c44e0e05bdf9138709d529eeeb1fa" kindref="member">Bgrid_phi_min</ref>,<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a4f71d7f076713ea9e1b54bc4efcd3bd7" kindref="member">Bgrid_phi_max</ref>,</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1ae99124dd78b232b2b62a05824fc8a6d5" kindref="member">Bgrid_z_min</ref>,<sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1ac47c2705403f4ccb098e22771f7d5af2" kindref="member">Bgrid_z_max</ref>);</highlight></codeline>
<codeline lineno="155"><highlight class="normal"></highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(err)<sp/>{</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="print_8h_1ae9242d843e65413a3e5dba7129c75101" kindref="member">print_err</ref>(</highlight><highlight class="stringliteral">&quot;Error:<sp/>Failed<sp/>to<sp/>initialize<sp/>splines.\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>err;</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="160"><highlight class="normal"></highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>axis_size;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>axis_r[i]<sp/>=<sp/>(*offload_array)[3*B_size<sp/>+<sp/>psi_size<sp/>+<sp/>i];</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>axis_z[i]<sp/>=<sp/>(*offload_array)[3*B_size<sp/>+<sp/>psi_size<sp/>+<sp/>axis_size<sp/>+<sp/>i];</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="165"><highlight class="normal"></highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Re-allocate<sp/>the<sp/>offload<sp/>array<sp/>and<sp/>store<sp/>spline<sp/>coefficients<sp/>there<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/>free(*offload_array);</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/>*offload_array<sp/>=<sp/>coeff_array;</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a4a5bc280010988ef4ca24a57a44c46f2" kindref="member">offload_array_length</ref><sp/>=<sp/>3*NSIZE_COMP3D*B_size</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/>NSIZE_COMP3D*psi_size</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/>2*axis_size;</highlight></codeline>
<codeline lineno="172"><highlight class="normal"></highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Evaluate<sp/>psi<sp/>and<sp/>magnetic<sp/>field<sp/>on<sp/>axis<sp/>for<sp/>checks<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structB__STS__data" kindref="compound">B_STS_data</ref><sp/>Bdata;</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="B__STS_8c_1a931ef0d099dc26a73c7658aa0978c098" kindref="member">B_STS_init</ref>(&amp;Bdata,<sp/>offload_data,<sp/>*offload_array);</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>psival[1],<sp/>Bval[3],<sp/>axis[2];</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/>err<sp/>+=<sp/><ref refid="B__STS_8c_1aea8eeb2c4dfd0112d3dc7cd46ebe147a" kindref="member">B_STS_get_axis_rz</ref>(axis,<sp/>&amp;Bdata,<sp/>0);</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/>err<sp/>+=<sp/><ref refid="B__STS_8c_1ad5644b9978d382c606bc01bdbe9fbd7b" kindref="member">B_STS_eval_psi</ref>(psival,<sp/>axis[0],<sp/>0,<sp/>axis[1],</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;Bdata);</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/>err<sp/>+=<sp/><ref refid="B__STS_8c_1af6e97ba3be86103ac1233235ee1a9ab6" kindref="member">B_STS_eval_B</ref>(Bval,<sp/>axis[0],<sp/>0,<sp/>axis[1],</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;Bdata);</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(err)<sp/>{</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="print_8h_1ae9242d843e65413a3e5dba7129c75101" kindref="member">print_err</ref>(</highlight><highlight class="stringliteral">&quot;Error:<sp/>Initialization<sp/>failed.\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>err;</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="186"><highlight class="normal"></highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/>printf(</highlight><highlight class="stringliteral">&quot;\nStellarator<sp/>magnetic<sp/>field<sp/>(B_STS)\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="print_8h_1a8520c71eb5db223009e5079e420bc398" kindref="member">print_out</ref>(VERBOSE_IO,<sp/></highlight><highlight class="stringliteral">&quot;Psi-grid:<sp/>nR<sp/>=<sp/>%4.d<sp/>Rmin<sp/>=<sp/>%3.3f<sp/>m<sp/>Rmax<sp/>=<sp/>%3.3f<sp/>m\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a50e04b8ab11a89e5a4f29ecaf1ea1573" kindref="member">psigrid_n_r</ref>,</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1ab31e20167ed1d672044bbe108ea5f602" kindref="member">psigrid_r_min</ref>,<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a3a480cf9f7d4007df7e106ea7df88d1e" kindref="member">psigrid_r_max</ref>);</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="print_8h_1a8520c71eb5db223009e5079e420bc398" kindref="member">print_out</ref>(VERBOSE_IO,<sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/><sp/><sp/><sp/><sp/>nz<sp/>=<sp/>%4.d<sp/>zmin<sp/>=<sp/>%3.3f<sp/>m<sp/>zmax<sp/>=<sp/>%3.3f<sp/>m\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a5ffe499c0fd9b6009dfdf813166d4aa4" kindref="member">psigrid_n_z</ref>,</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a8e3596f9a94ff07261a6929bb1d296b2" kindref="member">psigrid_z_min</ref>,<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1ad46dd1514071eed06c863e19a7a631da" kindref="member">psigrid_z_max</ref>);</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="print_8h_1a8520c71eb5db223009e5079e420bc398" kindref="member">print_out</ref>(VERBOSE_IO,<sp/></highlight><highlight class="stringliteral">&quot;nphi<sp/>=<sp/>%4.d<sp/>phimin<sp/>=<sp/>%3.3f<sp/>deg<sp/>phimax<sp/>=<sp/>%3.3f<sp/>deg\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a22606a1229a7fc6743c9f68014969423" kindref="member">psigrid_n_phi</ref>,</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="math_8h_1a99307d8c1ae67cdea38938ac1fb5095d" kindref="member">math_rad2deg</ref>(offload_data-&gt;<ref refid="structB__STS__offload__data_1a6da4d2f926c99b4cfbb05b08722f97ed" kindref="member">psigrid_phi_min</ref>),</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="math_8h_1a99307d8c1ae67cdea38938ac1fb5095d" kindref="member">math_rad2deg</ref>(offload_data-&gt;<ref refid="structB__STS__offload__data_1ac3c56acd276943e051f4af215cdad964" kindref="member">psigrid_phi_max</ref>));</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="print_8h_1a8520c71eb5db223009e5079e420bc398" kindref="member">print_out</ref>(VERBOSE_IO,<sp/></highlight><highlight class="stringliteral">&quot;B-grid:<sp/>nR<sp/>=<sp/>%4.d<sp/>Rmin<sp/>=<sp/>%3.3f<sp/>m<sp/>Rmax<sp/>=<sp/>%3.3f<sp/>m\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a8ff93d52cf96ba117825ecbf2702c7f9" kindref="member">Bgrid_n_r</ref>,</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a773fc93d73f4a80de4c921987ea7c748" kindref="member">Bgrid_r_min</ref>,<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a45039e3abde1bd111f38ba1ed79660eb" kindref="member">Bgrid_r_max</ref>);</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="print_8h_1a8520c71eb5db223009e5079e420bc398" kindref="member">print_out</ref>(VERBOSE_IO,<sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/><sp/><sp/><sp/><sp/>nz<sp/>=<sp/>%4.d<sp/>zmin<sp/>=<sp/>%3.3f<sp/>m<sp/>zmax<sp/>=<sp/>%3.3f<sp/>m\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a1c72a6f0d0da54683a76f034607213b0" kindref="member">Bgrid_n_z</ref>,</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1ae99124dd78b232b2b62a05824fc8a6d5" kindref="member">Bgrid_z_min</ref>,<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1ac47c2705403f4ccb098e22771f7d5af2" kindref="member">Bgrid_z_max</ref>);</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="print_8h_1a8520c71eb5db223009e5079e420bc398" kindref="member">print_out</ref>(VERBOSE_IO,<sp/></highlight><highlight class="stringliteral">&quot;nphi<sp/>=<sp/>%4.d<sp/>phimin<sp/>=<sp/>%3.3f<sp/>deg<sp/>phimax<sp/>=<sp/>%3.3f<sp/>deg\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1abf966e39cc3a4c5717164d0398a2acd5" kindref="member">Bgrid_n_phi</ref>,</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="math_8h_1a99307d8c1ae67cdea38938ac1fb5095d" kindref="member">math_rad2deg</ref>(offload_data-&gt;<ref refid="structB__STS__offload__data_1a698c44e0e05bdf9138709d529eeeb1fa" kindref="member">Bgrid_phi_min</ref>),</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="math_8h_1a99307d8c1ae67cdea38938ac1fb5095d" kindref="member">math_rad2deg</ref>(offload_data-&gt;<ref refid="structB__STS__offload__data_1a4f71d7f076713ea9e1b54bc4efcd3bd7" kindref="member">Bgrid_phi_max</ref>));</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="print_8h_1a8520c71eb5db223009e5079e420bc398" kindref="member">print_out</ref>(VERBOSE_IO,<sp/></highlight><highlight class="stringliteral">&quot;Psi<sp/>at<sp/>magnetic<sp/>axis<sp/>(phi=0)<sp/>(%1.3f<sp/>m,<sp/>%1.3f<sp/>m)\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>axis[0],<sp/>axis[1]);</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="print_8h_1a8520c71eb5db223009e5079e420bc398" kindref="member">print_out</ref>(VERBOSE_IO,<sp/></highlight><highlight class="stringliteral">&quot;%3.3f<sp/>(evaluated)\n%3.3f<sp/>(given)\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>psival[0],<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a2dd7a225b953960a33d7855daf408f02" kindref="member">psi0</ref>);</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="print_8h_1a8520c71eb5db223009e5079e420bc398" kindref="member">print_out</ref>(VERBOSE_IO,<sp/></highlight><highlight class="stringliteral">&quot;Magnetic<sp/>field<sp/>on<sp/>axis:\n&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;B_R<sp/>=<sp/>%3.3f<sp/>B_phi<sp/>=<sp/>%3.3f<sp/>B_z<sp/>=<sp/>%3.3f\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Bval[0],<sp/>Bval[1],<sp/>Bval[2]);</highlight></codeline>
<codeline lineno="215"><highlight class="normal"></highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="217"><highlight class="normal">}</highlight></codeline>
<codeline lineno="218"><highlight class="normal"></highlight></codeline>
<codeline lineno="225" refid="B__STS_8c_1a6f091681bce5d60c97023e6b289aec68" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="B__STS_8c_1a6f091681bce5d60c97023e6b289aec68" kindref="member">B_STS_free_offload</ref>(<ref refid="structB__STS__offload__data" kindref="compound">B_STS_offload_data</ref>*<sp/>offload_data,<sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref>**<sp/>offload_array)<sp/>{</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/>free(*offload_array);</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/>*offload_array<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="228"><highlight class="normal">}</highlight></codeline>
<codeline lineno="229"><highlight class="normal"></highlight></codeline>
<codeline lineno="237" refid="B__STS_8c_1a931ef0d099dc26a73c7658aa0978c098" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="B__STS_8c_1a931ef0d099dc26a73c7658aa0978c098" kindref="member">B_STS_init</ref>(<ref refid="structB__STS__data" kindref="compound">B_STS_data</ref>*<sp/>Bdata,<sp/><ref refid="structB__STS__offload__data" kindref="compound">B_STS_offload_data</ref>*<sp/>offload_data,</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref>*<sp/>offload_array)<sp/>{</highlight></codeline>
<codeline lineno="239"><highlight class="normal"></highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>B_size<sp/>=<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a8ff93d52cf96ba117825ecbf2702c7f9" kindref="member">Bgrid_n_r</ref><sp/>*<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a1c72a6f0d0da54683a76f034607213b0" kindref="member">Bgrid_n_z</ref></highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1abf966e39cc3a4c5717164d0398a2acd5" kindref="member">Bgrid_n_phi</ref>*NSIZE_COMP3D;</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>psi_size<sp/>=<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a50e04b8ab11a89e5a4f29ecaf1ea1573" kindref="member">psigrid_n_r</ref><sp/>*<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a5ffe499c0fd9b6009dfdf813166d4aa4" kindref="member">psigrid_n_z</ref></highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a22606a1229a7fc6743c9f68014969423" kindref="member">psigrid_n_phi</ref>*NSIZE_COMP3D;</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>axis_size<sp/>=<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a7a86a77e6cf336cd0a3fb073a31757f4" kindref="member">n_axis</ref>;</highlight></codeline>
<codeline lineno="245"><highlight class="normal"></highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Initialize<sp/>target<sp/>data<sp/>struct<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/>Bdata-&gt;<ref refid="structB__STS__data_1a8ee302ab260da9e9922bd1a33d1b6616" kindref="member">psi0</ref><sp/>=<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a2dd7a225b953960a33d7855daf408f02" kindref="member">psi0</ref>;</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/>Bdata-&gt;<ref refid="structB__STS__data_1a6c73d86dbc04d55ce91ebf880d50701b" kindref="member">psi1</ref><sp/>=<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a0810bad345e1bf552973c8e16419ae4a" kindref="member">psi1</ref>;</highlight></codeline>
<codeline lineno="249"><highlight class="normal"></highlight></codeline>
<codeline lineno="250"><highlight class="normal"></highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Initialize<sp/>spline<sp/>structs<sp/>from<sp/>the<sp/>coefficients<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="interp_8h_1aad492b8a8a25b6379f57697bafd03d63" kindref="member">interp3Dcomp_init_spline</ref>(&amp;Bdata-&gt;<ref refid="structB__STS__data_1aed5c48bea605ff24d34ab543e2c5001c" kindref="member">B_r</ref>,<sp/>&amp;(offload_array[0*B_size]),</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a8ff93d52cf96ba117825ecbf2702c7f9" kindref="member">Bgrid_n_r</ref>,</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1abf966e39cc3a4c5717164d0398a2acd5" kindref="member">Bgrid_n_phi</ref>,</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a1c72a6f0d0da54683a76f034607213b0" kindref="member">Bgrid_n_z</ref>,</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interp_8h_1a65e5120fbe667470941a6bd9258b97afa66bcb6506f4bbd571f4ba3bc80114cec" kindref="member">NATURALBC</ref>,<sp/><ref refid="interp_8h_1a65e5120fbe667470941a6bd9258b97afa8b66be978239727ccd08c3060d18f72e" kindref="member">PERIODICBC</ref>,<sp/><ref refid="interp_8h_1a65e5120fbe667470941a6bd9258b97afa66bcb6506f4bbd571f4ba3bc80114cec" kindref="member">NATURALBC</ref>,</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a773fc93d73f4a80de4c921987ea7c748" kindref="member">Bgrid_r_min</ref>,</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a45039e3abde1bd111f38ba1ed79660eb" kindref="member">Bgrid_r_max</ref>,</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a698c44e0e05bdf9138709d529eeeb1fa" kindref="member">Bgrid_phi_min</ref>,</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a4f71d7f076713ea9e1b54bc4efcd3bd7" kindref="member">Bgrid_phi_max</ref>,</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1ae99124dd78b232b2b62a05824fc8a6d5" kindref="member">Bgrid_z_min</ref>,</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1ac47c2705403f4ccb098e22771f7d5af2" kindref="member">Bgrid_z_max</ref>);</highlight></codeline>
<codeline lineno="263"><highlight class="normal"></highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="interp_8h_1aad492b8a8a25b6379f57697bafd03d63" kindref="member">interp3Dcomp_init_spline</ref>(&amp;Bdata-&gt;<ref refid="structB__STS__data_1aae284fbd94b891d8f69d9b2f470d70e7" kindref="member">B_phi</ref>,<sp/>&amp;(offload_array[1*B_size]),</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a8ff93d52cf96ba117825ecbf2702c7f9" kindref="member">Bgrid_n_r</ref>,</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1abf966e39cc3a4c5717164d0398a2acd5" kindref="member">Bgrid_n_phi</ref>,</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a1c72a6f0d0da54683a76f034607213b0" kindref="member">Bgrid_n_z</ref>,</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interp_8h_1a65e5120fbe667470941a6bd9258b97afa66bcb6506f4bbd571f4ba3bc80114cec" kindref="member">NATURALBC</ref>,<sp/><ref refid="interp_8h_1a65e5120fbe667470941a6bd9258b97afa8b66be978239727ccd08c3060d18f72e" kindref="member">PERIODICBC</ref>,<sp/><ref refid="interp_8h_1a65e5120fbe667470941a6bd9258b97afa66bcb6506f4bbd571f4ba3bc80114cec" kindref="member">NATURALBC</ref>,</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a773fc93d73f4a80de4c921987ea7c748" kindref="member">Bgrid_r_min</ref>,</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a45039e3abde1bd111f38ba1ed79660eb" kindref="member">Bgrid_r_max</ref>,</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a698c44e0e05bdf9138709d529eeeb1fa" kindref="member">Bgrid_phi_min</ref>,</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a4f71d7f076713ea9e1b54bc4efcd3bd7" kindref="member">Bgrid_phi_max</ref>,</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1ae99124dd78b232b2b62a05824fc8a6d5" kindref="member">Bgrid_z_min</ref>,</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1ac47c2705403f4ccb098e22771f7d5af2" kindref="member">Bgrid_z_max</ref>);</highlight></codeline>
<codeline lineno="275"><highlight class="normal"></highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="interp_8h_1aad492b8a8a25b6379f57697bafd03d63" kindref="member">interp3Dcomp_init_spline</ref>(&amp;Bdata-&gt;<ref refid="structB__STS__data_1a9e0c10d26231dc51adaf4beefb60dd02" kindref="member">B_z</ref>,<sp/>&amp;(offload_array[2*B_size]),</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a8ff93d52cf96ba117825ecbf2702c7f9" kindref="member">Bgrid_n_r</ref>,</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1abf966e39cc3a4c5717164d0398a2acd5" kindref="member">Bgrid_n_phi</ref>,</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a1c72a6f0d0da54683a76f034607213b0" kindref="member">Bgrid_n_z</ref>,</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interp_8h_1a65e5120fbe667470941a6bd9258b97afa66bcb6506f4bbd571f4ba3bc80114cec" kindref="member">NATURALBC</ref>,<sp/><ref refid="interp_8h_1a65e5120fbe667470941a6bd9258b97afa8b66be978239727ccd08c3060d18f72e" kindref="member">PERIODICBC</ref>,<sp/><ref refid="interp_8h_1a65e5120fbe667470941a6bd9258b97afa66bcb6506f4bbd571f4ba3bc80114cec" kindref="member">NATURALBC</ref>,</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a773fc93d73f4a80de4c921987ea7c748" kindref="member">Bgrid_r_min</ref>,</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a45039e3abde1bd111f38ba1ed79660eb" kindref="member">Bgrid_r_max</ref>,</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a698c44e0e05bdf9138709d529eeeb1fa" kindref="member">Bgrid_phi_min</ref>,</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a4f71d7f076713ea9e1b54bc4efcd3bd7" kindref="member">Bgrid_phi_max</ref>,</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1ae99124dd78b232b2b62a05824fc8a6d5" kindref="member">Bgrid_z_min</ref>,</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1ac47c2705403f4ccb098e22771f7d5af2" kindref="member">Bgrid_z_max</ref>);</highlight></codeline>
<codeline lineno="287"><highlight class="normal"></highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="interp_8h_1aad492b8a8a25b6379f57697bafd03d63" kindref="member">interp3Dcomp_init_spline</ref>(&amp;Bdata-&gt;<ref refid="structB__STS__data_1a5cfb55ae269a7a4c97d149267cdf86e2" kindref="member">psi</ref>,<sp/>&amp;(offload_array[3*B_size]),</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a50e04b8ab11a89e5a4f29ecaf1ea1573" kindref="member">psigrid_n_r</ref>,</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a22606a1229a7fc6743c9f68014969423" kindref="member">psigrid_n_phi</ref>,</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a5ffe499c0fd9b6009dfdf813166d4aa4" kindref="member">psigrid_n_z</ref>,</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interp_8h_1a65e5120fbe667470941a6bd9258b97afa66bcb6506f4bbd571f4ba3bc80114cec" kindref="member">NATURALBC</ref>,<sp/><ref refid="interp_8h_1a65e5120fbe667470941a6bd9258b97afa8b66be978239727ccd08c3060d18f72e" kindref="member">PERIODICBC</ref>,<sp/><ref refid="interp_8h_1a65e5120fbe667470941a6bd9258b97afa66bcb6506f4bbd571f4ba3bc80114cec" kindref="member">NATURALBC</ref>,</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1ab31e20167ed1d672044bbe108ea5f602" kindref="member">psigrid_r_min</ref>,</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a3a480cf9f7d4007df7e106ea7df88d1e" kindref="member">psigrid_r_max</ref>,</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a6da4d2f926c99b4cfbb05b08722f97ed" kindref="member">psigrid_phi_min</ref>,</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1ac3c56acd276943e051f4af215cdad964" kindref="member">psigrid_phi_max</ref>,</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a8e3596f9a94ff07261a6929bb1d296b2" kindref="member">psigrid_z_min</ref>,</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1ad46dd1514071eed06c863e19a7a631da" kindref="member">psigrid_z_max</ref>);</highlight></codeline>
<codeline lineno="299"><highlight class="normal"></highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="linint_8h_1ab4fb21fa2a3c876b362eaf04cd958adb" kindref="member">linint1D_init</ref>(&amp;Bdata-&gt;<ref refid="structB__STS__data_1aff12e35d6e34d0ffffc6c6babfe286fc" kindref="member">axis_r</ref>,</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;(offload_array[3*B_size<sp/>+<sp/>psi_size]),</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a7a86a77e6cf336cd0a3fb073a31757f4" kindref="member">n_axis</ref>,<sp/><ref refid="interp_8h_1a65e5120fbe667470941a6bd9258b97afa8b66be978239727ccd08c3060d18f72e" kindref="member">PERIODICBC</ref>,</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1aefb9cd0a4aeea861c5d998095738fe88" kindref="member">axis_min</ref>,<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a9fe8a3ee79e5c310ae79f639c1abb0bd" kindref="member">axis_max</ref>);</highlight></codeline>
<codeline lineno="304"><highlight class="normal"></highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="linint_8h_1ab4fb21fa2a3c876b362eaf04cd958adb" kindref="member">linint1D_init</ref>(&amp;Bdata-&gt;<ref refid="structB__STS__data_1aba669d33028e92977257bd24f615c837" kindref="member">axis_z</ref>,</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;(offload_array[3*B_size<sp/>+<sp/>psi_size<sp/>+<sp/>axis_size]),</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a7a86a77e6cf336cd0a3fb073a31757f4" kindref="member">n_axis</ref>,<sp/><ref refid="interp_8h_1a65e5120fbe667470941a6bd9258b97afa8b66be978239727ccd08c3060d18f72e" kindref="member">PERIODICBC</ref>,</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1aefb9cd0a4aeea861c5d998095738fe88" kindref="member">axis_min</ref>,<sp/>offload_data-&gt;<ref refid="structB__STS__offload__data_1a9fe8a3ee79e5c310ae79f639c1abb0bd" kindref="member">axis_max</ref>);</highlight></codeline>
<codeline lineno="309"><highlight class="normal">}</highlight></codeline>
<codeline lineno="310"><highlight class="normal"></highlight></codeline>
<codeline lineno="322" refid="B__STS_8c_1ad5644b9978d382c606bc01bdbe9fbd7b" refkind="member"><highlight class="normal"><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/><ref refid="B__STS_8c_1ad5644b9978d382c606bc01bdbe9fbd7b" kindref="member">B_STS_eval_psi</ref>(<ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref>*<sp/>psi,<sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>r,<sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>phi,<sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>z,</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structB__STS__data" kindref="compound">B_STS_data</ref>*<sp/>Bdata)<sp/>{</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/>err<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>interperr<sp/>=<sp/>0;<sp/></highlight><highlight class="comment">/*<sp/>If<sp/>error<sp/>happened<sp/>during<sp/>interpolation<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="326"><highlight class="normal"></highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/>interperr<sp/>+=<sp/><ref refid="interp_8h_1adbe3b828f6eb001f64d9c194f1c16e0a" kindref="member">interp3Dcomp_eval_f</ref>(&amp;psi[0],<sp/>&amp;Bdata-&gt;<ref refid="structB__STS__data_1a5cfb55ae269a7a4c97d149267cdf86e2" kindref="member">psi</ref>,<sp/>r,<sp/>phi,<sp/>z);</highlight></codeline>
<codeline lineno="328"><highlight class="normal"></highlight></codeline>
<codeline lineno="329"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>B_STS_CLAMP_RHO_NONNEGATIVE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>psi[0]<sp/>&lt;<sp/>Bdata-&gt;<ref refid="structB__STS__data_1a8ee302ab260da9e9922bd1a33d1b6616" kindref="member">psi0</ref><sp/>){</highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>psi[0]<sp/>=<sp/>Bdata-&gt;<ref refid="structB__STS__data_1a8ee302ab260da9e9922bd1a33d1b6616" kindref="member">psi0</ref>;</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="333"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="334"><highlight class="normal"></highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Test<sp/>for<sp/>psi<sp/>interpolation<sp/>error<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(interperr)<sp/>{</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<sp/><ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92aaa34d7aa427b982efa61030ebc069963" kindref="member">ERR_INPUT_EVALUATION</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddac3c845cd75d76ee2b1bf40ad481f7bd0" kindref="member">EF_B_STS</ref><sp/>);</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="339"><highlight class="normal"></highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>err;</highlight></codeline>
<codeline lineno="341"><highlight class="normal">}</highlight></codeline>
<codeline lineno="342"><highlight class="normal"></highlight></codeline>
<codeline lineno="354" refid="B__STS_8c_1ae1cafb9166148608daf09e6bf4ae8db2" refkind="member"><highlight class="normal"><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/><ref refid="B__STS_8c_1ae1cafb9166148608daf09e6bf4ae8db2" kindref="member">B_STS_eval_psi_dpsi</ref>(<ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>psi_dpsi[4],<sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>r,<sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>phi,<sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>z,</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structB__STS__data" kindref="compound">B_STS_data</ref>*<sp/>Bdata)<sp/>{</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/>err<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>interperr<sp/>=<sp/>0;<sp/></highlight><highlight class="comment">/*<sp/>If<sp/>error<sp/>happened<sp/>during<sp/>interpolation<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>psi_dpsi_temp[10];</highlight></codeline>
<codeline lineno="359"><highlight class="normal"></highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/>interperr<sp/>+=<sp/><ref refid="interp_8h_1a8f29e42e2efa8821847486f87a6f957b" kindref="member">interp3Dcomp_eval_df</ref>(psi_dpsi_temp,<sp/>&amp;Bdata-&gt;<ref refid="structB__STS__data_1a5cfb55ae269a7a4c97d149267cdf86e2" kindref="member">psi</ref>,<sp/>r,<sp/>phi,<sp/>z);</highlight></codeline>
<codeline lineno="361"><highlight class="normal"></highlight></codeline>
<codeline lineno="362"><highlight class="normal"></highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/>psi_dpsi[0]<sp/>=<sp/>psi_dpsi_temp[0];</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/>psi_dpsi[1]<sp/>=<sp/>psi_dpsi_temp[1];</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/>psi_dpsi[2]<sp/>=<sp/>psi_dpsi_temp[2];</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/>psi_dpsi[3]<sp/>=<sp/>psi_dpsi_temp[3];</highlight></codeline>
<codeline lineno="367"><highlight class="normal"></highlight></codeline>
<codeline lineno="368"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>B_STS_CLAMP_RHO_NONNEGATIVE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>psi_dpsi_temp[0]<sp/>&lt;<sp/>Bdata-&gt;<ref refid="structB__STS__data_1a8ee302ab260da9e9922bd1a33d1b6616" kindref="member">psi0</ref><sp/>){</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>psi_dpsi[0]<sp/>=<sp/>Bdata-&gt;<ref refid="structB__STS__data_1a8ee302ab260da9e9922bd1a33d1b6616" kindref="member">psi0</ref>;</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>psi_dpsi[1]<sp/>=<sp/>0.0;</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>psi_dpsi[2]<sp/>=<sp/>0.0;</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>psi_dpsi[3]<sp/>=<sp/>0.0;</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="375"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="376"><highlight class="normal"></highlight></codeline>
<codeline lineno="377"><highlight class="normal"></highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(interperr)<sp/>{</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<sp/><ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92aaa34d7aa427b982efa61030ebc069963" kindref="member">ERR_INPUT_EVALUATION</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddac3c845cd75d76ee2b1bf40ad481f7bd0" kindref="member">EF_B_STS</ref><sp/>);</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="381"><highlight class="normal"></highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>err;</highlight></codeline>
<codeline lineno="383"><highlight class="normal">}</highlight></codeline>
<codeline lineno="384"><highlight class="normal"></highlight></codeline>
<codeline lineno="396" refid="B__STS_8c_1a58b56b89cf87058455f51443068187b1" refkind="member"><highlight class="normal"><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/><ref refid="B__STS_8c_1a58b56b89cf87058455f51443068187b1" kindref="member">B_STS_eval_rho_drho</ref>(<ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>rho_drho[4],<sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>r,<sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>phi,<sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>z,</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structB__STS__data" kindref="compound">B_STS_data</ref>*<sp/>Bdata)<sp/>{</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/>err<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>psi_dpsi[4];</highlight></codeline>
<codeline lineno="400"><highlight class="normal"></highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="B__STS_8c_1ae1cafb9166148608daf09e6bf4ae8db2" kindref="member">B_STS_eval_psi_dpsi</ref>(psi_dpsi,<sp/>r,<sp/>phi,<sp/>z,<sp/>Bdata);</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(err){</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<sp/><ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92afd37c4badd68d8e161fa0676fd11eb4c" kindref="member">ERR_INPUT_UNPHYSICAL</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddac3c845cd75d76ee2b1bf40ad481f7bd0" kindref="member">EF_B_STS</ref><sp/>);</highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="405"><highlight class="normal"></highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Check<sp/>that<sp/>the<sp/>values<sp/>seem<sp/>valid<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>delta<sp/>=<sp/>Bdata-&gt;<ref refid="structB__STS__data_1a6c73d86dbc04d55ce91ebf880d50701b" kindref="member">psi1</ref><sp/>-<sp/>Bdata-&gt;<ref refid="structB__STS__data_1a8ee302ab260da9e9922bd1a33d1b6616" kindref="member">psi0</ref>;</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>(psi_dpsi[0]<sp/>-<sp/>Bdata-&gt;<ref refid="structB__STS__data_1a8ee302ab260da9e9922bd1a33d1b6616" kindref="member">psi0</ref>)<sp/>/<sp/>delta<sp/>&lt;=<sp/>0<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="409"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>B_STS_CLAMP_RHO_NONNEGATIVE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Set<sp/>rho<sp/>and<sp/>the<sp/>partial<sp/>derivatives<sp/>to<sp/>zero,<sp/>because<sp/>otherwise<sp/>one</highlight></codeline>
<codeline lineno="411"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>would<sp/>need<sp/>to<sp/>divide<sp/>by<sp/>rho,<sp/>which<sp/>is<sp/>zero.<sp/>Of<sp/>course,<sp/>this<sp/>problem</highlight></codeline>
<codeline lineno="412"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>persists<sp/>when<sp/>B_STS_CLAMP_RHO_NONNEGATIVE<sp/>is<sp/>not<sp/>defined<sp/>and</highlight></codeline>
<codeline lineno="413"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>the<sp/>evaluation<sp/>happens<sp/>exactly<sp/>at<sp/>rho=0.0<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rho_drho[0]<sp/>=<sp/>0.0;</highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rho_drho[1]<sp/>=<sp/>0.0;</highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rho_drho[2]<sp/>=<sp/>0.0;</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rho_drho[3]<sp/>=<sp/>0.0;</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>err;</highlight></codeline>
<codeline lineno="419"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<sp/><ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92afd37c4badd68d8e161fa0676fd11eb4c" kindref="member">ERR_INPUT_UNPHYSICAL</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddac3c845cd75d76ee2b1bf40ad481f7bd0" kindref="member">EF_B_STS</ref><sp/>);</highlight></codeline>
<codeline lineno="421"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="423"><highlight class="normal"></highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Normalize<sp/>psi<sp/>to<sp/>get<sp/>rho<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/>rho_drho[0]<sp/>=<sp/>sqrt(<sp/>(psi_dpsi[0]<sp/>-<sp/>Bdata-&gt;<ref refid="structB__STS__data_1a8ee302ab260da9e9922bd1a33d1b6616" kindref="member">psi0</ref>)<sp/>/<sp/>delta<sp/>);</highlight></codeline>
<codeline lineno="426"><highlight class="normal"></highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/>rho_drho[1]<sp/>=<sp/>psi_dpsi[1]<sp/>/<sp/>(2*delta*rho_drho[0]);</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/>rho_drho[2]<sp/>=<sp/>psi_dpsi[2]<sp/>/<sp/>(2*delta*rho_drho[0]);</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/>rho_drho[3]<sp/>=<sp/>psi_dpsi[3]<sp/>/<sp/>(2*delta*rho_drho[0]);</highlight></codeline>
<codeline lineno="430"><highlight class="normal"></highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>err;</highlight></codeline>
<codeline lineno="432"><highlight class="normal">}</highlight></codeline>
<codeline lineno="433"><highlight class="normal"></highlight></codeline>
<codeline lineno="445" refid="B__STS_8c_1af6e97ba3be86103ac1233235ee1a9ab6" refkind="member"><highlight class="normal"><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/><ref refid="B__STS_8c_1af6e97ba3be86103ac1233235ee1a9ab6" kindref="member">B_STS_eval_B</ref>(<ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>B[3],<sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>r,<sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>phi,<sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>z,<sp/><ref refid="structB__STS__data" kindref="compound">B_STS_data</ref>*<sp/>Bdata)<sp/>{</highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/>err<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>interperr<sp/>=<sp/>0;<sp/></highlight><highlight class="comment">/*<sp/>If<sp/>error<sp/>happened<sp/>during<sp/>interpolation<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="448"><highlight class="normal"></highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/>interperr<sp/>+=<sp/><ref refid="interp_8h_1adbe3b828f6eb001f64d9c194f1c16e0a" kindref="member">interp3Dcomp_eval_f</ref>(&amp;B[0],<sp/>&amp;Bdata-&gt;<ref refid="structB__STS__data_1aed5c48bea605ff24d34ab543e2c5001c" kindref="member">B_r</ref>,<sp/>r,<sp/>phi,<sp/>z);</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/>interperr<sp/>+=<sp/><ref refid="interp_8h_1adbe3b828f6eb001f64d9c194f1c16e0a" kindref="member">interp3Dcomp_eval_f</ref>(&amp;B[1],<sp/>&amp;Bdata-&gt;<ref refid="structB__STS__data_1aae284fbd94b891d8f69d9b2f470d70e7" kindref="member">B_phi</ref>,<sp/>r,<sp/>phi,<sp/>z);</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/>interperr<sp/>+=<sp/><ref refid="interp_8h_1adbe3b828f6eb001f64d9c194f1c16e0a" kindref="member">interp3Dcomp_eval_f</ref>(&amp;B[2],<sp/>&amp;Bdata-&gt;<ref refid="structB__STS__data_1a9e0c10d26231dc51adaf4beefb60dd02" kindref="member">B_z</ref>,<sp/>r,<sp/>phi,<sp/>z);</highlight></codeline>
<codeline lineno="452"><highlight class="normal"></highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Test<sp/>for<sp/>B<sp/>field<sp/>interpolation<sp/>error<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(interperr)<sp/>{</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<sp/><ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92aaa34d7aa427b982efa61030ebc069963" kindref="member">ERR_INPUT_EVALUATION</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddac3c845cd75d76ee2b1bf40ad481f7bd0" kindref="member">EF_B_STS</ref><sp/>);</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="457"><highlight class="normal"></highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Check<sp/>that<sp/>magnetic<sp/>field<sp/>seems<sp/>valid<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>check<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/>check<sp/>+=<sp/>((B[0]*B[0]<sp/>+<sp/>B[1]*B[1]<sp/>+<sp/>B[2]*B[2])<sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err<sp/>&amp;&amp;<sp/>check)<sp/>{</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<sp/><ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92afd37c4badd68d8e161fa0676fd11eb4c" kindref="member">ERR_INPUT_UNPHYSICAL</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddac3c845cd75d76ee2b1bf40ad481f7bd0" kindref="member">EF_B_STS</ref><sp/>);</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="464"><highlight class="normal"></highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>err;</highlight></codeline>
<codeline lineno="466"><highlight class="normal"></highlight></codeline>
<codeline lineno="467"><highlight class="normal">}</highlight></codeline>
<codeline lineno="468"><highlight class="normal"></highlight></codeline>
<codeline lineno="480" refid="B__STS_8c_1a93ec19559be9866c0d0b001e2818cc4e" refkind="member"><highlight class="normal"><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/><ref refid="B__STS_8c_1a93ec19559be9866c0d0b001e2818cc4e" kindref="member">B_STS_eval_B_dB</ref>(<ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>B_dB[12],<sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>r,<sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>phi,<sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>z,</highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structB__STS__data" kindref="compound">B_STS_data</ref>*<sp/>Bdata)<sp/>{</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/>err<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>interperr<sp/>=<sp/>0;<sp/></highlight><highlight class="comment">/*<sp/>If<sp/>error<sp/>happened<sp/>during<sp/>interpolation<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>B_dB_temp[10];</highlight></codeline>
<codeline lineno="485"><highlight class="normal"></highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/>interperr<sp/>+=<sp/><ref refid="interp_8h_1a8f29e42e2efa8821847486f87a6f957b" kindref="member">interp3Dcomp_eval_df</ref>(B_dB_temp,<sp/>&amp;Bdata-&gt;<ref refid="structB__STS__data_1aed5c48bea605ff24d34ab543e2c5001c" kindref="member">B_r</ref>,<sp/>r,<sp/>phi,<sp/>z);</highlight></codeline>
<codeline lineno="487"><highlight class="normal"></highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[0]<sp/>=<sp/>B_dB_temp[0];</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[1]<sp/>=<sp/>B_dB_temp[1];</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[2]<sp/>=<sp/>B_dB_temp[2];</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[3]<sp/>=<sp/>B_dB_temp[3];</highlight></codeline>
<codeline lineno="492"><highlight class="normal"></highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/>interperr<sp/>+=<sp/><ref refid="interp_8h_1a8f29e42e2efa8821847486f87a6f957b" kindref="member">interp3Dcomp_eval_df</ref>(B_dB_temp,<sp/>&amp;Bdata-&gt;<ref refid="structB__STS__data_1aae284fbd94b891d8f69d9b2f470d70e7" kindref="member">B_phi</ref>,<sp/>r,<sp/>phi,<sp/>z);</highlight></codeline>
<codeline lineno="494"><highlight class="normal"></highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[4]<sp/>=<sp/>B_dB_temp[0];</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[5]<sp/>=<sp/>B_dB_temp[1];</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[6]<sp/>=<sp/>B_dB_temp[2];</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[7]<sp/>=<sp/>B_dB_temp[3];</highlight></codeline>
<codeline lineno="499"><highlight class="normal"></highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/>interperr<sp/>+=<sp/><ref refid="interp_8h_1a8f29e42e2efa8821847486f87a6f957b" kindref="member">interp3Dcomp_eval_df</ref>(B_dB_temp,<sp/>&amp;Bdata-&gt;<ref refid="structB__STS__data_1a9e0c10d26231dc51adaf4beefb60dd02" kindref="member">B_z</ref>,<sp/>r,<sp/>phi,<sp/>z);</highlight></codeline>
<codeline lineno="501"><highlight class="normal"></highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[8]<sp/>=<sp/>B_dB_temp[0];</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[9]<sp/>=<sp/>B_dB_temp[1];</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[10]<sp/>=<sp/>B_dB_temp[2];</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/>B_dB[11]<sp/>=<sp/>B_dB_temp[3];</highlight></codeline>
<codeline lineno="506"><highlight class="normal"></highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Test<sp/>for<sp/>B<sp/>field<sp/>interpolation<sp/>error<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(interperr)<sp/>{</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<sp/><ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92aaa34d7aa427b982efa61030ebc069963" kindref="member">ERR_INPUT_EVALUATION</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddac3c845cd75d76ee2b1bf40ad481f7bd0" kindref="member">EF_B_STS</ref><sp/>);</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="511"><highlight class="normal"></highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Check<sp/>that<sp/>magnetic<sp/>field<sp/>seems<sp/>valid<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>check<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/>check<sp/>+=<sp/>((B_dB[0]*B_dB[0]<sp/>+<sp/>B_dB[4]*B_dB[4]<sp/>+<sp/>B_dB[8]*B_dB[8])<sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!err<sp/>&amp;&amp;<sp/>check)<sp/>{</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<sp/><ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92afd37c4badd68d8e161fa0676fd11eb4c" kindref="member">ERR_INPUT_UNPHYSICAL</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddac3c845cd75d76ee2b1bf40ad481f7bd0" kindref="member">EF_B_STS</ref><sp/>);</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="518"><highlight class="normal"></highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="520"><highlight class="normal">}</highlight></codeline>
<codeline lineno="521"><highlight class="normal"></highlight></codeline>
<codeline lineno="531" refid="B__STS_8c_1aea8eeb2c4dfd0112d3dc7cd46ebe147a" refkind="member"><highlight class="normal"><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/><ref refid="B__STS_8c_1aea8eeb2c4dfd0112d3dc7cd46ebe147a" kindref="member">B_STS_get_axis_rz</ref>(<ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>rz[2],<sp/><ref refid="structB__STS__data" kindref="compound">B_STS_data</ref>*<sp/>Bdata,<sp/><ref refid="ascot5_8h_1a11d147c64891830c9e79b3315b1b2e21" kindref="member">real</ref><sp/>phi)<sp/>{</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_8h_1a3bca029fa2975420f00b89f3cb38872e" kindref="member">a5err</ref><sp/>err<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="533"><highlight class="normal"></highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>interperr<sp/>=<sp/>0;<sp/></highlight><highlight class="comment">/*<sp/>If<sp/>error<sp/>happened<sp/>during<sp/>interpolation<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/>interperr<sp/>+=<sp/><ref refid="linint_8h_1a834994323118f56778a9e30de045daa8" kindref="member">linint1D_eval_f</ref>(&amp;rz[0],<sp/>&amp;Bdata-&gt;<ref refid="structB__STS__data_1aff12e35d6e34d0ffffc6c6babfe286fc" kindref="member">axis_r</ref>,<sp/>phi);</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/>interperr<sp/>+=<sp/><ref refid="linint_8h_1a834994323118f56778a9e30de045daa8" kindref="member">linint1D_eval_f</ref>(&amp;rz[1],<sp/>&amp;Bdata-&gt;<ref refid="structB__STS__data_1aba669d33028e92977257bd24f615c837" kindref="member">axis_z</ref>,<sp/>phi);</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(interperr)<sp/>{</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/><ref refid="error_8h_1a580a0b8b4a823a26a00b2f83d9343bc4" kindref="member">error_raise</ref>(<sp/><ref refid="error_8h_1a6756b9f30781ed8ca8ce938e49ad9d92aaa34d7aa427b982efa61030ebc069963" kindref="member">ERR_INPUT_EVALUATION</ref>,<sp/>__LINE__,<sp/><ref refid="error_8h_1a4e101179605aba551caa2576fd83a1ddac3c845cd75d76ee2b1bf40ad481f7bd0" kindref="member">EF_B_STS</ref><sp/>);</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>err;</highlight></codeline>
<codeline lineno="541"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="Bfield/B_STS.c"/>
  </compounddef>
</doxygen>
