<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ASCOT5: ascot5_main.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ASCOT5
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">ascot5_main.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>ASCOT5 stand-alone program.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;getopt.h&gt;</code><br />
<code>#include &lt;<a class="el" href="math_8h_source.html">math.h</a>&gt;</code><br />
<code>#include &lt;omp.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;time.h&gt;</code><br />
<code>#include &quot;<a class="el" href="ascot5_8h_source.html">ascot5.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="consts_8h_source.html">consts.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="wall_8h_source.html">wall.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="diag_8h_source.html">diag.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="B__field_8h_source.html">B_field.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="plasma_8h_source.html">plasma.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="print_8h_source.html">print.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="simulate_8h_source.html">simulate.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="particle_8h_source.html">particle.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="endcond_8h_source.html">endcond.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="hdf5__interface_8h_source.html">hdf5_interface.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="offload_8h_source.html">offload.h</a>&quot;</code><br />
<code>#include &quot;gitver.h&quot;</code><br />
<code>#include &quot;<a class="el" href="mpi__interface_8h_source.html">mpi_interface.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="ascot5__main_8h_source.html">ascot5_main.h</a>&quot;</code><br />
</div>
<p><a href="ascot5__main_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a78c99ffd76a7bb3c8c74db76207e9ab4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ascot5__main_8c.html#a78c99ffd76a7bb3c8c74db76207e9ab4">_XOPEN_SOURCE</a>&#160;&#160;&#160;500</td></tr>
<tr class="separator:a78c99ffd76a7bb3c8c74db76207e9ab4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aab0725951621a452e478e9f76402f5e8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ascot5__main_8c.html#aab0725951621a452e478e9f76402f5e8">read_arguments</a> (int argc, char **argv, <a class="el" href="structsim__offload__data.html">sim_offload_data</a> *sim)</td></tr>
<tr class="memdesc:aab0725951621a452e478e9f76402f5e8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read command line arguments and modify sim struct accordingly.  <a href="ascot5__main_8c.html#aab0725951621a452e478e9f76402f5e8">More...</a><br /></td></tr>
<tr class="separator:aab0725951621a452e478e9f76402f5e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ascot5__main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (int argc, char **argv)</td></tr>
<tr class="memdesc:a3c04138a5bfe5d72780bb7e82a18e627"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main function for ascot5_main.  <a href="ascot5__main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">More...</a><br /></td></tr>
<tr class="separator:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06aa2611d6955391a69dfcf397c674b8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ascot5__main_8c.html#a06aa2611d6955391a69dfcf397c674b8">prepare_markers</a> (<a class="el" href="structsim__offload__data.html">sim_offload_data</a> *sim, int mpi_size, int mpi_rank, int n_tot, <a class="el" href="structinput__particle.html">input_particle</a> **pin, <a class="el" href="structparticle__state.html">particle_state</a> **pout, int *nprts, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> *B_offload_array)</td></tr>
<tr class="memdesc:a06aa2611d6955391a69dfcf397c674b8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepare markers for offload.  <a href="ascot5__main_8c.html#a06aa2611d6955391a69dfcf397c674b8">More...</a><br /></td></tr>
<tr class="separator:a06aa2611d6955391a69dfcf397c674b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c47ac3fc9b50c894c452283725c7052"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ascot5__main_8c.html#a1c47ac3fc9b50c894c452283725c7052">pack_offload_array</a> (<a class="el" href="structsim__offload__data.html">sim_offload_data</a> *sim, <a class="el" href="structoffload__package.html">offload_package</a> *offload_data, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> **B_offload_array, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> **E_offload_array, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> **plasma_offload_array, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> **neutral_offload_array, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> **wall_offload_array, int **wall_int_offload_array, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> **boozer_offload_array, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> **mhd_offload_array, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> **asigma_offload_array, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> **offload_array, int **int_offload_array)</td></tr>
<tr class="memdesc:a1c47ac3fc9b50c894c452283725c7052"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepare offload array to be offloaded.  <a href="ascot5__main_8c.html#a1c47ac3fc9b50c894c452283725c7052">More...</a><br /></td></tr>
<tr class="separator:a1c47ac3fc9b50c894c452283725c7052"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab65b27e3eb40c198e345865c4a4a2950"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ascot5__main_8c.html#ab65b27e3eb40c198e345865c4a4a2950">write_rungroup</a> (<a class="el" href="structsim__offload__data.html">sim_offload_data</a> *sim, int mpi_size, int mpi_rank, int mpi_root, int n_tot, <a class="el" href="structparticle__state.html">particle_state</a> *ps, char *qid)</td></tr>
<tr class="memdesc:ab65b27e3eb40c198e345865c4a4a2950"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create and store run group and marker inistate.  <a href="ascot5__main_8c.html#ab65b27e3eb40c198e345865c4a4a2950">More...</a><br /></td></tr>
<tr class="separator:ab65b27e3eb40c198e345865c4a4a2950"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99f525f561d0ebaf51c4f44a89dd6d25"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ascot5__main_8c.html#a99f525f561d0ebaf51c4f44a89dd6d25">offload_and_simulate</a> (<a class="el" href="structsim__offload__data.html">sim_offload_data</a> *sim, int mpi_size, int mpi_rank, int mpi_root, int n_tot, int nprts, <a class="el" href="structparticle__state.html">particle_state</a> *pin, <a class="el" href="structoffload__package.html">offload_package</a> *offload_data, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> *offload_array, int *int_offload_array, int *n_gathered, <a class="el" href="structparticle__state.html">particle_state</a> **pout, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> **diag_offload_array)</td></tr>
<tr class="memdesc:a99f525f561d0ebaf51c4f44a89dd6d25"><td class="mdescLeft">&#160;</td><td class="mdescRight">Offload data to target, carry out the simulation, and return to host.  <a href="ascot5__main_8c.html#a99f525f561d0ebaf51c4f44a89dd6d25">More...</a><br /></td></tr>
<tr class="separator:a99f525f561d0ebaf51c4f44a89dd6d25"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af26432295137ec027bfa2d1db823148f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ascot5__main_8c.html#af26432295137ec027bfa2d1db823148f">write_output</a> (<a class="el" href="structsim__offload__data.html">sim_offload_data</a> *sim, int mpi_rank, int mpi_root, <a class="el" href="structparticle__state.html">particle_state</a> *ps_gathered, int n_gathered, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> *diag_offload_array)</td></tr>
<tr class="memdesc:af26432295137ec027bfa2d1db823148f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Store simulation output data.  <a href="ascot5__main_8c.html#af26432295137ec027bfa2d1db823148f">More...</a><br /></td></tr>
<tr class="separator:af26432295137ec027bfa2d1db823148f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73cfeb9193341aff90367f8425e40f3a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ascot5__main_8c.html#a73cfeb9193341aff90367f8425e40f3a">print_marker_summary</a> (<a class="el" href="structparticle__state.html">particle_state</a> *ps, int n_tot)</td></tr>
<tr class="memdesc:a73cfeb9193341aff90367f8425e40f3a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Writes a summary of what happened to the markers during simulation.  <a href="ascot5__main_8c.html#a73cfeb9193341aff90367f8425e40f3a">More...</a><br /></td></tr>
<tr class="separator:a73cfeb9193341aff90367f8425e40f3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>ASCOT5 stand-alone program. </p>
<p>This program reads data from input HDF5 file, simulates the given markers, and writes the output data to a HDF5 file.</p>
<p>The input and output files can be separate.</p>
<p>Example: </p><pre class="fragment">ascot5_main --in=in --out=out
</pre><p> Here "in" refers to in.h5 where input data is located and "out" to out.h5 where results will be stored. If no input argument is given the data is read from ascot.h5. If not output argument is given the results are stored in the input file.</p>
<p>This program assumes that the input file contains magnetic field, electric field, plasma, wall, and neutral data along with markers and options. See hdf5_input.c for details. This program uses the input fields that are marked as active (the HDF5 file can contain multiple instances of same input types but only the active one is used here).</p>
<p>The results are stored under /results/ group in output HDF5 file. The group is created if one does not exists. For each run a specific "run" group is created, which has the format run-XXXXXXXXXX, where "XXXXXXXXXX" is randomly generated identification number (QID). The run group holds information when the run was started, which input fields were used (referenced by their QIDs), and at least the marker initial and end states if the simulation succeeded. Also any other diagnostic data that was used is stored there.</p>
<p>This program uses MPI by dividing the number of markers equally to all MPI processes. The markers are not suffled so user is advised to do it beforehand to ensure work is evenly distributed. A single MPI process can be simulated with: </p><pre class="fragment">ascot5_main --mpi_size=size --mpi_rank=rank
</pre><p> where size refers to number of MPI processes and rank is the process being run (between [0, size-1]). Running the program this way does not use MPI. This is intended to be used in Condor-like environments.</p>
<p>You can add a description of the simulation as:</p>
<p>ascot5_main &ndash;d="This is a test run"</p>
<p>which is written in HDF5 file at the run group specific to this simulation.</p>
<p>In addition to output data, the simulation progress may be written in *.stdout files with each MPI process having dedicated file. See <a class="el" href="ascot5_8h.html" title="Main header file for ASCOT5.">ascot5.h</a> for details. </p>

<p class="definition">Definition in file <a class="el" href="ascot5__main_8c_source.html">ascot5_main.c</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a78c99ffd76a7bb3c8c74db76207e9ab4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a78c99ffd76a7bb3c8c74db76207e9ab4">&#9670;&nbsp;</a></span>_XOPEN_SOURCE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _XOPEN_SOURCE&#160;&#160;&#160;500</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>drand48 requires POSIX 1995 standard </p>

<p class="definition">Definition at line <a class="el" href="ascot5__main_8c_source.html#l00054">54</a> of file <a class="el" href="ascot5__main_8c_source.html">ascot5_main.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="aab0725951621a452e478e9f76402f5e8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aab0725951621a452e478e9f76402f5e8">&#9670;&nbsp;</a></span>read_arguments()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int read_arguments </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>argv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsim__offload__data.html">sim_offload_data</a> *&#160;</td>
          <td class="paramname"><em>sim</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read command line arguments and modify sim struct accordingly. </p>
<p>The command line arguments are in, out, mpi_size, and mpi_rank which correspond to input file, output file, number of MPI processes and the rank of this process. These are stored in simulation offload data struct as (default values, used if the specific argument was not given, are in parenthesis):</p>
<ul>
<li>sim-&gt;hdf5_in = "in.h5" ("ascot.h5")</li>
<li>sim-&gt;hdf5_out = "out" (sim-&gt;hdf5_in is copied here)</li>
<li>sim-&gt;mpi_rank = 0</li>
<li>sim-&gt;mpi_size = 0</li>
<li>sim-&gt;desc = "No description"</li>
</ul>
<p>If the arguments could not be parsed, this function returns a non-zero exit value.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">argc</td><td>argument count as given to <a class="el" href="ascot5__main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="Main function for ascot5_main.">main()</a> </td></tr>
    <tr><td class="paramname">argv</td><td>argument vector as given to <a class="el" href="ascot5__main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="Main function for ascot5_main.">main()</a> </td></tr>
    <tr><td class="paramname">sim</td><td>pointer to offload data struct</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Zero if success </dd></dl>

<p class="definition">Definition at line <a class="el" href="ascot5__main_8c_source.html#l00631">631</a> of file <a class="el" href="ascot5__main_8c_source.html">ascot5_main.c</a>.</p>

</div>
</div>
<a id="a3c04138a5bfe5d72780bb7e82a18e627"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c04138a5bfe5d72780bb7e82a18e627">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>argv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main function for ascot5_main. </p>
<p>This function calls functions that read input data from the disk, and functions that initialize the offload data structs and offload arrays. Actual simulation is done by calling <a class="el" href="simulate_8c.html#a731ec48c95f5641ae30d383ba7d5d387" title="Execute marker simulation.">simulate()</a>. Once the simulation has been completed, offload arrays are deallocated and the results are written to the disk.</p>
<p>MPI level parallelisation is done here as well as the offloading.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">argc</td><td>argument count of the command line arguments </td></tr>
    <tr><td class="paramname">argv</td><td>argument vector of the command line arguments</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Zero if simulation was completed with no issues </dd></dl>

<p class="definition">Definition at line <a class="el" href="ascot5__main_8c_source.html#l00101">101</a> of file <a class="el" href="ascot5__main_8c_source.html">ascot5_main.c</a>.</p>

</div>
</div>
<a id="a06aa2611d6955391a69dfcf397c674b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a06aa2611d6955391a69dfcf397c674b8">&#9670;&nbsp;</a></span>prepare_markers()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int prepare_markers </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsim__offload__data.html">sim_offload_data</a> *&#160;</td>
          <td class="paramname"><em>sim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mpi_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mpi_rank</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n_tot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structinput__particle.html">input_particle</a> **&#160;</td>
          <td class="paramname"><em>pin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structparticle__state.html">particle_state</a> **&#160;</td>
          <td class="paramname"><em>pout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>nprts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> *&#160;</td>
          <td class="paramname"><em>B_offload_array</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prepare markers for offload. </p>
<p>Marker states are initialized here and stored in a single array, which then can be offloaded to the target.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sim</td><td>simulation offload data struct </td></tr>
    <tr><td class="paramname">mpi_size</td><td>number of MPI processes </td></tr>
    <tr><td class="paramname">mpi_rank</td><td>rank of this MPI process </td></tr>
    <tr><td class="paramname">n_tot</td><td>total number of markers </td></tr>
    <tr><td class="paramname">pin</td><td>pointer to marker input array which is deallocated here </td></tr>
    <tr><td class="paramname">pout</td><td>pointer to marker state array created here </td></tr>
    <tr><td class="paramname">nprts</td><td>pointer to variable for number of markers for this process </td></tr>
    <tr><td class="paramname">B_offload_array</td><td>pointer to magnetic field data needed for marker init</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>zero on success </dd></dl>

<p class="definition">Definition at line <a class="el" href="ascot5__main_8c_source.html#l00270">270</a> of file <a class="el" href="ascot5__main_8c_source.html">ascot5_main.c</a>.</p>

</div>
</div>
<a id="a1c47ac3fc9b50c894c452283725c7052"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1c47ac3fc9b50c894c452283725c7052">&#9670;&nbsp;</a></span>pack_offload_array()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pack_offload_array </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsim__offload__data.html">sim_offload_data</a> *&#160;</td>
          <td class="paramname"><em>sim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structoffload__package.html">offload_package</a> *&#160;</td>
          <td class="paramname"><em>offload_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> **&#160;</td>
          <td class="paramname"><em>B_offload_array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> **&#160;</td>
          <td class="paramname"><em>E_offload_array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> **&#160;</td>
          <td class="paramname"><em>plasma_offload_array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> **&#160;</td>
          <td class="paramname"><em>neutral_offload_array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> **&#160;</td>
          <td class="paramname"><em>wall_offload_array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int **&#160;</td>
          <td class="paramname"><em>wall_int_offload_array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> **&#160;</td>
          <td class="paramname"><em>boozer_offload_array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> **&#160;</td>
          <td class="paramname"><em>mhd_offload_array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> **&#160;</td>
          <td class="paramname"><em>asigma_offload_array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> **&#160;</td>
          <td class="paramname"><em>offload_array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int **&#160;</td>
          <td class="paramname"><em>int_offload_array</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prepare offload array to be offloaded. </p>
<p>When data is read, it is stored to input specific offload arrays which are packed as a single array here (two actually as one array contains integers and the other floats). The initial individual arrays are deallocated.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sim</td><td>simulation offload data struct </td></tr>
    <tr><td class="paramname">offload_data</td><td>empty offload package </td></tr>
    <tr><td class="paramname">B_offload_array</td><td>magnetic field offload array </td></tr>
    <tr><td class="paramname">E_offload_array</td><td>electric field offload array </td></tr>
    <tr><td class="paramname">plasma_offload_array</td><td>plasma offload array </td></tr>
    <tr><td class="paramname">neutral_offload_array</td><td>neutrals offload array </td></tr>
    <tr><td class="paramname">wall_offload_array</td><td>wall offload array </td></tr>
    <tr><td class="paramname">wall_int_offload_array</td><td>wall integer offload array </td></tr>
    <tr><td class="paramname">boozer_offload_array</td><td>boozer offload array </td></tr>
    <tr><td class="paramname">mhd_offload_array</td><td>MHD data offload array </td></tr>
    <tr><td class="paramname">asigma_offload_array</td><td>atomic data offload array </td></tr>
    <tr><td class="paramname">offload_array</td><td>pointer to common offload array created here </td></tr>
    <tr><td class="paramname">int_offload_array</td><td>pointer to common offload integer array created here</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>zero on success </dd></dl>

<p class="definition">Definition at line <a class="el" href="ascot5__main_8c_source.html#l00334">334</a> of file <a class="el" href="ascot5__main_8c_source.html">ascot5_main.c</a>.</p>

</div>
</div>
<a id="ab65b27e3eb40c198e345865c4a4a2950"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab65b27e3eb40c198e345865c4a4a2950">&#9670;&nbsp;</a></span>write_rungroup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int write_rungroup </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsim__offload__data.html">sim_offload_data</a> *&#160;</td>
          <td class="paramname"><em>sim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mpi_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mpi_rank</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mpi_root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n_tot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structparticle__state.html">particle_state</a> *&#160;</td>
          <td class="paramname"><em>ps</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>qid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create and store run group and marker inistate. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sim</td><td>simulation offload data struct </td></tr>
    <tr><td class="paramname">mpi_size</td><td>number of MPI processes </td></tr>
    <tr><td class="paramname">mpi_rank</td><td>rank of this MPI process </td></tr>
    <tr><td class="paramname">mpi_root</td><td>rank of the root process </td></tr>
    <tr><td class="paramname">n_tot</td><td>total number of markers </td></tr>
    <tr><td class="paramname">ps</td><td>marker state array for this process </td></tr>
    <tr><td class="paramname">qid</td><td>unique identifier for this run group</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>zero on success </dd></dl>

<p class="definition">Definition at line <a class="el" href="ascot5__main_8c_source.html#l00404">404</a> of file <a class="el" href="ascot5__main_8c_source.html">ascot5_main.c</a>.</p>

</div>
</div>
<a id="a99f525f561d0ebaf51c4f44a89dd6d25"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99f525f561d0ebaf51c4f44a89dd6d25">&#9670;&nbsp;</a></span>offload_and_simulate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int offload_and_simulate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsim__offload__data.html">sim_offload_data</a> *&#160;</td>
          <td class="paramname"><em>sim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mpi_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mpi_rank</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mpi_root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n_tot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nprts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structparticle__state.html">particle_state</a> *&#160;</td>
          <td class="paramname"><em>pin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structoffload__package.html">offload_package</a> *&#160;</td>
          <td class="paramname"><em>offload_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> *&#160;</td>
          <td class="paramname"><em>offload_array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>int_offload_array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>n_gathered</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structparticle__state.html">particle_state</a> **&#160;</td>
          <td class="paramname"><em>pout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> **&#160;</td>
          <td class="paramname"><em>diag_offload_array</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Offload data to target, carry out the simulation, and return to host. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sim</td><td>simulation offload data struct </td></tr>
    <tr><td class="paramname">mpi_size</td><td>number of MPI processes </td></tr>
    <tr><td class="paramname">mpi_rank</td><td>rank of this MPI process </td></tr>
    <tr><td class="paramname">mpi_root</td><td>rank of the root process </td></tr>
    <tr><td class="paramname">n_tot</td><td>total number of markers </td></tr>
    <tr><td class="paramname">nprts</td><td>number of markers in this process </td></tr>
    <tr><td class="paramname">pin</td><td>marker state array for this process (deallocated here) </td></tr>
    <tr><td class="paramname">offload_data</td><td>packed offload data struct </td></tr>
    <tr><td class="paramname">offload_array</td><td>packed offload array containing the input data </td></tr>
    <tr><td class="paramname">int_offload_array</td><td>packed offload integer array containg the input data </td></tr>
    <tr><td class="paramname">n_gathered</td><td>pointer for storing number of simulated markers </td></tr>
    <tr><td class="paramname">pout</td><td>pointer to array containing all marker endstates </td></tr>
    <tr><td class="paramname">diag_offload_array</td><td>allocated array to return output data from target</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>zero on success </dd></dl>

<p class="definition">Definition at line <a class="el" href="ascot5__main_8c_source.html#l00467">467</a> of file <a class="el" href="ascot5__main_8c_source.html">ascot5_main.c</a>.</p>

</div>
</div>
<a id="af26432295137ec027bfa2d1db823148f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af26432295137ec027bfa2d1db823148f">&#9670;&nbsp;</a></span>write_output()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int write_output </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsim__offload__data.html">sim_offload_data</a> *&#160;</td>
          <td class="paramname"><em>sim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mpi_rank</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mpi_root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structparticle__state.html">particle_state</a> *&#160;</td>
          <td class="paramname"><em>ps_gathered</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n_gathered</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> *&#160;</td>
          <td class="paramname"><em>diag_offload_array</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Store simulation output data. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sim</td><td>simulation offload data </td></tr>
    <tr><td class="paramname">mpi_rank</td><td>rank of this MPI process </td></tr>
    <tr><td class="paramname">mpi_root</td><td>rank of the root process (which does the writing) </td></tr>
    <tr><td class="paramname">ps_gathered</td><td>marker state array containing the end states </td></tr>
    <tr><td class="paramname">n_gathered</td><td>number of simulated markers </td></tr>
    <tr><td class="paramname">diag_offload_array</td><td>diagnostics offload data array</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>zero on success </dd></dl>

<p class="definition">Definition at line <a class="el" href="ascot5__main_8c_source.html#l00564">564</a> of file <a class="el" href="ascot5__main_8c_source.html">ascot5_main.c</a>.</p>

</div>
</div>
<a id="a73cfeb9193341aff90367f8425e40f3a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a73cfeb9193341aff90367f8425e40f3a">&#9670;&nbsp;</a></span>print_marker_summary()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void print_marker_summary </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structparticle__state.html">particle_state</a> *&#160;</td>
          <td class="paramname"><em>ps</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n_tot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Writes a summary of what happened to the markers during simulation. </p>
<p>This function writes a summary of marker end conditions and possible simulation-time errors. Since simulation can have billions and billions of markers, we only show how many markers had specific error or end condition.</p>
<p>End conditions and errors are printed in human-readable format.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps</td><td>array of marker states after simulation has finished </td></tr>
    <tr><td class="paramname">n_tot</td><td>number of markers in the array </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ascot5__main_8c_source.html#l00793">793</a> of file <a class="el" href="ascot5__main_8c_source.html">ascot5_main.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Oct 3 2023 12:32:41 for ASCOT5 by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
