<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ASCOT5: simulate.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ASCOT5
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">simulate.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Header file for <a class="el" href="simulate_8c.html" title="Simulation is initialized and run from here.">simulate.c</a>.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="ascot5_8h_source.html">ascot5.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="B__field_8h_source.html">B_field.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="E__field_8h_source.html">E_field.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="plasma_8h_source.html">plasma.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="neutral_8h_source.html">neutral.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="wall_8h_source.html">wall.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="boozer_8h_source.html">boozer.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="mhd_8h_source.html">mhd.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="asigma_8h_source.html">asigma.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="nbi_8h_source.html">nbi.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="diag_8h_source.html">diag.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="offload_8h_source.html">offload.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="random_8h_source.html">random.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="mccc_8h_source.html">simulate/mccc/mccc.h</a>&quot;</code><br />
</div>
<p><a href="simulate_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structsim__offload__data.html">sim_offload_data</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Simulation offload struct.  <a href="structsim__offload__data.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structsim__data.html">sim_data</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Simulation data struct.  <a href="structsim__data.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a61dadd085c1777f559549e05962b2c9e"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom">{ <a class="el" href="simulate_8h.html#a61dadd085c1777f559549e05962b2c9ea11f071e38be84de6b29ac4882c2e024f">simulate_mode_fo</a> = 1
, <a class="el" href="simulate_8h.html#a61dadd085c1777f559549e05962b2c9eac0a6480e647e3fbeeea8a2bc4127e2a3">simulate_mode_gc</a> = 2
, <a class="el" href="simulate_8h.html#a61dadd085c1777f559549e05962b2c9eac788923fd31e2e061b73241d459e4590">simulate_mode_hybrid</a> = 3
, <a class="el" href="simulate_8h.html#a61dadd085c1777f559549e05962b2c9ea776d1e6a9397782eec6f44a14dec65c8">simulate_mode_ml</a> = 4
 }</td></tr>
<tr class="memdesc:a61dadd085c1777f559549e05962b2c9e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Simulaton modes.  <a href="simulate_8h.html#a61dadd085c1777f559549e05962b2c9e">More...</a><br /></td></tr>
<tr class="separator:a61dadd085c1777f559549e05962b2c9e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a0eb83ea67e77dffb1614c82865e0ddfa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="simulate_8h.html#a0eb83ea67e77dffb1614c82865e0ddfa">simulate_init_offload</a> (<a class="el" href="structsim__offload__data.html">sim_offload_data</a> *sim)</td></tr>
<tr class="memdesc:a0eb83ea67e77dffb1614c82865e0ddfa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes simulation settings.  <a href="simulate_8h.html#a0eb83ea67e77dffb1614c82865e0ddfa">More...</a><br /></td></tr>
<tr class="separator:a0eb83ea67e77dffb1614c82865e0ddfa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30d61fc32fe1448ab2a3abe49af56026"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="simulate_8h.html#a30d61fc32fe1448ab2a3abe49af56026">sim_init</a> (<a class="el" href="structsim__data.html">sim_data</a> *sim, <a class="el" href="structsim__offload__data.html">sim_offload_data</a> *sim_offload)</td></tr>
<tr class="memdesc:a30d61fc32fe1448ab2a3abe49af56026"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize simulation data struct on target.  <a href="simulate_8h.html#a30d61fc32fe1448ab2a3abe49af56026">More...</a><br /></td></tr>
<tr class="separator:a30d61fc32fe1448ab2a3abe49af56026"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a731ec48c95f5641ae30d383ba7d5d387"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="simulate_8h.html#a731ec48c95f5641ae30d383ba7d5d387">simulate</a> (int id, int n_particles, <a class="el" href="structparticle__state.html">particle_state</a> *p, <a class="el" href="structsim__offload__data.html">sim_offload_data</a> *sim_offload, <a class="el" href="structoffload__package.html">offload_package</a> *offload_data, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> *offload_array, int *int_offload_array, <a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> *diag_offload_array)</td></tr>
<tr class="memdesc:a731ec48c95f5641ae30d383ba7d5d387"><td class="mdescLeft">&#160;</td><td class="mdescRight">Execute marker simulation.  <a href="simulate_8h.html#a731ec48c95f5641ae30d383ba7d5d387">More...</a><br /></td></tr>
<tr class="separator:a731ec48c95f5641ae30d383ba7d5d387"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Header file for <a class="el" href="simulate_8c.html" title="Simulation is initialized and run from here.">simulate.c</a>. </p>
<p>Contains declarations of simulation_offload_data and simulation_data structs. Also simulation mode enums are declared here. </p>

<p class="definition">Definition in file <a class="el" href="simulate_8h_source.html">simulate.h</a>.</p>
</div><h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="a61dadd085c1777f559549e05962b2c9e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a61dadd085c1777f559549e05962b2c9e">&#9670;&nbsp;</a></span>anonymous enum</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Simulaton modes. </p>
<p>These enums are used to determine which simulation mode will be executed. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a61dadd085c1777f559549e05962b2c9ea11f071e38be84de6b29ac4882c2e024f"></a>simulate_mode_fo&#160;</td><td class="fielddoc"><p>Models markers as particles using <a class="el" href="structparticle__simd__fo.html" title="Struct representing NSIMD particle markers.">particle_simd_fo</a> struct and <a class="el" href="simulate__fo__fixed_8c.html" title="Simulate particles using fixed time-step.">simulate_fo_fixed.c</a> simulation loop <br  />
 </p>
</td></tr>
<tr><td class="fieldname"><a id="a61dadd085c1777f559549e05962b2c9eac0a6480e647e3fbeeea8a2bc4127e2a3"></a>simulate_mode_gc&#160;</td><td class="fielddoc"><p>Models markers as guiding centers using <a class="el" href="structparticle__simd__gc.html" title="Struct representing NSIMD guiding center markers.">particle_simd_gc</a> struct and <a class="el" href="simulate__gc__fixed_8c.html" title="Simulate guiding centers using fixed time-step.">simulate_gc_fixed.c</a> or <a class="el" href="simulate__gc__adaptive_8c.html" title="Simulate guiding centers using adaptive time-step.">simulate_gc_adaptive.c</a> simulation loops <br  />
 </p>
</td></tr>
<tr><td class="fieldname"><a id="a61dadd085c1777f559549e05962b2c9eac788923fd31e2e061b73241d459e4590"></a>simulate_mode_hybrid&#160;</td><td class="fielddoc"><p>Models markers first like using simulate_mode_gc. Additional end condition is used for markers that get close to wall. After all markers are finished, simulation for markers that were close to the wall is continued with using simulate_mode_fo mode <br  />
 </p>
</td></tr>
<tr><td class="fieldname"><a id="a61dadd085c1777f559549e05962b2c9ea776d1e6a9397782eec6f44a14dec65c8"></a>simulate_mode_ml&#160;</td><td class="fielddoc"><p>Models markers as field lines using <a class="el" href="structparticle__simd__ml.html" title="Struct representing NSIMD field line markers.">particle_simd_ml</a> struct and <a class="el" href="simulate__ml__adaptive_8c.html" title="Simulate magnetic field-lines using adaptive time-step.">simulate_ml_adaptive.c</a> simulation loop <br  />
 </p>
</td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="simulate_8h_source.html#l00031">31</a> of file <a class="el" href="simulate_8h_source.html">simulate.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a0eb83ea67e77dffb1614c82865e0ddfa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0eb83ea67e77dffb1614c82865e0ddfa">&#9670;&nbsp;</a></span>simulate_init_offload()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void simulate_init_offload </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsim__offload__data.html">sim_offload_data</a> *&#160;</td>
          <td class="paramname"><em>sim</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes simulation settings. </p>
<p>This function adjusts simulation settings, e.g. how physics are included, according to the given simulation data. This function should only be called once right after input data has been read.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sim</td><td>simulation offload struct which has all fields initialized </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="simulate_8c_source.html#l00327">327</a> of file <a class="el" href="simulate_8c_source.html">simulate.c</a>.</p>

</div>
</div>
<a id="a30d61fc32fe1448ab2a3abe49af56026"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a30d61fc32fe1448ab2a3abe49af56026">&#9670;&nbsp;</a></span>sim_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sim_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsim__data.html">sim_data</a> *&#160;</td>
          <td class="paramname"><em>sim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsim__offload__data.html">sim_offload_data</a> *&#160;</td>
          <td class="paramname"><em>offload_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize simulation data struct on target. </p>
<p>This function copies the simulation parameters from the offload struct to the struct on the target.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sim</td><td>pointer to data struct on target </td></tr>
    <tr><td class="paramname">offload_data</td><td>pointer to offload data struct </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="simulate_8c_source.html#l00342">342</a> of file <a class="el" href="simulate_8c_source.html">simulate.c</a>.</p>

</div>
</div>
<a id="a731ec48c95f5641ae30d383ba7d5d387"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a731ec48c95f5641ae30d383ba7d5d387">&#9670;&nbsp;</a></span>simulate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void simulate </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n_particles</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structparticle__state.html">particle_state</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsim__offload__data.html">sim_offload_data</a> *&#160;</td>
          <td class="paramname"><em>sim_offload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structoffload__package.html">offload_package</a> *&#160;</td>
          <td class="paramname"><em>offload_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> *&#160;</td>
          <td class="paramname"><em>offload_array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>int_offload_array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ascot5_8h.html#a11d147c64891830c9e79b3315b1b2e21">real</a> *&#160;</td>
          <td class="paramname"><em>diag_offload_array</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Execute marker simulation. </p>
<p>This simulates markers using given inputs and options. All different types of simulations are initialized and run via this function.</p>
<p>This function proceeds as follows:</p>
<ol type="1">
<li>Input offload data is unpacked and initialized by calling respective init functions.</li>
<li>Meta data (e.g. random number generator) is initialized.</li>
<li>Markers are put into simulation queue.</li>
<li>Threads are spawned. One thread is dedicated for monitoring progress, if monitoring is active.</li>
<li>Other threads execute marker simulation using the mode the user has chosen.</li>
</ol>
<ul>
<li>Process continues once all markers have been simulated and each thread has finished. Monitoring is also terminated.</li>
</ul>
<ol type="1">
<li>(If hybrid mode is active) Markers with hybrid end condition active are placed on a new queue, and they have their end condition deactivated and they are simulated with <a class="el" href="simulate__fo__fixed_8c.html" title="Simulate particles using fixed time-step.">simulate_fo_fixed.c</a> until they have met some other end condition. Threads are spawned and progress is monitored as previously.</li>
<li>Simulation data is deallocated except for data that is mapped back to host.</li>
<li>Execution returns to host where this function was called.</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">id</td><td>target id where this function is executed, zero if on host </td></tr>
    <tr><td class="paramname">n_particles</td><td>total number of markers to be simulated </td></tr>
    <tr><td class="paramname">p</td><td>pointer to array storing all marker states to be simulated </td></tr>
    <tr><td class="paramname">sim_offload</td><td>pointer to simulation offload data </td></tr>
    <tr><td class="paramname">offload_data</td><td>pointer to the rest of the offload data </td></tr>
    <tr><td class="paramname">offload_array</td><td>pointer to input data offload array </td></tr>
    <tr><td class="paramname">int_offload_array</td><td>pointer to input data int offload array </td></tr>
    <tr><td class="paramname">diag_offload_array</td><td>pointer to diagnostics offload array</td></tr>
  </table>
  </dd>
</dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000011">Todo:</a></b></dt><dd>Reorganize this function so that it conforms to documentation. </dd></dl>

<p class="definition">Definition at line <a class="el" href="simulate_8c_source.html#l00081">81</a> of file <a class="el" href="simulate_8c_source.html">simulate.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Oct 3 2023 12:32:41 for ASCOT5 by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
